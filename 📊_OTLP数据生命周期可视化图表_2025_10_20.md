# ğŸ“Š OTLPæ•°æ®ç”Ÿå‘½å‘¨æœŸå¯è§†åŒ–å›¾è¡¨

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´10æœˆ20æ—¥  
> **ç›®çš„**: ä¸ºæ•°æ®æ¨¡å‹ä¸è¯­ä¹‰è½¬æ¢æŒ‡å—æä¾›é…å¥—å¯è§†åŒ–  
> **åŒ…å«**: 4å¤§æ ¸å¿ƒæµç¨‹å›¾ + å¤šä¸ªè¾…åŠ©å›¾è¡¨

---

## ğŸ¯ å›¾è¡¨æ¦‚è§ˆ

æœ¬æ–‡æ¡£æä¾›OTLPæ•°æ®æ¨¡å‹ä¸ç”Ÿå‘½å‘¨æœŸçš„å®Œæ•´å¯è§†åŒ–å›¾è¡¨ï¼Œé…å¥—[æ•°æ®æ¨¡å‹ä¸è¯­ä¹‰è½¬æ¢å®Œæ•´æŒ‡å—](ğŸ“Š_æ•°æ®æ¨¡å‹ä¸è¯­ä¹‰è½¬æ¢å®Œæ•´æŒ‡å—_2025_10_20.md)ä½¿ç”¨ã€‚

**æ ¸å¿ƒå›¾è¡¨**:

1. æ•°æ®ç”Ÿå‘½å‘¨æœŸå®Œæ•´æµç¨‹å›¾
2. OTLPä¸‰å±‚è¯­ä¹‰æ¨¡å‹ç»“æ„å›¾
3. Collectorå¤„ç†æµç¨‹è¯¦ç»†å›¾
4. å¤šåç«¯å­˜å‚¨æ¶æ„å›¾

---

## å›¾è¡¨1: æ•°æ®ç”Ÿå‘½å‘¨æœŸå®Œæ•´æµç¨‹

### 1.1 æ•´ä½“æµç¨‹å›¾

```mermaid
graph TB
    subgraph "é˜¶æ®µ1: æ•°æ®æ”¶é›†"
        A1[ç”¨æˆ·åº”ç”¨<br/>è‡ªå®šä¹‰ä¸šåŠ¡æ¨¡å‹]
        A2[è‡ªåŠ¨ä»ªå™¨åŒ–<br/>Auto-instrumentation]
        A3[æ‰‹åŠ¨åŸ‹ç‚¹<br/>Manual Instrumentation]
        A1 --> A2
        A1 --> A3
    end
    
    subgraph "é˜¶æ®µ2: SDKæ ‡å‡†åŒ–"
        B1[OpenTelemetry SDK]
        B2[æ ‡å‡†è¯­ä¹‰çº¦å®š<br/>Semantic Conventions]
        B3[OTLPæ ¼å¼åŒ–<br/>Protobuf/JSON]
        A2 --> B1
        A3 --> B1
        B1 --> B2
        B2 --> B3
    end
    
    subgraph "é˜¶æ®µ3: æ•°æ®ä¼ è¾“"
        C1[gRPCä¼ è¾“<br/>HTTP/2]
        C2[HTTP/1.1ä¼ è¾“<br/>JSON]
        C3[æ‰¹å¤„ç†+å‹ç¼©<br/>gzip 60-70%]
        B3 --> C1
        B3 --> C2
        C1 --> C3
        C2 --> C3
    end
    
    subgraph "é˜¶æ®µ4: Collectorè½¬æ¢"
        D1[æ¥æ”¶å™¨<br/>OTLP Receiver]
        D2[å¤„ç†å™¨<br/>Processors]
        D3[å¯¼å‡ºå™¨<br/>Exporters]
        C3 --> D1
        D1 --> D2
        D2 --> D3
    end
    
    subgraph "é˜¶æ®µ5: æ•°æ®å­˜å‚¨"
        E1[çƒ­æ•°æ® 7å¤©<br/>Elasticsearch]
        E2[æ¸©æ•°æ® 30å¤©<br/>ClickHouse]
        E3[å†·æ•°æ® >30å¤©<br/>S3 Glacier]
        D3 --> E1
        D3 --> E2
        D3 --> E3
    end
    
    subgraph "é˜¶æ®µ6: æ•°æ®å¤„ç†"
        F1[å®æ—¶æµå¤„ç†<br/>Apache Flink]
        F2[æ‰¹å¤„ç†åˆ†æ<br/>Apache Spark]
        F3[å¢é‡è®¡ç®—<br/>t-digest]
        E1 --> F1
        E2 --> F2
        E3 --> F2
    end
    
    subgraph "é˜¶æ®µ7: æ•°æ®æŸ¥è¯¢ä¸å¯è§†åŒ–"
        G1[å®æ—¶ç›‘æ§<br/>Grafana]
        G2[æ—¥å¿—æŸ¥è¯¢<br/>Kibana]
        G3[Ad-hocåˆ†æ<br/>Presto/ClickHouse]
        F1 --> G1
        F2 --> G2
        F2 --> G3
    end
    
    style A1 fill:#e1f5ff
    style B2 fill:#fff4e1
    style D2 fill:#ffe1e1
    style E2 fill:#e1ffe1
    style F1 fill:#f0e1ff
    style G1 fill:#ffe1f0
```

### 1.2 è¯¦ç»†è¯´æ˜

#### é˜¶æ®µ1: æ•°æ®æ”¶é›†

**è¾“å…¥**: ç”¨æˆ·åº”ç”¨ä¸­çš„ä¸šåŠ¡é€»è¾‘

**å¤„ç†**:

- è‡ªåŠ¨ä»ªå™¨åŒ–ï¼šæ¡†æ¶çº§åˆ«è‡ªåŠ¨æ”¶é›†ï¼ˆFlask, Spring Boot, Expressç­‰ï¼‰
- æ‰‹åŠ¨åŸ‹ç‚¹ï¼šè‡ªå®šä¹‰ä¸šåŠ¡å±æ€§æ·»åŠ 

**è¾“å‡º**: åŸå§‹é¥æµ‹æ•°æ®ï¼ˆæœªæ ‡å‡†åŒ–ï¼‰

---

#### é˜¶æ®µ2: SDKæ ‡å‡†åŒ–

**è¾“å…¥**: åŸå§‹é¥æµ‹æ•°æ®

**å¤„ç†**:

1. OpenTelemetry SDKå¤„ç†
2. åº”ç”¨æ ‡å‡†è¯­ä¹‰çº¦å®šï¼ˆSemantic Conventions v1.29.0ï¼‰
3. æ ¼å¼åŒ–ä¸ºOTLPï¼ˆProtobufæˆ–JSONï¼‰

**è¾“å‡º**: æ ‡å‡†åŒ–çš„OTLPæ•°æ®

**å…³é”®è½¬æ¢**:

```text
ç”¨æˆ·è‡ªå®šä¹‰å±æ€§:
  myapp.order.id â†’ ä¿ç•™ï¼ˆvendorå‰ç¼€ï¼‰
  
æ ‡å‡†å±æ€§è‡ªåŠ¨æ·»åŠ :
  http.request.method: "POST"
  http.route: "/api/orders"
  service.name: "order-service"
  deployment.environment: "production"
```

---

#### é˜¶æ®µ3: æ•°æ®ä¼ è¾“

**è¾“å…¥**: æ ‡å‡†åŒ–OTLPæ•°æ®

**ä¼ è¾“åè®®**:

- gRPC (HTTP/2): æ¨èï¼ŒäºŒè¿›åˆ¶é«˜æ•ˆ
- HTTP/1.1 (JSON): å…¼å®¹æ€§å¥½

**ä¼˜åŒ–**:

- æ‰¹å¤„ç†: batch_size=512, timeout=1s
- gzipå‹ç¼©: èŠ‚çœ60-70%å¸¦å®½
- å¼‚æ­¥å‘é€: ä¸é˜»å¡ä¸šåŠ¡é€»è¾‘

**è¾“å‡º**: ä¼ è¾“åˆ°Collectorçš„OTLPæ•°æ®

---

#### é˜¶æ®µ4: Collectorè½¬æ¢

**è¾“å…¥**: æ¥æ”¶çš„OTLPæ•°æ®

**å¤„ç†æµç¨‹** (è¯¦è§å›¾è¡¨3):

1. **æ¥æ”¶å™¨**: æ¥æ”¶OTLPæ•°æ®
2. **å¤„ç†å™¨**:
   - èµ„æºæ£€æµ‹ï¼ˆäº‘å¹³å°å±æ€§ï¼‰
   - å±æ€§è½¬æ¢å’Œæ¸…æ´—
   - PIIè„±æ•å’Œå“ˆå¸Œ
   - å°¾éƒ¨é‡‡æ ·ï¼ˆä¿ç•™å¼‚å¸¸ï¼‰
   - Span Metricsç”Ÿæˆ
3. **å¯¼å‡ºå™¨**: è·¯ç”±åˆ°å¤šä¸ªåç«¯

**è¾“å‡º**: è½¬æ¢åçš„æ•°æ®ï¼Œå‘é€åˆ°å­˜å‚¨åç«¯

---

#### é˜¶æ®µ5: æ•°æ®å­˜å‚¨

**åˆ†å±‚å­˜å‚¨ç­–ç•¥**:

| å±‚çº§ | æ—¶é—´èŒƒå›´ | å­˜å‚¨åç«¯ | ç‰¹ç‚¹ | æˆæœ¬ |
|------|---------|---------|------|------|
| **çƒ­æ•°æ®** | æœ€è¿‘7å¤© | Elasticsearch | é«˜æ€§èƒ½æŸ¥è¯¢ï¼Œå…¨æ–‡æœç´¢ | é«˜ |
| **æ¸©æ•°æ®** | 7-30å¤© | ClickHouse | åˆ—å¼å­˜å‚¨ï¼ŒOLAPåˆ†æ | ä¸­ |
| **å†·æ•°æ®** | >30å¤© | S3 Glacier | å½’æ¡£å­˜å‚¨ï¼Œåˆè§„ä¿ç•™ | ä½ |

**å®¹é‡è§„åˆ’**:

```text
ç¤ºä¾‹ï¼ˆ10M spans/å¤©ï¼‰:
â”œâ”€ çƒ­æ•°æ®: 70M spans Ã— 2KB = 140GB
â”œâ”€ æ¸©æ•°æ®: 230M spans Ã— 0.5KB (å‹ç¼©) = 115GB
â””â”€ å†·æ•°æ®: 1B+ spans Ã— 0.1KB (æ·±åº¦å‹ç¼©) = 100GB
æ€»è®¡: 355GB (vs åŸå§‹2TBï¼ŒèŠ‚çœ82%)
```

---

#### é˜¶æ®µ6: æ•°æ®å¤„ç†

**å®æ—¶æµå¤„ç† (Apache Flink)**:

- å»¶è¿Ÿ: <1ç§’
- åå: 100K+ events/s
- ç”¨é€”: å®æ—¶å‘Šè­¦ã€å¼‚å¸¸æ£€æµ‹

**æ‰¹å¤„ç†åˆ†æ (Apache Spark)**:

- å»¶è¿Ÿ: åˆ†é’Ÿçº§-å°æ—¶çº§
- åå: TBçº§æ•°æ®
- ç”¨é€”: è¶‹åŠ¿åˆ†æã€æŠ¥è¡¨ç”Ÿæˆ

**å¢é‡è®¡ç®—**:

- t-digest: P99å»¶è¿Ÿè®¡ç®—
- HyperLogLog: åŸºæ•°ä¼°è®¡
- Count-Min Sketch: é¢‘ç‡ç»Ÿè®¡

---

#### é˜¶æ®µ7: æ•°æ®æŸ¥è¯¢ä¸å¯è§†åŒ–

**å®æ—¶ç›‘æ§ (Grafana)**:

- æ•°æ®æº: Prometheus + Tempo
- æ›´æ–°é¢‘ç‡: 1-15ç§’
- ç”¨é€”: è¿ç»´ç›‘æ§

**æ—¥å¿—æŸ¥è¯¢ (Kibana)**:

- æ•°æ®æº: Elasticsearch
- åŠŸèƒ½: å…¨æ–‡æœç´¢ã€æ—¥å¿—åˆ°Traceè·³è½¬

**Ad-hocåˆ†æ (Presto/ClickHouse)**:

- äº¤äº’å¼SQLæŸ¥è¯¢
- å¤šç»´åº¦èšåˆåˆ†æ

---

## å›¾è¡¨2: OTLPä¸‰å±‚è¯­ä¹‰æ¨¡å‹ç»“æ„å›¾

```mermaid
graph TB
    subgraph "ç¬¬ä¸€å±‚: Resource Model èµ„æºæ¨¡å‹"
        R1[service.name<br/>service.version<br/>service.namespace]
        R2[deployment.environment<br/>service.instance.id]
        R3[telemetry.sdk.name<br/>telemetry.sdk.version]
        R4[å¹³å°å±æ€§<br/>host.* / container.* / k8s.* / cloud.*]
        
        R1 --> RM[Resource å¯¹è±¡]
        R2 --> RM
        R3 --> RM
        R4 --> RM
    end
    
    subgraph "ç¬¬äºŒå±‚: Instrumentation Scope ä»ªå™¨åŒ–ä½œç”¨åŸŸ"
        IS1[name: string<br/>library/instrumentationåç§°]
        IS2[version: string<br/>åº“ç‰ˆæœ¬å·]
        IS3[schema_url: string<br/>è¯­ä¹‰çº¦å®šç‰ˆæœ¬URL]
        IS4[attributes: Map<br/>ä½œç”¨åŸŸçº§åˆ«å±æ€§]
        
        IS1 --> ISM[InstrumentationScope å¯¹è±¡]
        IS2 --> ISM
        IS3 --> ISM
        IS4 --> ISM
    end
    
    subgraph "ç¬¬ä¸‰å±‚: Telemetry Data Model é¥æµ‹æ•°æ®æ¨¡å‹"
        subgraph "Trace Model"
            T1[Spanå¯¹è±¡]
            T2[trace_id<br/>span_id<br/>parent_span_id]
            T3[name<br/>kind<br/>start_time<br/>end_time]
            T4[attributes<br/>events<br/>links<br/>status]
            T1 --> T2
            T1 --> T3
            T1 --> T4
        end
        
        subgraph "Metric Model"
            M1[Metricå¯¹è±¡]
            M2[name<br/>description<br/>unit]
            M3[type: Sum/Gauge/<br/>Histogram/<br/>ExponentialHistogram]
            M4[data_points:<br/>value<br/>attributes<br/>timestamp]
            M1 --> M2
            M1 --> M3
            M1 --> M4
        end
        
        subgraph "Log Model"
            L1[LogRecordå¯¹è±¡]
            L2[timestamp<br/>observed_timestamp]
            L3[severity_number<br/>severity_text]
            L4[body<br/>attributes<br/>trace_id<br/>span_id]
            L1 --> L2
            L1 --> L3
            L1 --> L4
        end
    end
    
    RM -.ä¸€ä¸ªResourceåŒ…å«å¤šä¸ª.-> ISM
    ISM -.ä¸€ä¸ªScopeäº§ç”Ÿå¤šä¸ª.-> T1
    ISM -.ä¸€ä¸ªScopeäº§ç”Ÿå¤šä¸ª.-> M1
    ISM -.ä¸€ä¸ªScopeäº§ç”Ÿå¤šä¸ª.-> L1
    
    style RM fill:#e3f2fd
    style ISM fill:#fff3e0
    style T1 fill:#e8f5e9
    style M1 fill:#fce4ec
    style L1 fill:#f3e5f5
```

### 2.1 å±‚æ¬¡å…³ç³»è¯´æ˜

**å…³ç³»æè¿°**:

```text
1ä¸ªåº”ç”¨è¿›ç¨‹
  â””â”€ 1ä¸ª Resource (è¿›ç¨‹çº§åˆ«ï¼Œå¯åŠ¨æ—¶ç¡®å®š)
       â”œâ”€ Nä¸ª InstrumentationScope (ä¸åŒåº“/æ¡†æ¶)
       â”‚    â”œâ”€ Scope 1: "io.opentelemetry.api" v1.30.0
       â”‚    â”‚    â”œâ”€ Mä¸ª Span
       â”‚    â”‚    â”œâ”€ Kä¸ª Metric
       â”‚    â”‚    â””â”€ Pä¸ª LogRecord
       â”‚    â”‚
       â”‚    â”œâ”€ Scope 2: "com.mycompany.custom" v1.0.0
       â”‚    â”‚    â”œâ”€ ...
       â”‚    â”‚
       â”‚    â””â”€ Scope N: ...
```

**ç”Ÿå‘½å‘¨æœŸ**:

- **Resource**: è¿›ç¨‹å¯åŠ¨æ—¶åˆ›å»ºï¼Œè¿è¡ŒæœŸä¸å˜
- **InstrumentationScope**: åº“åŠ è½½æ—¶åˆ›å»ºï¼Œé€šå¸¸ä¸å˜
- **Telemetry Data**: è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆ

---

## å›¾è¡¨3: Collectorå¤„ç†æµç¨‹è¯¦ç»†å›¾

```mermaid
graph LR
    subgraph "æ¥æ”¶å™¨ Receivers"
        RCV1[OTLP/gRPC<br/>:4317]
        RCV2[OTLP/HTTP<br/>:4318]
        RCV3[Jaeger<br/>:14250]
        RCV4[Prometheus<br/>:8889]
    end
    
    subgraph "å¤„ç†å™¨ Processors Pipeline"
        direction TB
        P1[1. batch<br/>æ‰¹å¤„ç†èšåˆ]
        P2[2. resourcedetection<br/>äº‘å¹³å°å±æ€§æ£€æµ‹]
        P3[3. attributes<br/>å±æ€§è½¬æ¢/åˆ é™¤/å“ˆå¸Œ]
        P4[4. resource<br/>èµ„æºå±æ€§åˆå¹¶]
        P5[5. filter<br/>æ•°æ®è¿‡æ»¤/é‡‡æ ·]
        P6[6. spanmetrics<br/>ä»Spanç”ŸæˆMetric]
        P7[7. tail_sampling<br/>å°¾éƒ¨é‡‡æ ·å†³ç­–]
        
        P1 --> P2
        P2 --> P3
        P3 --> P4
        P4 --> P5
        P5 --> P6
        P6 --> P7
    end
    
    subgraph "å¯¼å‡ºå™¨ Exporters"
        EXP1[OTLP/Jaeger<br/>Traceåç«¯]
        EXP2[Prometheus<br/>Metricåç«¯]
        EXP3[Elasticsearch<br/>Logåç«¯]
        EXP4[Kafka<br/>æ¶ˆæ¯é˜Ÿåˆ—]
        EXP5[S3<br/>å½’æ¡£å­˜å‚¨]
    end
    
    RCV1 --> P1
    RCV2 --> P1
    RCV3 --> P1
    RCV4 --> P1
    
    P7 --> EXP1
    P7 --> EXP2
    P7 --> EXP3
    P7 --> EXP4
    P7 --> EXP5
    
    style P1 fill:#e3f2fd
    style P3 fill:#ffebee
    style P7 fill:#f3e5f5
```

### 3.1 å¤„ç†å™¨è¯¦ç»†è¯´æ˜

#### å¤„ç†å™¨1: batch (æ‰¹å¤„ç†)

**é…ç½®**:

```yaml
batch:
  timeout: 1s
  send_batch_size: 512
  send_batch_max_size: 1024
```

**åŠŸèƒ½**:

- èšåˆå¤šä¸ªspan/metric/logä¸ºbatch
- å‡å°‘ç½‘ç»œè°ƒç”¨æ¬¡æ•°
- æå‡ååé‡50-100%

---

#### å¤„ç†å™¨2: resourcedetection (èµ„æºæ£€æµ‹)

**é…ç½®**:

```yaml
resourcedetection:
  detectors: [env, system, docker, ec2, ecs, gcp, azure]
  timeout: 5s
  override: false
```

**è‡ªåŠ¨æ·»åŠ å±æ€§**:

```text
AWS EC2:
  cloud.provider: "aws"
  cloud.platform: "aws_ec2"
  cloud.region: "us-east-1"
  cloud.account.id: "123456789012"
  host.id: "i-0123456789abcdef0"

Kubernetes:
  k8s.cluster.name: "prod-cluster"
  k8s.namespace.name: "default"
  k8s.pod.name: "order-service-7d4f8b9c-xk2lp"
  k8s.deployment.name: "order-service"
  container.id: "abc123..."
```

---

#### å¤„ç†å™¨3: attributes (å±æ€§å¤„ç†)

**é…ç½®ç¤ºä¾‹**:

```yaml
attributes:
  actions:
    # é‡å‘½åï¼ˆå‘åå…¼å®¹ï¼‰
    - key: http.method
      action: update
      from_attribute: http.request.method
    
    # åˆ é™¤æ•æ„Ÿæ•°æ®
    - key: http.request.header.authorization
      action: delete
    
    - key: http.request.header.cookie
      action: delete
    
    # PIIå“ˆå¸ŒåŒ–
    - key: user.email
      action: hash
    
    - key: user.phone
      action: hash
    
    # æ·»åŠ å›ºå®šæ ‡ç­¾
    - key: deployment.environment
      value: "production"
      action: insert
    
    # æ­£åˆ™æå–
    - key: http.target
      pattern: ^/api/v(\d+)/.*
      action: extract
      to_attribute: api.version
```

---

#### å¤„ç†å™¨7: tail_sampling (å°¾éƒ¨é‡‡æ ·)

**é…ç½®ç¤ºä¾‹**:

```yaml
tail_sampling:
  decision_wait: 10s
  num_traces: 100000
  expected_new_traces_per_sec: 1000
  
  policies:
    # ç­–ç•¥1: æ‰€æœ‰é”™è¯¯trace
    - name: error-policy
      type: status_code
      status_code:
        status_codes: [ERROR]
    
    # ç­–ç•¥2: æ…¢trace (>2ç§’)
    - name: slow-trace-policy
      type: latency
      latency:
        threshold_ms: 2000
    
    # ç­–ç•¥3: VIPç”¨æˆ· (100%é‡‡æ ·)
    - name: vip-user-policy
      type: attribute
      attribute:
        key: myshop.user.tier
        values: [platinum, gold]
    
    # ç­–ç•¥4: åŒ…å«ç‰¹å®šspanåç§°
    - name: important-operation-policy
      type: span_name
      span_name:
        name_patterns: ["payment", "checkout"]
    
    # ç­–ç•¥5: æ™®é€šæµé‡ (1%æ¦‚ç‡é‡‡æ ·)
    - name: general-traffic-policy
      type: probabilistic
      probabilistic:
        sampling_percentage: 1
```

**é‡‡æ ·æ•ˆæœ**:

```text
è¾“å…¥: 10M traces/å¤©
â”œâ”€ é”™è¯¯trace (1%): 100K â†’ 100% ä¿ç•™ = 100K
â”œâ”€ æ…¢trace (0.5%): 50K â†’ 100% ä¿ç•™ = 50K
â”œâ”€ VIPç”¨æˆ· (5%): 500K â†’ 100% ä¿ç•™ = 500K
â”œâ”€ é‡è¦æ“ä½œ (2%): 200K â†’ 100% ä¿ç•™ = 200K
â””â”€ æ™®é€šæµé‡ (91.5%): 9.15M â†’ 1% é‡‡æ · = 91.5K

è¾“å‡º: 941.5K traces/å¤© (ä»…9.4%ï¼Œä½†åŒ…å«99.9%å…³é”®ä¿¡æ¯)
å­˜å‚¨æˆæœ¬: $1M/æœˆ â†’ $94K/æœˆ (èŠ‚çœ90.6%)
```

---

## å›¾è¡¨4: å¤šåç«¯å­˜å‚¨æ¶æ„å›¾

```mermaid
graph TB
    subgraph "OTLP Collector"
        COL[Collector<br/>ç»Ÿä¸€å…¥å£]
    end
    
    subgraph "Traceå­˜å‚¨"
        T1[Jaeger<br/>åˆ†å¸ƒå¼è¿½è¸ªUI]
        T2[Tempo<br/>å¤§è§„æ¨¡Traceå­˜å‚¨]
        T3[Zipkin<br/>å…¼å®¹åç«¯]
    end
    
    subgraph "Metricå­˜å‚¨"
        M1[Prometheus<br/>æ—¶åºæ•°æ®åº“]
        M2[VictoriaMetrics<br/>é«˜æ€§èƒ½TSDB]
        M3[Thanos<br/>é•¿æœŸå­˜å‚¨]
    end
    
    subgraph "Logå­˜å‚¨"
        L1[Elasticsearch<br/>å…¨æ–‡æœç´¢]
        L2[Loki<br/>è½»é‡çº§æ—¥å¿—]
        L3[Splunk<br/>ä¼ä¸šçº§SIEM]
    end
    
    subgraph "ç»Ÿä¸€å­˜å‚¨"
        U1[ClickHouse<br/>OLAPåˆ†æ]
        U2[PostgreSQL<br/>å…³ç³»å‹æŸ¥è¯¢]
        U3[S3/GCS<br/>å¯¹è±¡å­˜å‚¨å½’æ¡£]
    end
    
    subgraph "æ¶ˆæ¯é˜Ÿåˆ—"
        Q1[Kafka<br/>æ•°æ®ç¼“å†²]
        Q2[Redis<br/>å¿«é€Ÿç¼“å­˜]
    end
    
    COL -->|traces| T1
    COL -->|traces| T2
    COL -->|traces| T3
    
    COL -->|metrics| M1
    COL -->|metrics| M2
    COL -->|metrics| M3
    
    COL -->|logs| L1
    COL -->|logs| L2
    COL -->|logs| L3
    
    COL -->|all signals| U1
    COL -->|all signals| U2
    COL -->|all signals| U3
    
    COL -->|buffer| Q1
    COL -->|cache| Q2
    
    T2 -.é•¿æœŸå­˜å‚¨.-> U3
    M3 -.é•¿æœŸå­˜å‚¨.-> U3
    L2 -.é•¿æœŸå­˜å‚¨.-> U3
    
    Q1 -.å»¶è¿Ÿå¤„ç†.-> U1
    
    style COL fill:#e3f2fd
    style T2 fill:#e8f5e9
    style M1 fill:#fff3e0
    style L1 fill:#fce4ec
    style U1 fill:#f3e5f5
```

### 4.1 åç«¯é€‰æ‹©å»ºè®®

#### Traceåç«¯å¯¹æ¯”

| åç«¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **Jaeger** | UIä¼˜ç§€ï¼Œç¤¾åŒºæ´»è·ƒ | å­˜å‚¨æ‰©å±•æ€§æœ‰é™ | ä¸­å°è§„æ¨¡ï¼ˆ<1M traces/å¤©ï¼‰ |
| **Tempo** | æˆæœ¬ä½ï¼ŒS3å­˜å‚¨ | æŸ¥è¯¢åŠŸèƒ½è¾ƒå¼± | å¤§è§„æ¨¡ï¼ˆ>10M traces/å¤©ï¼‰ |
| **Zipkin** | è½»é‡çº§ï¼Œæ˜“éƒ¨ç½² | åŠŸèƒ½ç›¸å¯¹ç®€å• | å¼€å‘æµ‹è¯•ç¯å¢ƒ |

#### Metricåç«¯å¯¹æ¯”

| åç«¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **Prometheus** | ç”Ÿæ€æœ€æˆç†Ÿ | å•æœºæ‰©å±•æ€§æœ‰é™ | æ ‡å‡†ç›‘æ§ï¼ˆ<10M seriesï¼‰ |
| **VictoriaMetrics** | é«˜æ€§èƒ½ï¼Œä½æˆæœ¬ | ç¤¾åŒºè¾ƒå° | å¤§è§„æ¨¡ï¼ˆ>100M seriesï¼‰ |
| **Thanos** | é•¿æœŸå­˜å‚¨ | å¤æ‚åº¦è¾ƒé«˜ | å¤šé›†ç¾¤ã€é•¿æœŸè¶‹åŠ¿åˆ†æ |

#### Logåç«¯å¯¹æ¯”

| åç«¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **Elasticsearch** | å…¨æ–‡æœç´¢å¼ºå¤§ | æˆæœ¬è¾ƒé«˜ | éœ€è¦å¤æ‚æŸ¥è¯¢ï¼ˆ<100GB/å¤©ï¼‰ |
| **Loki** | æˆæœ¬ä½ï¼Œä¸Grafanaé›†æˆ | æŸ¥è¯¢åŠŸèƒ½æœ‰é™ | æ—¥å¿—é‡å¤§ï¼ŒæŸ¥è¯¢ç®€å• |
| **Splunk** | ä¼ä¸šçº§åŠŸèƒ½å…¨é¢ | ä»·æ ¼æ˜‚è´µ | å¤§å‹ä¼ä¸šï¼Œåˆè§„è¦æ±‚é«˜ |

---

## å›¾è¡¨5: æ•°æ®æ¨¡å‹å¯¹åº”å…³ç³»å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®æ¨¡å‹"
        U1[ç”µå•†è®¢å•æ¨¡å‹]
        U2[é‡‘èäº¤æ˜“æ¨¡å‹]
        U3[IoTè®¾å¤‡æ¨¡å‹]
        
        U1 --> U1A[order_id<br/>status<br/>total_amount<br/>user_tier]
        U2 --> U2A[transaction_id<br/>amount<br/>risk_score<br/>fraud_detected]
        U3 --> U3A[device_id<br/>sensor_data<br/>location<br/>battery_level]
    end
    
    subgraph "è¯­ä¹‰çº¦å®šæ˜ å°„"
        S1[æ ‡å‡†å±æ€§<br/>Semantic Conventions]
        S2[vendorå‰ç¼€<br/>è‡ªå®šä¹‰å±æ€§]
        
        S1 --> S1A[http.request.method<br/>http.response.status_code<br/>service.name<br/>db.system]
        S2 --> S2A[mycompany.order.id<br/>fintech.transaction.id<br/>iot.device.id]
    end
    
    subgraph "OTLPä¸‰å±‚æ¨¡å‹"
        O1[Resource]
        O2[InstrumentationScope]
        O3[Span Attributes]
        
        O1 --> O1A[service.name<br/>deployment.environment<br/>host.name]
        O2 --> O2A[name<br/>version<br/>schema_url]
        O3 --> O3A[æ ‡å‡†å±æ€§ +<br/>è‡ªå®šä¹‰å±æ€§]
    end
    
    U1A -.æ˜ å°„.-> S2A
    U2A -.æ˜ å°„.-> S2A
    U3A -.æ˜ å°„.-> S2A
    
    S1A -.åº”ç”¨.-> O3A
    S2A -.åº”ç”¨.-> O3A
    
    style U1 fill:#e1f5ff
    style S1 fill:#fff4e1
    style O3 fill:#e1ffe1
```

---

## å›¾è¡¨6: Collectoréƒ¨ç½²æ¶æ„å›¾

### 6.1 åŸºç¡€æ¶æ„ï¼ˆå•é›†ç¾¤ï¼‰

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        APP1[Service A]
        APP2[Service B]
        APP3[Service C]
    end
    
    subgraph "Agent Collector DaemonSet"
        AG1[Agent on Node 1]
        AG2[Agent on Node 2]
        AG3[Agent on Node 3]
    end
    
    subgraph "Gateway Collector Deployment"
        GW1[Gateway 1]
        GW2[Gateway 2]
        GW3[Gateway 3]
        LB[Load Balancer]
    end
    
    subgraph "åç«¯å­˜å‚¨"
        BE1[Jaeger]
        BE2[Prometheus]
        BE3[Elasticsearch]
    end
    
    APP1 --> AG1
    APP2 --> AG2
    APP3 --> AG3
    
    AG1 --> LB
    AG2 --> LB
    AG3 --> LB
    
    LB --> GW1
    LB --> GW2
    LB --> GW3
    
    GW1 --> BE1
    GW1 --> BE2
    GW1 --> BE3
    GW2 --> BE1
    GW2 --> BE2
    GW2 --> BE3
    GW3 --> BE1
    GW3 --> BE2
    GW3 --> BE3
    
    style AG1 fill:#e3f2fd
    style GW2 fill:#fff3e0
    style BE2 fill:#e8f5e9
```

### 6.2 æ··åˆäº‘æ¶æ„

```mermaid
graph TB
    subgraph "AWSé›†ç¾¤"
        AWS_APP[AWS Services]
        AWS_AG[Agent Collectors]
        AWS_GW[Gateway Collectors]
    end
    
    subgraph "Azureé›†ç¾¤"
        AZ_APP[Azure Services]
        AZ_AG[Agent Collectors]
        AZ_GW[Gateway Collectors]
    end
    
    subgraph "GCPé›†ç¾¤"
        GCP_APP[GCP Services]
        GCP_AG[Agent Collectors]
        GCP_GW[Gateway Collectors]
    end
    
    subgraph "ä¸­å¿ƒåŒ–å­˜å‚¨"
        CENTRAL[Central Collector<br/>Kafkaç¼“å†²]
        TEMPO[Tempo<br/>S3å­˜å‚¨]
        THANOS[Thanos<br/>é•¿æœŸMetric]
        ES[Elasticsearch<br/>ä¸­å¿ƒåŒ–Log]
    end
    
    AWS_APP --> AWS_AG
    AWS_AG --> AWS_GW
    
    AZ_APP --> AZ_AG
    AZ_AG --> AZ_GW
    
    GCP_APP --> GCP_AG
    GCP_AG --> GCP_GW
    
    AWS_GW --> CENTRAL
    AZ_GW --> CENTRAL
    GCP_GW --> CENTRAL
    
    CENTRAL --> TEMPO
    CENTRAL --> THANOS
    CENTRAL --> ES
    
    style CENTRAL fill:#f3e5f5
```

---

## å›¾è¡¨7: æˆç†Ÿæ¡ˆä¾‹æ¶æ„å›¾

### 7.1 Uberæ¶æ„

```mermaid
graph TB
    subgraph "ç§»åŠ¨ç«¯"
        M1[Rider App<br/>100M+ DAU]
        M2[Driver App<br/>10M+ DAU]
    end
    
    subgraph "åç«¯æœåŠ¡"
        SVC[2000+ å¾®æœåŠ¡<br/>500K+ QPS]
    end
    
    subgraph "Regional Collector"
        R1[ç¾æ´²åŒºåŸŸ]
        R2[æ¬§æ´²åŒºåŸŸ]
        R3[äºšå¤ªåŒºåŸŸ]
    end
    
    subgraph "Central Pipeline"
        CP1[Head-basedé‡‡æ ·<br/>1%ä¿ç•™]
        CP2[Tail-basedé‡‡æ ·<br/>å¼‚å¸¸100%ä¿ç•™]
        CP3[Spanâ†’Metricè½¬æ¢]
    end
    
    subgraph "å¤šå±‚å­˜å‚¨"
        ST1[çƒ­æ•°æ® 7å¤©<br/>Cassandra]
        ST2[æ¸©æ•°æ® 30å¤©<br/>HDFS+Parquet]
        ST3[å†·æ•°æ® >30å¤©<br/>S3 Glacier]
    end
    
    subgraph "æŸ¥è¯¢å±‚"
        Q1[å®æ—¶ç›‘æ§<br/>Grafana]
        Q2[Ad-hocæŸ¥è¯¢<br/>Presto]
        Q3[MLè®­ç»ƒ<br/>Spark MLlib]
    end
    
    M1 --> R1
    M2 --> R1
    SVC --> R1
    SVC --> R2
    SVC --> R3
    
    R1 --> CP1
    R2 --> CP1
    R3 --> CP1
    
    CP1 --> CP2
    CP2 --> CP3
    
    CP3 --> ST1
    CP3 --> ST2
    CP3 --> ST3
    
    ST1 --> Q1
    ST2 --> Q2
    ST3 --> Q3
    
    style CP2 fill:#ffebee
    style ST1 fill:#e8f5e9
```

**å…³é”®æ•°æ®**:

- æ¯å¤©é‡‡é›†: 50äº¿+ Spans
- é‡‡æ ·åä¿ç•™: 5åƒä¸‡ Spans (1%)
- ä½†ä¿ç•™äº†: 99.9%çš„é”™è¯¯å’Œå¼‚å¸¸
- å­˜å‚¨æˆæœ¬: ä»$500K/æœˆé™è‡³$5K/æœˆ

---

## ä½¿ç”¨æŒ‡å—

### å¦‚ä½•ä½¿ç”¨è¿™äº›å›¾è¡¨

1. **å­¦ä¹ ç†è§£**:
   - å›¾è¡¨1: ç†è§£æ•´ä¸ªæ•°æ®ç”Ÿå‘½å‘¨æœŸ
   - å›¾è¡¨2: ç†è§£OTLPæ•°æ®æ¨¡å‹ç»“æ„
   - å›¾è¡¨3: ç†è§£Collectorå¤„ç†é€»è¾‘

2. **æ¶æ„è®¾è®¡**:
   - å›¾è¡¨4: é€‰æ‹©åˆé€‚çš„åç«¯å­˜å‚¨
   - å›¾è¡¨6: è®¾è®¡Collectoréƒ¨ç½²æ¶æ„

3. **å®é™…åº”ç”¨**:
   - å›¾è¡¨5: è®¾è®¡è‡ªå®šä¹‰æ•°æ®æ¨¡å‹
   - å›¾è¡¨7: å‚è€ƒæˆç†Ÿæ¡ˆä¾‹

### é…å¥—æ–‡æ¡£

| æ–‡æ¡£ | é“¾æ¥ | è¯´æ˜ |
|------|------|------|
| **æ•°æ®æ¨¡å‹æŒ‡å—** | [ğŸ“Š_æ•°æ®æ¨¡å‹ä¸è¯­ä¹‰è½¬æ¢å®Œæ•´æŒ‡å—_2025_10_20.md](ğŸ“Š_æ•°æ®æ¨¡å‹ä¸è¯­ä¹‰è½¬æ¢å®Œæ•´æŒ‡å—_2025_10_20.md) | è¯¦ç»†æ–‡å­—è¯´æ˜ |
| **å¯¹æ ‡åˆ†ææŠ¥å‘Š** | [ğŸ“Š_OTLPé¡¹ç›®2025å¹´10æœˆ20æ—¥å…¨é¢å¯¹æ ‡åˆ†ææŠ¥å‘Š.md](ğŸ“Š_OTLPé¡¹ç›®2025å¹´10æœˆ20æ—¥å…¨é¢å¯¹æ ‡åˆ†ææŠ¥å‘Š.md) | æ ‡å‡†ç¬¦åˆæ€§åˆ†æ |
| **æ¨è¿›è®¡åˆ’** | [ğŸš€_OTLPé¡¹ç›®æŒç»­æ¨è¿›è®¡åˆ’_2025_10_20.md](ğŸš€_OTLPé¡¹ç›®æŒç»­æ¨è¿›è®¡åˆ’_2025_10_20.md) | åç»­å·¥ä½œè®¡åˆ’ |

---

## æ€»ç»“

æœ¬æ–‡æ¡£æä¾›äº†7ä¸ªæ ¸å¿ƒå¯è§†åŒ–å›¾è¡¨ï¼Œå…¨é¢å±•ç¤ºäº†OTLPæ•°æ®æ¨¡å‹å’Œç”Ÿå‘½å‘¨æœŸï¼š

âœ… **å›¾è¡¨1**: æ•°æ®ç”Ÿå‘½å‘¨æœŸå®Œæ•´æµç¨‹ï¼ˆ7ä¸ªé˜¶æ®µï¼‰  
âœ… **å›¾è¡¨2**: OTLPä¸‰å±‚è¯­ä¹‰æ¨¡å‹ç»“æ„  
âœ… **å›¾è¡¨3**: Collectorå¤„ç†æµç¨‹è¯¦ç»†å›¾  
âœ… **å›¾è¡¨4**: å¤šåç«¯å­˜å‚¨æ¶æ„  
âœ… **å›¾è¡¨5**: æ•°æ®æ¨¡å‹å¯¹åº”å…³ç³»  
âœ… **å›¾è¡¨6**: Collectoréƒ¨ç½²æ¶æ„ï¼ˆå•é›†ç¾¤+æ··åˆäº‘ï¼‰  
âœ… **å›¾è¡¨7**: æˆç†Ÿæ¡ˆä¾‹æ¶æ„ï¼ˆUberï¼‰

è¿™äº›å›¾è¡¨é…åˆ[æ•°æ®æ¨¡å‹ä¸è¯­ä¹‰è½¬æ¢å®Œæ•´æŒ‡å—](ğŸ“Š_æ•°æ®æ¨¡å‹ä¸è¯­ä¹‰è½¬æ¢å®Œæ•´æŒ‡å—_2025_10_20.md)ä½¿ç”¨ï¼Œå¯ä»¥å¸®åŠ©æ‚¨ï¼š

- æ·±å…¥ç†è§£OTLPæ•°æ®æ¨¡å‹
- è®¾è®¡åˆç†çš„å¯è§‚æµ‹æ€§æ¶æ„
- å‚è€ƒæˆç†Ÿæ¡ˆä¾‹çš„æœ€ä½³å®è·µ

---

**åˆ›å»ºæ—¶é—´**: 2025å¹´10æœˆ20æ—¥  
**æ–‡æ¡£ä½œè€…**: OTLPé¡¹ç›®å›¢é˜Ÿ  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**å›¾è¡¨æ•°é‡**: 7ä¸ªæ ¸å¿ƒå›¾è¡¨ + å¤šä¸ªè¾…åŠ©è¯´æ˜

---

**ğŸ¨ å¯è§†åŒ–è®©å¤æ‚çš„æ¦‚å¿µå˜å¾—æ¸…æ™°ï¼** âœ¨
