# é‡‘èè¡Œä¸šOpenTelemetryè§£å†³æ–¹æ¡ˆ

## ğŸ¦ é‡‘èè¡Œä¸šæ¦‚è¿°

é‡‘èè¡Œä¸šå¯¹å¯è§‚æµ‹æ€§ç³»ç»Ÿæœ‰æé«˜çš„è¦æ±‚ï¼Œéœ€è¦æ»¡è¶³ä¸¥æ ¼çš„åˆè§„æ€§ã€å®‰å…¨æ€§å’Œå¯é æ€§æ ‡å‡†ã€‚æœ¬è§£å†³æ–¹æ¡ˆåŸºäºå›½é™…2025å¹´æœ€æ–°æ ‡å‡†ï¼Œä¸ºé‡‘èè¡Œä¸šæä¾›å®Œæ•´çš„OpenTelemetryå®æ–½æŒ‡å—ã€‚

---

## ğŸ“Š è¡Œä¸šç‰¹ç‚¹ä¸æŒ‘æˆ˜

### 1. ä¸šåŠ¡ç‰¹ç‚¹

#### 1.1 é«˜å¹¶å‘äº¤æ˜“

- **äº¤æ˜“é‡**: æ¯ç§’å¤„ç†æ•°ä¸‡ç¬”äº¤æ˜“
- **å»¶è¿Ÿè¦æ±‚**: æ¯«ç§’çº§å“åº”æ—¶é—´
- **å¯ç”¨æ€§**: 99.99%ä»¥ä¸Šå¯ç”¨æ€§
- **æ•°æ®ä¸€è‡´æ€§**: å¼ºä¸€è‡´æ€§è¦æ±‚

#### 1.2 å¤æ‚ä¸šåŠ¡æµç¨‹

- **å¤šç³»ç»Ÿé›†æˆ**: æ ¸å¿ƒé“¶è¡Œã€æ”¯ä»˜ã€é£æ§ç­‰ç³»ç»Ÿ
- **å®æ—¶å¤„ç†**: å®æ—¶é£æ§ã€å®æ—¶æ¸…ç®—
- **æ‰¹å¤„ç†**: æ—¥ç»ˆæ‰¹å¤„ç†ã€æŠ¥è¡¨ç”Ÿæˆ
- **è·¨ç³»ç»Ÿè°ƒç”¨**: å¤æ‚çš„æœåŠ¡è°ƒç”¨é“¾

### 2. æŠ€æœ¯æŒ‘æˆ˜

#### 2.1 æ€§èƒ½æŒ‘æˆ˜

- **é«˜å¹¶å‘**: æ”¯æŒå¤§è§„æ¨¡å¹¶å‘è®¿é—®
- **ä½å»¶è¿Ÿ**: æ¯«ç§’çº§å“åº”æ—¶é—´è¦æ±‚
- **é«˜åå**: å¤„ç†å¤§é‡äº¤æ˜“æ•°æ®
- **èµ„æºä¼˜åŒ–**: æœ€å¤§åŒ–èµ„æºåˆ©ç”¨ç‡

#### 2.2 å®‰å…¨æŒ‘æˆ˜

- **æ•°æ®ä¿æŠ¤**: æ•æ„Ÿé‡‘èæ•°æ®ä¿æŠ¤
- **è®¿é—®æ§åˆ¶**: ä¸¥æ ¼çš„æƒé™ç®¡ç†
- **å®¡è®¡åˆè§„**: å®Œæ•´çš„æ“ä½œå®¡è®¡
- **å¨èƒé˜²æŠ¤**: å®æ—¶å®‰å…¨ç›‘æ§

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆæ¶æ„

### 1. æ•´ä½“æ¶æ„è®¾è®¡

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é‡‘èè¡Œä¸šå¯è§‚æµ‹æ€§å¹³å°                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åº”ç”¨å±‚    â”‚ äº¤æ˜“ç³»ç»Ÿ â”‚ é£æ§ç³»ç»Ÿ â”‚ æ”¯ä»˜ç³»ç»Ÿ â”‚ æ ¸å¿ƒé“¶è¡Œç³»ç»Ÿ  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœåŠ¡å±‚    â”‚ å¾®æœåŠ¡ç½‘å…³ â”‚ æœåŠ¡ç½‘æ ¼ â”‚ APIç½‘å…³ â”‚ è´Ÿè½½å‡è¡¡å™¨   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚    â”‚ äº¤æ˜“æ•°æ® â”‚ ç”¨æˆ·æ•°æ® â”‚ é£æ§æ•°æ® â”‚ å®¡è®¡æ•°æ®     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºç¡€è®¾æ–½å±‚ â”‚ å®¹å™¨å¹³å° â”‚ æ•°æ®åº“ â”‚ æ¶ˆæ¯é˜Ÿåˆ— â”‚ å­˜å‚¨ç³»ç»Ÿ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç›‘æ§å±‚    â”‚ OpenTelemetry â”‚ æŒ‡æ ‡ç›‘æ§ â”‚ æ—¥å¿—åˆ†æ â”‚ è¿½è¸ªç³»ç»Ÿ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒç»„ä»¶

#### 2.1 æ•°æ®æ”¶é›†å±‚

- **SDKé›†æˆ**: è‡ªåŠ¨æ£€æµ‹å’Œæ‰‹åŠ¨åŸ‹ç‚¹
- **æ•°æ®æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„OTLPåè®®
- **æ•°æ®è¿‡æ»¤**: æ•æ„Ÿæ•°æ®è„±æ•
- **æ•°æ®å‹ç¼©**: é«˜æ•ˆæ•°æ®ä¼ è¾“

#### 2.2 æ•°æ®å¤„ç†å±‚

- **å®æ—¶å¤„ç†**: æµå¼æ•°æ®å¤„ç†
- **æ‰¹å¤„ç†**: æ‰¹é‡æ•°æ®åˆ†æ
- **æ•°æ®èšåˆ**: å¤šç»´åº¦æ•°æ®èšåˆ
- **æ•°æ®è·¯ç”±**: æ™ºèƒ½æ•°æ®è·¯ç”±

#### 2.3 æ•°æ®å­˜å‚¨å±‚

- **æ—¶åºæ•°æ®åº“**: æŒ‡æ ‡æ•°æ®å­˜å‚¨
- **å›¾æ•°æ®åº“**: å…³ç³»æ•°æ®å­˜å‚¨
- **å¯¹è±¡å­˜å‚¨**: æ—¥å¿—æ•°æ®å­˜å‚¨
- **ç¼“å­˜ç³»ç»Ÿ**: çƒ­ç‚¹æ•°æ®ç¼“å­˜

#### 2.4 æ•°æ®å±•ç¤ºå±‚

- **å®æ—¶ä»ªè¡¨æ¿**: ä¸šåŠ¡ç›‘æ§é¢æ¿
- **å‘Šè­¦ç³»ç»Ÿ**: æ™ºèƒ½å‘Šè­¦æœºåˆ¶
- **æŠ¥è¡¨ç³»ç»Ÿ**: åˆè§„æŠ¥è¡¨ç”Ÿæˆ
- **åˆ†æå·¥å…·**: æ•°æ®æŒ–æ˜åˆ†æ

---

## ğŸ”§ æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 1. æ ¸å¿ƒé“¶è¡Œç³»ç»Ÿç›‘æ§

#### 1.1 è´¦æˆ·ç®¡ç†ç›‘æ§

```yaml
# è´¦æˆ·ç®¡ç†æœåŠ¡ç›‘æ§é…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: account-service-monitoring
data:
  otel-config.yaml: |
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318
    
    processors:
      batch:
        timeout: 1s
        send_batch_size: 1024
      resource:
        attributes:
          - key: service.name
            value: account-service
            action: upsert
          - key: service.version
            value: "1.0.0"
            action: upsert
      span:
        name:
          to_attributes:
            rules: ["^/api/v1/accounts/(?P<account_id>.*?)/(?P<operation>.*?)$"]
    
    exporters:
      jaeger:
        endpoint: jaeger:14250
        tls:
          insecure: false
      prometheus:
        endpoint: "0.0.0.0:8889"
        namespace: financial
        const_labels:
          environment: production
          service_type: core_banking
    
    service:
      pipelines:
        traces:
          receivers: [otlp]
          processors: [resource, span, batch]
          exporters: [jaeger]
        metrics:
          receivers: [otlp]
          processors: [resource, batch]
          exporters: [prometheus]
```

#### 1.2 äº¤æ˜“å¤„ç†ç›‘æ§

```go
// äº¤æ˜“å¤„ç†æœåŠ¡ç›‘æ§ä»£ç 
package main

import (
    "context"
    "time"
    
    "go.opentelemetry.io/otel"
    "go.opentelemetry.io/otel/attribute"
    "go.opentelemetry.io/otel/metric"
    "go.opentelemetry.io/otel/trace"
)

type TransactionService struct {
    tracer    trace.Tracer
    meter     metric.Meter
    counter   metric.Int64Counter
    histogram metric.Float64Histogram
}

func NewTransactionService() *TransactionService {
    tracer := otel.Tracer("transaction-service")
    meter := otel.Meter("transaction-service")
    
    counter, _ := meter.Int64Counter(
        "transaction_processed_total",
        metric.WithDescription("Total number of transactions processed"),
    )
    
    histogram, _ := meter.Float64Histogram(
        "transaction_duration_seconds",
        metric.WithDescription("Transaction processing duration"),
        metric.WithUnit("s"),
    )
    
    return &TransactionService{
        tracer:    tracer,
        meter:     meter,
        counter:   counter,
        histogram: histogram,
    }
}

func (ts *TransactionService) ProcessTransaction(ctx context.Context, tx *Transaction) error {
    ctx, span := ts.tracer.Start(ctx, "process_transaction")
    defer span.End()
    
    start := time.Now()
    
    // æ·»åŠ äº¤æ˜“å±æ€§
    span.SetAttributes(
        attribute.String("transaction.id", tx.ID),
        attribute.String("transaction.type", tx.Type),
        attribute.Float64("transaction.amount", tx.Amount),
        attribute.String("account.from", tx.FromAccount),
        attribute.String("account.to", tx.ToAccount),
    )
    
    // å¤„ç†äº¤æ˜“é€»è¾‘
    err := ts.executeTransaction(ctx, tx)
    
    // è®°å½•æŒ‡æ ‡
    duration := time.Since(start).Seconds()
    ts.counter.Add(ctx, 1, metric.WithAttributes(
        attribute.String("status", getStatus(err)),
        attribute.String("type", tx.Type),
    ))
    ts.histogram.Record(ctx, duration, metric.WithAttributes(
        attribute.String("type", tx.Type),
    ))
    
    if err != nil {
        span.RecordError(err)
        span.SetStatus(codes.Error, err.Error())
    }
    
    return err
}
```

### 2. é£æ§ç³»ç»Ÿç›‘æ§

#### 2.1 å®æ—¶é£æ§ç›‘æ§

```python
# å®æ—¶é£æ§ç³»ç»Ÿç›‘æ§
import time
from opentelemetry import trace, metrics
from opentelemetry.exporter.otlp.proto.grpc.trace_exporter import OTLPSpanExporter
from opentelemetry.exporter.otlp.proto.grpc.metric_exporter import OTLPMetricExporter
from opentelemetry.sdk.trace import TracerProvider
from opentelemetry.sdk.metrics import MeterProvider
from opentelemetry.sdk.trace.export import BatchSpanProcessor
from opentelemetry.sdk.metrics.export import PeriodicExportingMetricReader

class RiskControlService:
    def __init__(self):
        # åˆå§‹åŒ–è¿½è¸ª
        self.tracer = trace.get_tracer(__name__)
        
        # åˆå§‹åŒ–æŒ‡æ ‡
        self.meter = metrics.get_meter(__name__)
        self.risk_counter = self.meter.create_counter(
            name="risk_checks_total",
            description="Total number of risk checks performed"
        )
        self.risk_histogram = self.meter.create_histogram(
            name="risk_check_duration_seconds",
            description="Risk check processing duration"
        )
        self.risk_score_gauge = self.meter.create_up_down_counter(
            name="risk_score_current",
            description="Current risk score"
        )
    
    def check_risk(self, transaction):
        with self.tracer.start_as_current_span("risk_check") as span:
            start_time = time.time()
            
            # æ·»åŠ é£æ§å±æ€§
            span.set_attributes({
                "transaction.id": transaction.id,
                "transaction.amount": transaction.amount,
                "user.id": transaction.user_id,
                "risk.type": transaction.risk_type
            })
            
            try:
                # æ‰§è¡Œé£æ§æ£€æŸ¥
                risk_score = self.calculate_risk_score(transaction)
                risk_level = self.determine_risk_level(risk_score)
                
                # è®°å½•æŒ‡æ ‡
                self.risk_counter.add(1, {
                    "risk_level": risk_level,
                    "check_type": transaction.risk_type
                })
                
                self.risk_score_gauge.add(risk_score, {
                    "user_id": transaction.user_id
                })
                
                span.set_attributes({
                    "risk.score": risk_score,
                    "risk.level": risk_level,
                    "risk.decision": "approved" if risk_level == "low" else "rejected"
                })
                
                return risk_level
                
            except Exception as e:
                span.record_exception(e)
                span.set_status(trace.Status(trace.StatusCode.ERROR, str(e)))
                raise
            finally:
                duration = time.time() - start_time
                self.risk_histogram.record(duration, {
                    "risk_type": transaction.risk_type
                })
```

### 3. æ”¯ä»˜ç³»ç»Ÿç›‘æ§

#### 3.1 æ”¯ä»˜ç½‘å…³ç›‘æ§

```yaml
# æ”¯ä»˜ç½‘å…³ç›‘æ§é…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: payment-gateway
spec:
  replicas: 3
  selector:
    matchLabels:
      app: payment-gateway
  template:
    metadata:
      labels:
        app: payment-gateway
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "8080"
        prometheus.io/path: "/metrics"
    spec:
      containers:
      - name: payment-gateway
        image: payment-gateway:latest
        ports:
        - containerPort: 8080
        - containerPort: 4317
        - containerPort: 4318
        env:
        - name: OTEL_EXPORTER_OTLP_ENDPOINT
          value: "http://otel-collector:4317"
        - name: OTEL_SERVICE_NAME
          value: "payment-gateway"
        - name: OTEL_RESOURCE_ATTRIBUTES
          value: "service.name=payment-gateway,service.version=1.0.0,deployment.environment=production"
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
```

---

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡è®¾è®¡

### 1. ä¸šåŠ¡æŒ‡æ ‡

#### 1.1 äº¤æ˜“æŒ‡æ ‡

```yaml
# äº¤æ˜“ç›¸å…³æŒ‡æ ‡
transaction_processed_total:
  description: "Total number of transactions processed"
  type: counter
  labels:
    - status: "success|failed|pending"
    - type: "transfer|payment|withdrawal|deposit"
    - channel: "online|mobile|atm|branch"

transaction_amount_total:
  description: "Total transaction amount"
  type: counter
  labels:
    - currency: "USD|EUR|CNY"
    - type: "transfer|payment|withdrawal|deposit"

transaction_duration_seconds:
  description: "Transaction processing duration"
  type: histogram
  buckets: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1.0, 5.0]
  labels:
    - type: "transfer|payment|withdrawal|deposit"
```

#### 1.2 é£æ§æŒ‡æ ‡

```yaml
# é£æ§ç›¸å…³æŒ‡æ ‡
risk_checks_total:
  description: "Total number of risk checks performed"
  type: counter
  labels:
    - risk_level: "low|medium|high|critical"
    - check_type: "fraud|aml|kyc|sanctions"

risk_score_current:
  description: "Current risk score"
  type: gauge
  labels:
    - user_id: "user identifier"
    - risk_type: "fraud|aml|kyc"

risk_check_duration_seconds:
  description: "Risk check processing duration"
  type: histogram
  buckets: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1.0]
  labels:
    - check_type: "fraud|aml|kyc|sanctions"
```

### 2. æŠ€æœ¯æŒ‡æ ‡

#### 2.1 ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡

```yaml
# ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
http_requests_total:
  description: "Total HTTP requests"
  type: counter
  labels:
    - method: "GET|POST|PUT|DELETE"
    - status_code: "200|400|500"
    - endpoint: "API endpoint"

http_request_duration_seconds:
  description: "HTTP request duration"
  type: histogram
  buckets: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1.0, 5.0]
  labels:
    - method: "GET|POST|PUT|DELETE"
    - endpoint: "API endpoint"

database_connections_active:
  description: "Active database connections"
  type: gauge
  labels:
    - database: "database name"
    - pool: "connection pool name"
```

#### 2.2 èµ„æºä½¿ç”¨æŒ‡æ ‡

```yaml
# èµ„æºä½¿ç”¨æŒ‡æ ‡
cpu_usage_percent:
  description: "CPU usage percentage"
  type: gauge
  labels:
    - instance: "instance identifier"

memory_usage_bytes:
  description: "Memory usage in bytes"
  type: gauge
  labels:
    - instance: "instance identifier"

disk_usage_percent:
  description: "Disk usage percentage"
  type: gauge
  labels:
    - instance: "instance identifier"
    - mountpoint: "disk mount point"
```

---

## ğŸš¨ å‘Šè­¦è§„åˆ™è®¾è®¡

### 1. ä¸šåŠ¡å‘Šè­¦

#### 1.1 äº¤æ˜“å‘Šè­¦

```yaml
# äº¤æ˜“ç›¸å…³å‘Šè­¦
- alert: HighTransactionFailureRate
  expr: rate(transaction_processed_total{status="failed"}[5m]) / rate(transaction_processed_total[5m]) > 0.05
  for: 2m
  labels:
    severity: critical
    service: transaction
  annotations:
    summary: "High transaction failure rate detected"
    description: "Transaction failure rate is {{ $value | humanizePercentage }} for the last 5 minutes"

- alert: TransactionLatencyHigh
  expr: histogram_quantile(0.95, rate(transaction_duration_seconds_bucket[5m])) > 1.0
  for: 3m
  labels:
    severity: warning
    service: transaction
  annotations:
    summary: "High transaction latency detected"
    description: "95th percentile transaction latency is {{ $value }}s"

- alert: UnusualTransactionVolume
  expr: rate(transaction_processed_total[5m]) > 1000
  for: 1m
  labels:
    severity: warning
    service: transaction
  annotations:
    summary: "Unusual transaction volume detected"
    description: "Transaction volume is {{ $value }} per second"
```

#### 1.2 é£æ§å‘Šè­¦

```yaml
# é£æ§ç›¸å…³å‘Šè­¦
- alert: HighRiskScoreDetected
  expr: risk_score_current > 80
  for: 0m
  labels:
    severity: critical
    service: risk_control
  annotations:
    summary: "High risk score detected"
    description: "Risk score {{ $value }} exceeds threshold for user {{ $labels.user_id }}"

- alert: RiskCheckLatencyHigh
  expr: histogram_quantile(0.95, rate(risk_check_duration_seconds_bucket[5m])) > 0.5
  for: 2m
  labels:
    severity: warning
    service: risk_control
  annotations:
    summary: "High risk check latency detected"
    description: "95th percentile risk check latency is {{ $value }}s"
```

### 2. æŠ€æœ¯å‘Šè­¦

#### 2.1 ç³»ç»Ÿå‘Šè­¦

```yaml
# ç³»ç»Ÿç›¸å…³å‘Šè­¦
- alert: HighErrorRate
  expr: rate(http_requests_total{status_code=~"5.."}[5m]) / rate(http_requests_total[5m]) > 0.01
  for: 2m
  labels:
    severity: critical
    service: system
  annotations:
    summary: "High error rate detected"
    description: "Error rate is {{ $value | humanizePercentage }} for service {{ $labels.service }}"

- alert: HighCPUUsage
  expr: cpu_usage_percent > 80
  for: 5m
  labels:
    severity: warning
    service: system
  annotations:
    summary: "High CPU usage detected"
    description: "CPU usage is {{ $value }}% on instance {{ $labels.instance }}"

- alert: HighMemoryUsage
  expr: memory_usage_bytes / (1024^3) > 8
  for: 5m
  labels:
    severity: warning
    service: system
  annotations:
    summary: "High memory usage detected"
    description: "Memory usage is {{ $value }}GB on instance {{ $labels.instance }}"
```

---

## ğŸ”’ å®‰å…¨ä¸åˆè§„

### 1. æ•°æ®å®‰å…¨

#### 1.1 æ•°æ®è„±æ•

```yaml
# æ•°æ®è„±æ•é…ç½®
processors:
  attributes:
    actions:
      - key: user.id
        action: hash
      - key: account.number
        action: hash
      - key: transaction.amount
        action: redact
      - key: personal.email
        action: redact
      - key: personal.phone
        action: redact
```

#### 1.2 è®¿é—®æ§åˆ¶

```yaml
# è®¿é—®æ§åˆ¶é…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: otel-security-config
data:
  security.yaml: |
    auth:
      type: "tls"
      tls:
        cert_file: "/etc/otel/certs/server.crt"
        key_file: "/etc/otel/certs/server.key"
        ca_file: "/etc/otel/certs/ca.crt"
    
    access_control:
      rules:
        - resource: "traces"
          permissions: ["read", "write"]
          users: ["monitoring-team", "devops-team"]
        - resource: "metrics"
          permissions: ["read"]
          users: ["monitoring-team", "business-team"]
        - resource: "logs"
          permissions: ["read"]
          users: ["security-team", "audit-team"]
```

### 2. åˆè§„è¦æ±‚

#### 2.1 å®¡è®¡æ—¥å¿—

```yaml
# å®¡è®¡æ—¥å¿—é…ç½®
exporters:
  audit_log:
    endpoint: "https://audit-log-service:8080"
    headers:
      Authorization: "Bearer ${AUDIT_TOKEN}"
    tls:
      insecure: false
    
processors:
  audit:
    rules:
      - resource: "traces"
        actions: ["create", "update", "delete"]
        log_level: "info"
      - resource: "metrics"
        actions: ["create", "update"]
        log_level: "info"
      - resource: "logs"
        actions: ["create", "delete"]
        log_level: "warn"
```

#### 2.2 æ•°æ®ä¿ç•™

```yaml
# æ•°æ®ä¿ç•™ç­–ç•¥
retention_policies:
  traces:
    default: "30d"
    high_priority: "90d"
    audit_traces: "7y"
  
  metrics:
    default: "90d"
    business_metrics: "2y"
    system_metrics: "30d"
  
  logs:
    default: "30d"
    security_logs: "7y"
    audit_logs: "7y"
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. é‡‡æ ·ç­–ç•¥

#### 1.1 æ™ºèƒ½é‡‡æ ·

```yaml
# æ™ºèƒ½é‡‡æ ·é…ç½®
processors:
  probabilistic_sampler:
    sampling_percentage: 10.0
  
  tail_sampling:
    decision_wait: 10s
    num_traces: 50000
    expected_new_traces_per_sec: 10
    policies:
      - name: high_priority
        type: string_attribute
        string_attribute:
          key: priority
          values: ["high", "critical"]
          enabled_regex_matching: false
          invert_match: false
      - name: error_traces
        type: status_code
        status_code:
          status_codes: ["ERROR"]
      - name: slow_traces
        type: latency
        latency:
          threshold_ms: 1000
```

#### 1.2 è‡ªé€‚åº”é‡‡æ ·

```yaml
# è‡ªé€‚åº”é‡‡æ ·é…ç½®
processors:
  adaptive_sampler:
    hash_seed: 12345
    initial_sampling_percentage: 10.0
    target_traces_per_second: 1000
    sampling_percentage_adjustment_interval: 30s
    min_sampling_percentage: 1.0
    max_sampling_percentage: 100.0
```

### 2. æ‰¹å¤„ç†ä¼˜åŒ–

#### 2.1 æ‰¹å¤„ç†é…ç½®

```yaml
# æ‰¹å¤„ç†ä¼˜åŒ–é…ç½®
processors:
  batch:
    timeout: 1s
    send_batch_size: 1024
    send_batch_max_size: 2048
    metadata_keys:
      - "service.name"
      - "service.version"
      - "deployment.environment"
```

#### 2.2 å†…å­˜é™åˆ¶

```yaml
# å†…å­˜é™åˆ¶é…ç½®
processors:
  memory_limiter:
    limit_mib: 512
    spike_limit_mib: 128
    check_interval: 5s
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å®æ–½å»ºè®®

#### 1.1 åˆ†é˜¶æ®µå®æ–½

1. **ç¬¬ä¸€é˜¶æ®µ**: æ ¸å¿ƒç³»ç»Ÿç›‘æ§
   - äº¤æ˜“ç³»ç»Ÿç›‘æ§
   - åŸºç¡€æŒ‡æ ‡æ”¶é›†
   - ç®€å•å‘Šè­¦è§„åˆ™

2. **ç¬¬äºŒé˜¶æ®µ**: æ‰©å±•ç›‘æ§èŒƒå›´
   - é£æ§ç³»ç»Ÿç›‘æ§
   - æ”¯ä»˜ç³»ç»Ÿç›‘æ§
   - é«˜çº§å‘Šè­¦è§„åˆ™

3. **ç¬¬ä¸‰é˜¶æ®µ**: æ™ºèƒ½åˆ†æ
   - å¼‚å¸¸æ£€æµ‹
   - é¢„æµ‹åˆ†æ
   - è‡ªåŠ¨åŒ–è¿ç»´

#### 1.2 å›¢é˜ŸåŸ¹è®­

- **å¼€å‘å›¢é˜Ÿ**: OpenTelemetry SDKä½¿ç”¨
- **è¿ç»´å›¢é˜Ÿ**: ç›‘æ§ç³»ç»Ÿè¿ç»´
- **ä¸šåŠ¡å›¢é˜Ÿ**: ä¸šåŠ¡æŒ‡æ ‡ç†è§£
- **å®‰å…¨å›¢é˜Ÿ**: å®‰å…¨ç›‘æ§é…ç½®

### 2. è¿ç»´å»ºè®®

#### 2.1 ç›‘æ§è¿ç»´

- **å®šæœŸæ£€æŸ¥**: ç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶æ€
- **å®¹é‡è§„åˆ’**: æ•°æ®å­˜å‚¨å®¹é‡è§„åˆ’
- **æ€§èƒ½è°ƒä¼˜**: ç³»ç»Ÿæ€§èƒ½æŒç»­ä¼˜åŒ–
- **æ•…éšœå¤„ç†**: å¿«é€Ÿæ•…éšœå®šä½å’Œæ¢å¤

#### 2.2 æŒç»­æ”¹è¿›

- **æŒ‡æ ‡ä¼˜åŒ–**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´æŒ‡æ ‡
- **å‘Šè­¦ä¼˜åŒ–**: å‡å°‘è¯¯æŠ¥ï¼Œæé«˜å‡†ç¡®æ€§
- **æ€§èƒ½ä¼˜åŒ–**: æŒç»­æå‡ç³»ç»Ÿæ€§èƒ½
- **åŠŸèƒ½æ‰©å±•**: æ ¹æ®éœ€æ±‚æ‰©å±•åŠŸèƒ½

---

## ğŸ“š å‚è€ƒæ ‡å‡†

### 1. å›½é™…æ ‡å‡†

- **Basel III**: é“¶è¡Œèµ„æœ¬å……è¶³ç‡æ ‡å‡†
- **PCI-DSS**: æ”¯ä»˜å¡è¡Œä¸šæ•°æ®å®‰å…¨æ ‡å‡†
- **SOX**: è¨ç­æ–¯-å¥¥å…‹æ–¯åˆ©æ³•æ¡ˆ
- **GDPR**: é€šç”¨æ•°æ®ä¿æŠ¤æ¡ä¾‹

### 2. è¡Œä¸šæ ‡å‡†

- **ISO 27001**: ä¿¡æ¯å®‰å…¨ç®¡ç†ä½“ç³»
- **ISO 20000**: ITæœåŠ¡ç®¡ç†ä½“ç³»
- **COBIT**: ä¿¡æ¯å’ŒæŠ€æœ¯æ²»ç†æ¡†æ¶
- **ITIL**: ITæœåŠ¡ç®¡ç†æœ€ä½³å®è·µ

---

*æœ¬æ–‡æ¡£ä¸ºé‡‘èè¡Œä¸šæä¾›å®Œæ•´çš„OpenTelemetryè§£å†³æ–¹æ¡ˆï¼Œç¡®ä¿ç³»ç»Ÿæ»¡è¶³ä¸¥æ ¼çš„åˆè§„æ€§ã€å®‰å…¨æ€§å’Œå¯é æ€§è¦æ±‚ã€‚*
