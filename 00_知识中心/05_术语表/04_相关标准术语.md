# 相关标准术语

> **文档版本**: v1.0  
> **创建日期**: 2025-10-26  
> **维护团队**: OTLP项目组  
> **适用范围**: 标准对接、互操作性、合规性

---

## 📋 文档概述

本文档整理OTLP项目涉及的**国际标准、行业规范和协议标准**中的术语，确保与标准文档的一致性。

### 标准覆盖
- **W3C标准** (万维网联盟)
- **IETF RFC** (互联网工程任务组)
- **CNCF规范** (云原生计算基金会)
- **OpenTelemetry语义约定**
- **IEEE/ISO标准**

---

## 1. W3C Trace Context标准

### 1.1 规范概述

**标准信息**:
- **名称**: W3C Trace Context
- **状态**: W3C Recommendation (2020-02-06)
- **版本**: Level 1
- **URL**: https://www.w3.org/TR/trace-context/

### 1.2 核心术语

| 术语 | 标准定义 | 说明 |
|------|----------|------|
| **traceparent** | HTTP header field that propagates trace context | 传播追踪上下文的HTTP头字段 |
| **tracestate** | HTTP header field providing additional vendor-specific trace identification | 提供额外厂商特定追踪信息的HTTP头 |
| **version** | The version of the trace context format | 追踪上下文格式的版本号 |
| **trace-id** | A unique identifier for a trace | 追踪的唯一标识符 (128位) |
| **parent-id** | A unique identifier for the parent span | 父Span的唯一标识符 (64位) |
| **trace-flags** | Flags that provide information about the trace | 提供追踪信息的标志位 (8位) |
| **sampled flag** | A bit in trace-flags indicating sampling decision | trace-flags中表示采样决策的位 |

### 1.3 traceparent格式

```
traceparent: version-trace-id-parent-id-trace-flags

格式规范:
  - version: 2个十六进制字符 (00 for version 0)
  - trace-id: 32个十六进制字符 (16字节, 128位)
  - parent-id: 16个十六进制字符 (8字节, 64位)
  - trace-flags: 2个十六进制字符 (1字节, 8位)
  
示例:
  traceparent: 00-4bf92f3577b34da6a3ce929d0e0e4736-00f067aa0ba902b7-01
  
解析:
  - version: 00
  - trace-id: 4bf92f3577b34da6a3ce929d0e0e4736
  - parent-id: 00f067aa0ba902b7
  - trace-flags: 01 (采样标志位=1)
```

### 1.4 tracestate格式

```
tracestate: vendor1=value1,vendor2=value2,...

规范:
  - 最多32个vendor条目
  - 每个key最多256字符
  - value最多256字符
  - 遵循先进先出 (FIFO)
  
示例:
  tracestate: otlp=t:8;r:62,vendor1=data,vendor2=info
  
解析:
  - otlp厂商: t:8;r:62
  - vendor1厂商: data
  - vendor2厂商: info
```

---

## 2. OpenTelemetry语义约定

### 2.1 规范概述

**标准信息**:
- **名称**: OpenTelemetry Semantic Conventions
- **版本**: v1.24.0 (2024)
- **URL**: https://github.com/open-telemetry/semantic-conventions

### 2.2 通用属性

| 属性名 | 类型 | 描述 | 示例 |
|--------|------|------|------|
| **service.name** | string | 服务的逻辑名称 | "checkout-service" |
| **service.namespace** | string | 服务的命名空间 | "production" |
| **service.instance.id** | string | 服务实例的唯一ID | "627cc493-f310-47de-96bd-71410b7dec09" |
| **service.version** | string | 服务的版本号 | "1.2.3" |
| **deployment.environment** | string | 部署环境 | "production", "staging", "dev" |

### 2.3 HTTP语义约定

#### 请求属性

| 属性名 | 类型 | 描述 | 示例 |
|--------|------|------|------|
| **http.method** | string | HTTP请求方法 | "GET", "POST" |
| **http.url** | string | 完整的HTTP URL | "https://api.example.com/users/123" |
| **http.target** | string | HTTP请求目标 | "/users/123?name=John" |
| **http.host** | string | HTTP Host头的值 | "api.example.com" |
| **http.scheme** | string | HTTP协议方案 | "http", "https" |
| **http.status_code** | int | HTTP响应状态码 | 200, 404, 500 |
| **http.request_content_length** | int | 请求体大小(字节) | 1234 |
| **http.response_content_length** | int | 响应体大小(字节) | 5678 |
| **http.user_agent** | string | User-Agent头的值 | "Mozilla/5.0 ..." |

#### Span命名

```
规范:
  HTTP Server Span: {http.method} {http.route}
  HTTP Client Span: {http.method}
  
示例:
  Server: "GET /users/:id"
  Client: "GET"
```

### 2.4 数据库语义约定

| 属性名 | 类型 | 描述 | 示例 |
|--------|------|------|------|
| **db.system** | string | 数据库系统标识 | "postgresql", "mysql", "mongodb" |
| **db.connection_string** | string | 连接字符串(敏感信息脱敏) | "Server=(localdb)\v11.0;..." |
| **db.user** | string | 数据库用户名 | "readonly_user" |
| **db.name** | string | 数据库名称 | "customers" |
| **db.statement** | string | 数据库语句 | "SELECT * FROM users WHERE id=?" |
| **db.operation** | string | 操作类型 | "SELECT", "INSERT", "UPDATE" |

#### SQL数据库

| 属性名 | 类型 | 描述 | 示例 |
|--------|------|------|------|
| **db.sql.table** | string | 主表名 | "users" |

#### NoSQL数据库

| 属性名 | 类型 | 描述 | 示例 |
|--------|------|------|------|
| **db.mongodb.collection** | string | MongoDB集合名 | "users" |
| **db.redis.database_index** | int | Redis数据库索引 | 0 |

### 2.5 RPC语义约定

| 属性名 | 类型 | 描述 | 示例 |
|--------|------|------|------|
| **rpc.system** | string | RPC系统标识 | "grpc", "java_rmi" |
| **rpc.service** | string | 服务名称 | "myservice.EchoService" |
| **rpc.method** | string | 方法名称 | "exampleMethod" |
| **rpc.grpc.status_code** | int | gRPC状态码 | 0 (OK), 1 (CANCELLED) |

---

## 3. IETF RFC标准

### 3.1 RFC 9110 (HTTP Semantics)

**标准信息**:
- **名称**: HTTP Semantics
- **RFC**: 9110
- **日期**: 2022-06
- **URL**: https://www.rfc-editor.org/rfc/rfc9110

**关键术语**:

| 术语 | 定义 | 说明 |
|------|------|------|
| **Origin Server** | The server on which a resource resides or is to be created | 资源所在的原始服务器 |
| **Intermediary** | A message-forwarding agent | 消息转发代理 |
| **User Agent** | The client which initiates a request | 发起请求的客户端 |
| **Request Method** | The HTTP method token | HTTP方法标记 |
| **Status Code** | A three-digit integer code | 三位整数状态码 |

### 3.2 RFC 6749 (OAuth 2.0)

**标准信息**:
- **名称**: The OAuth 2.0 Authorization Framework
- **RFC**: 6749
- **日期**: 2012-10
- **URL**: https://www.rfc-editor.org/rfc/rfc6749

**关键术语**:

| 术语 | 定义 | 说明 |
|------|------|------|
| **Resource Owner** | An entity capable of granting access to a protected resource | 能够授予对受保护资源访问权的实体 |
| **Resource Server** | The server hosting the protected resources | 托管受保护资源的服务器 |
| **Client** | An application making protected resource requests | 发起受保护资源请求的应用 |
| **Authorization Server** | The server issuing access tokens | 发行访问令牌的服务器 |
| **Access Token** | A credential used to access protected resources | 用于访问受保护资源的凭证 |
| **Refresh Token** | A credential used to obtain access tokens | 用于获取访问令牌的凭证 |

---

## 4. CNCF云原生术语

### 4.1 CNCF Glossary

**来源**: https://glossary.cncf.io/

| 术语 | 定义 | 相关项目 |
|------|------|----------|
| **Cloud Native** | Empowering organizations to build and run scalable applications in modern, dynamic environments | - |
| **Microservices** | A collection of small, autonomous services | - |
| **Container** | A lightweight, standalone, executable package | Docker, containerd |
| **Orchestration** | The automated configuration, management, and coordination of systems | Kubernetes |
| **Service Mesh** | An infrastructure layer that manages service-to-service communication | Istio, Linkerd |
| **Observability** | The ability to infer the internal state of a system from its external outputs | OpenTelemetry, Prometheus, Jaeger |

### 4.2 Kubernetes术语

| 术语 | 定义 | 说明 |
|------|------|------|
| **Pod** | The smallest deployable unit in Kubernetes | 可部署的最小单元 |
| **Node** | A worker machine in Kubernetes | 工作节点 |
| **Cluster** | A set of nodes that run containerized applications | 节点集群 |
| **Namespace** | A logical partition of a cluster | 逻辑分区 |
| **Deployment** | A declarative way to manage Pods | 声明式Pod管理 |
| **Service** | An abstract way to expose an application | 抽象的应用暴露方式 |
| **Ingress** | API object that manages external access | 管理外部访问的API对象 |

---

## 5. Protobuf数据类型

### 5.1 标准信息

**来源**: Protocol Buffers Language Specification (proto3)
**URL**: https://protobuf.dev/

### 5.2 标量类型

| Protobuf类型 | C++类型 | Java类型 | Python类型 | Go类型 | 说明 |
|--------------|---------|----------|------------|--------|------|
| **double** | double | double | float | float64 | 64位浮点数 |
| **float** | float | float | float | float32 | 32位浮点数 |
| **int32** | int32 | int | int | int32 | 32位整数 |
| **int64** | int64 | long | int/long | int64 | 64位整数 |
| **uint32** | uint32 | int | int/long | uint32 | 无符号32位整数 |
| **uint64** | uint64 | long | int/long | uint64 | 无符号64位整数 |
| **sint32** | int32 | int | int | int32 | 有符号32位整数(高效) |
| **sint64** | int64 | long | int/long | int64 | 有符号64位整数(高效) |
| **fixed32** | uint32 | int | int | uint32 | 固定4字节 |
| **fixed64** | uint64 | long | int/long | uint64 | 固定8字节 |
| **bool** | bool | boolean | bool | bool | 布尔值 |
| **string** | string | String | str/unicode | string | UTF-8或7位ASCII |
| **bytes** | string | ByteString | str | []byte | 任意字节序列 |

### 5.3 复合类型

| 类型 | 说明 | 示例 |
|------|------|------|
| **message** | 结构化类型 | `message Span { ... }` |
| **enum** | 枚举类型 | `enum SpanKind { ... }` |
| **repeated** | 数组/列表 | `repeated Span spans = 1;` |
| **map** | 映射/字典 | `map<string, string> attributes = 1;` |
| **oneof** | 联合类型 | `oneof value { string str = 1; int64 i = 2; }` |

---

## 6. gRPC状态码

### 6.1 标准状态码

**来源**: gRPC Status Codes  
**URL**: https://grpc.io/docs/guides/status-codes/

| 代码 | 名称 | HTTP映射 | 描述 |
|------|------|----------|------|
| 0 | **OK** | 200 | 成功 |
| 1 | **CANCELLED** | 499 | 操作被取消 |
| 2 | **UNKNOWN** | 500 | 未知错误 |
| 3 | **INVALID_ARGUMENT** | 400 | 无效参数 |
| 4 | **DEADLINE_EXCEEDED** | 504 | 超时 |
| 5 | **NOT_FOUND** | 404 | 未找到 |
| 6 | **ALREADY_EXISTS** | 409 | 已存在 |
| 7 | **PERMISSION_DENIED** | 403 | 权限拒绝 |
| 8 | **RESOURCE_EXHAUSTED** | 429 | 资源耗尽 |
| 9 | **FAILED_PRECONDITION** | 400 | 前置条件失败 |
| 10 | **ABORTED** | 409 | 操作中止 |
| 11 | **OUT_OF_RANGE** | 400 | 超出范围 |
| 12 | **UNIMPLEMENTED** | 501 | 未实现 |
| 13 | **INTERNAL** | 500 | 内部错误 |
| 14 | **UNAVAILABLE** | 503 | 服务不可用 |
| 15 | **DATA_LOSS** | 500 | 数据丢失 |
| 16 | **UNAUTHENTICATED** | 401 | 未认证 |

---

## 7. OpenTelemetry Span状态

### 7.1 状态码

**定义**: opentelemetry/proto/trace/v1/trace.proto

```protobuf
enum StatusCode {
  // 默认状态，不应显式设置
  STATUS_CODE_UNSET = 0;
  
  // 操作成功完成
  STATUS_CODE_OK = 1;
  
  // 操作包含错误
  STATUS_CODE_ERROR = 2;
}
```

**使用指南**:

| 状态码 | 何时使用 | 示例 |
|--------|----------|------|
| **UNSET** | 默认状态，不确定成功或失败 | 未显式设置状态 |
| **OK** | 明确成功 | HTTP 200, gRPC OK |
| **ERROR** | 明确失败 | HTTP 5xx, 异常抛出 |

**注意事项**:
```
- UNSET ≠ OK (不要假设UNSET表示成功)
- OK应显式设置 (明确操作成功)
- ERROR必须设置 (任何错误情况)
- status.message提供错误详情
```

---

## 8. SpanKind类型

### 8.1 定义

**来源**: opentelemetry/proto/trace/v1/trace.proto

```protobuf
enum SpanKind {
  // 未指定，不建议使用
  SPAN_KIND_UNSPECIFIED = 0;
  
  // 内部操作
  SPAN_KIND_INTERNAL = 1;
  
  // 服务端处理请求
  SPAN_KIND_SERVER = 2;
  
  // 客户端发起请求
  SPAN_KIND_CLIENT = 3;
  
  // 生产者发送消息
  SPAN_KIND_PRODUCER = 4;
  
  // 消费者接收消息
  SPAN_KIND_CONSUMER = 5;
}
```

### 8.2 使用场景

| SpanKind | 使用场景 | 示例 |
|----------|----------|------|
| **INTERNAL** | 本地操作，无网络通信 | 本地函数调用、计算 |
| **SERVER** | 同步RPC服务端 | HTTP服务器、gRPC服务器 |
| **CLIENT** | 同步RPC客户端 | HTTP客户端、gRPC客户端、数据库查询 |
| **PRODUCER** | 异步消息生产者 | Kafka生产者、消息队列发送 |
| **CONSUMER** | 异步消息消费者 | Kafka消费者、消息队列接收 |

### 8.3 父子关系

```
CLIENT Span (发起请求)
    ↓
  (网络)
    ↓
SERVER Span (处理请求)
    ↓
INTERNAL Span (内部处理)
    ↓
CLIENT Span (调用数据库)
    ↓
  (网络)
    ↓
SERVER Span (数据库服务)


PRODUCER Span (发送消息)
    ↓
  (消息队列)
    ↓
CONSUMER Span (接收消息)
    ↓
INTERNAL Span (处理消息)
```

---

## 9. 标准合规性检查清单

### 9.1 W3C Trace Context合规

- [ ] 支持traceparent头
- [ ] 支持tracestate头
- [ ] 正确解析version 00
- [ ] 生成有效的trace-id (128位，非零)
- [ ] 生成有效的parent-id (64位，非零)
- [ ] 正确设置sampled flag
- [ ] tracestate条目不超过32个
- [ ] 正确处理tracestate FIFO

### 9.2 OpenTelemetry语义约定合规

- [ ] 使用标准属性名
- [ ] 遵循命名规范 (小写，点分隔)
- [ ] 设置service.name
- [ ] HTTP属性完整
- [ ] 数据库属性完整
- [ ] RPC属性完整
- [ ] Span命名遵循规范

### 9.3 OTLP协议合规

- [ ] 支持gRPC传输
- [ ] 支持HTTP/protobuf传输
- [ ] 正确的Protobuf序列化
- [ ] Resource属性正确
- [ ] InstrumentationScope正确
- [ ] Span属性类型正确
- [ ] 时间戳为纳秒精度

---

## 📊 标准覆盖统计

- **W3C标准**: 2个 (Trace Context, Baggage)
- **IETF RFC**: 3个 (HTTP, OAuth, ...)
- **OpenTelemetry**: 20+个语义约定
- **CNCF**: 10+个术语定义
- **gRPC**: 17个状态码
- **Protobuf**: 13个数据类型

---

## 🔗 相关文档

- ← [中英对照表](./01_中英对照表.md)
- ← [缩略语表](./02_缩略语表.md)
- ← [专业术语解释](./03_专业术语解释.md)
- ↗ [概念索引](../01_概念索引/)

---

## 📚 参考标准

1. W3C Trace Context - https://www.w3.org/TR/trace-context/
2. OpenTelemetry Semantic Conventions - https://github.com/open-telemetry/semantic-conventions
3. IETF RFC 9110 (HTTP) - https://www.rfc-editor.org/rfc/rfc9110
4. gRPC Status Codes - https://grpc.io/docs/guides/status-codes/
5. Protocol Buffers - https://protobuf.dev/
6. CNCF Glossary - https://glossary.cncf.io/

---

**最后更新**: 2025-10-26  
**维护**: OTLP项目组  
**版本**: v1.0

