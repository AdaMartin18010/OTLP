# ğŸ”§ OTLPé¡¹ç›®æ•…éšœæ’æŸ¥å®Œæ•´æ‰‹å†Œ

> **ç›®æ ‡**: ç³»ç»ŸåŒ–æ•´ç†å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ  
> **é€‚ç”¨åœºæ™¯**: å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ  
> **æ›´æ–°æ—¶é—´**: 2025å¹´10æœˆ20æ—¥

---

## ğŸ“‹ ç›®å½•

- [ğŸ”§ OTLPé¡¹ç›®æ•…éšœæ’æŸ¥å®Œæ•´æ‰‹å†Œ](#-otlpé¡¹ç›®æ•…éšœæ’æŸ¥å®Œæ•´æ‰‹å†Œ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ”Œ è¿æ¥é—®é¢˜](#-è¿æ¥é—®é¢˜)
    - [é—®é¢˜1: Collectorè¿æ¥å¤±è´¥](#é—®é¢˜1-collectorè¿æ¥å¤±è´¥)
      - [ç—‡çŠ¶](#ç—‡çŠ¶)
      - [è¯Šæ–­æ­¥éª¤](#è¯Šæ–­æ­¥éª¤)
      - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)
    - [é—®é¢˜2: åç«¯è¿æ¥å¤±è´¥](#é—®é¢˜2-åç«¯è¿æ¥å¤±è´¥)
      - [ç—‡çŠ¶](#ç—‡çŠ¶-1)
      - [è¯Šæ–­æ­¥éª¤](#è¯Šæ–­æ­¥éª¤-1)
      - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ-1)
  - [ğŸ“Š æ•°æ®é—®é¢˜](#-æ•°æ®é—®é¢˜)
    - [é—®é¢˜3: Traceä¸å®Œæ•´](#é—®é¢˜3-traceä¸å®Œæ•´)
      - [ç—‡çŠ¶](#ç—‡çŠ¶-2)
      - [è¯Šæ–­æ­¥éª¤](#è¯Šæ–­æ­¥éª¤-2)
      - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ-2)
    - [é—®é¢˜4: Spanå±æ€§ç¼ºå¤±](#é—®é¢˜4-spanå±æ€§ç¼ºå¤±)
      - [ç—‡çŠ¶](#ç—‡çŠ¶-3)
      - [è¯Šæ–­æ­¥éª¤](#è¯Šæ–­æ­¥éª¤-3)
      - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ-3)
  - [âš¡ æ€§èƒ½é—®é¢˜](#-æ€§èƒ½é—®é¢˜)
    - [é—®é¢˜5: é«˜å»¶è¿Ÿ](#é—®é¢˜5-é«˜å»¶è¿Ÿ)
      - [ç—‡çŠ¶](#ç—‡çŠ¶-4)
      - [è¯Šæ–­æ­¥éª¤](#è¯Šæ–­æ­¥éª¤-4)
      - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ-4)
    - [é—®é¢˜6: å†…å­˜æº¢å‡º](#é—®é¢˜6-å†…å­˜æº¢å‡º)
      - [ç—‡çŠ¶](#ç—‡çŠ¶-5)
      - [è¯Šæ–­æ­¥éª¤](#è¯Šæ–­æ­¥éª¤-5)
      - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ-5)
  - [âš™ï¸ é…ç½®é—®é¢˜](#ï¸-é…ç½®é—®é¢˜)
    - [é—®é¢˜7: é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯](#é—®é¢˜7-é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯)
      - [ç—‡çŠ¶](#ç—‡çŠ¶-6)
      - [è¯Šæ–­æ­¥éª¤](#è¯Šæ–­æ­¥éª¤-6)
      - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ-6)
    - [é—®é¢˜8: Pipelineé…ç½®é”™è¯¯](#é—®é¢˜8-pipelineé…ç½®é”™è¯¯)
      - [ç—‡çŠ¶](#ç—‡çŠ¶-7)
      - [è¯Šæ–­æ­¥éª¤](#è¯Šæ–­æ­¥éª¤-7)
      - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ-7)
  - [ğŸ”— SDKé—®é¢˜](#-sdké—®é¢˜)
    - [é—®é¢˜9: SDKåˆå§‹åŒ–å¤±è´¥](#é—®é¢˜9-sdkåˆå§‹åŒ–å¤±è´¥)
      - [ç—‡çŠ¶](#ç—‡çŠ¶-8)
      - [è¯Šæ–­æ­¥éª¤](#è¯Šæ–­æ­¥éª¤-8)
      - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ-8)
  - [ğŸ“ æœ€ä½³å®è·µå»ºè®®](#-æœ€ä½³å®è·µå»ºè®®)
    - [æ—¥å¿—è®°å½•](#æ—¥å¿—è®°å½•)
    - [å¥åº·æ£€æŸ¥](#å¥åº·æ£€æŸ¥)
    - [ç›‘æ§æŒ‡æ ‡](#ç›‘æ§æŒ‡æ ‡)
  - [ğŸ”— ç›¸å…³èµ„æº](#-ç›¸å…³èµ„æº)

---

## ğŸ”Œ è¿æ¥é—®é¢˜

### é—®é¢˜1: Collectorè¿æ¥å¤±è´¥

#### ç—‡çŠ¶

```text
âŒ Error: failed to connect to collector
âŒ Error: context deadline exceeded
âŒ Error: connection refused
```

#### è¯Šæ–­æ­¥éª¤

```bash
# 1. æ£€æŸ¥Collectoræ˜¯å¦è¿è¡Œ
docker ps | grep otel-collector
# æˆ–
kubectl get pods -n observability | grep otel-collector

# 2. æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®
# gRPCé»˜è®¤: 4317
# HTTPé»˜è®¤: 4318
netstat -an | grep 4317
netstat -an | grep 4318

# 3. æµ‹è¯•è¿æ¥
curl http://localhost:4318/v1/traces
curl http://localhost:13133/  # å¥åº·æ£€æŸ¥

# 4. æŸ¥çœ‹Collectoræ—¥å¿—
docker logs otel-collector
kubectl logs -f otel-collector-xxx -n observability
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆA: Collectoræœªè¿è¡Œ**:

```bash
# Docker
docker-compose up -d otel-collector

# Kubernetes
kubectl apply -f otel-collector-deployment.yaml
```

**æ–¹æ¡ˆB: ç«¯å£é…ç½®é”™è¯¯**:

```go
// ç¡®è®¤SDKé…ç½®
exporter, err := otlptracegrpc.New(ctx,
    otlptracegrpc.WithEndpoint("localhost:4317"),  // âœ… æ­£ç¡®
    // otlptracegrpc.WithEndpoint("localhost:4318"),  // âŒ é”™è¯¯ (HTTPç«¯å£)
    otlptracegrpc.WithInsecure(),
)
```

**æ–¹æ¡ˆC: é˜²ç«å¢™é˜»æ­¢**:

```bash
# Linux
sudo ufw allow 4317
sudo ufw allow 4318

# Windows
netsh advfirewall firewall add rule name="OTLP gRPC" dir=in action=allow protocol=TCP localport=4317
netsh advfirewall firewall add rule name="OTLP HTTP" dir=in action=allow protocol=TCP localport=4318
```

**æ–¹æ¡ˆD: Dockerç½‘ç»œé—®é¢˜**:

```yaml
# docker-compose.yml
services:
  app:
    networks:
      - otel-network
  
  otel-collector:
    networks:
      - otel-network

networks:
  otel-network:
    driver: bridge
```

---

### é—®é¢˜2: åç«¯è¿æ¥å¤±è´¥

#### ç—‡çŠ¶

```text
âŒ Error: failed to export spans to backend
âŒ Error: connection to Jaeger failed
âŒ Error: elasticsearch connection timeout
```

#### è¯Šæ–­æ­¥éª¤

```bash
# 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
docker ps | grep jaeger
docker ps | grep elasticsearch

# 2. æµ‹è¯•åç«¯è¿æ¥
curl http://localhost:16686  # Jaeger UI
curl http://localhost:9200   # Elasticsearch

# 3. æŸ¥çœ‹Collector exporteré…ç½®
cat otel-config.yaml | grep -A 20 "exporters:"

# 4. æŸ¥çœ‹Collectoræ—¥å¿—
docker logs otel-collector | grep "export"
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆA: åç«¯æœªå¯åŠ¨**:

```bash
# å¯åŠ¨Jaeger
docker run -d --name jaeger \
  -e COLLECTOR_OTLP_ENABLED=true \
  -p 16686:16686 \
  -p 14250:14250 \
  jaegertracing/all-in-one:latest

# å¯åŠ¨Elasticsearch
docker run -d --name elasticsearch \
  -e "discovery.type=single-node" \
  -p 9200:9200 \
  elasticsearch:8.10.0
```

**æ–¹æ¡ˆB: é…ç½®é”™è¯¯**:

```yaml
# otel-config.yaml
exporters:
  jaeger:
    endpoint: jaeger:14250  # âœ… Dockerå†…éƒ¨ç½‘ç»œ
    # endpoint: localhost:14250  # âŒ å¦‚æœCollectoråœ¨å®¹å™¨å†…
    tls:
      insecure: true
  
  elasticsearch:
    endpoints: [http://elasticsearch:9200]  # âœ… æ­£ç¡®
    # endpoints: [http://localhost:9200]  # âŒ å®¹å™¨ç½‘ç»œ
```

**æ–¹æ¡ˆC: è®¤è¯é—®é¢˜**:

```yaml
exporters:
  elasticsearch:
    endpoints: [https://elasticsearch:9200]
    auth:
      authenticator: basicauth
    tls:
      ca_file: /path/to/ca.crt
      insecure: false

extensions:
  basicauth:
    client_auth:
      username: elastic
      password: ${ELASTIC_PASSWORD}
```

---

## ğŸ“Š æ•°æ®é—®é¢˜

### é—®é¢˜3: Traceä¸å®Œæ•´

#### ç—‡çŠ¶

```text
âš ï¸ åªçœ‹åˆ°éƒ¨åˆ†Span
âš ï¸ ç¼ºå°‘çˆ¶Span
âš ï¸ Traceæ˜¾ç¤ºä¸ºå¤šä¸ªç‰‡æ®µ
```

#### è¯Šæ–­æ­¥éª¤

```bash
# 1. æ£€æŸ¥é‡‡æ ·é…ç½®
# æŸ¥çœ‹æ˜¯å¦æœ‰é‡‡æ ·å¯¼è‡´æ•°æ®ä¸¢å¤±

# 2. æ£€æŸ¥æ‰¹å¤„ç†è¶…æ—¶
# å¯èƒ½æ‰¹å¤„ç†æœªåŠæ—¶å‘é€

# 3. æŸ¥çœ‹æ—¥å¿—ä¸­çš„é”™è¯¯
docker logs app | grep "span"
docker logs otel-collector | grep "dropped"

# 4. æ£€æŸ¥trace_idæ˜¯å¦ä¸€è‡´
# åœ¨Jaeger UIä¸­æŸ¥çœ‹trace_id
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆA: é‡‡æ ·é…ç½®é—®é¢˜**:

```go
// ç¡®ä¿å¼€å‘ç¯å¢ƒ100%é‡‡æ ·
tp := sdktrace.NewTracerProvider(
    sdktrace.WithBatcher(exporter),
    sdktrace.WithSampler(sdktrace.AlwaysSample()),  // âœ… å¼€å‘ç¯å¢ƒ
    // sdktrace.WithSampler(sdktrace.TraceIDRatioBased(0.01)),  // âŒ ç”Ÿäº§ç¯å¢ƒ1%é‡‡æ ·
)
```

**æ–¹æ¡ˆB: æ‰¹å¤„ç†é…ç½®**:

```yaml
# otel-config.yaml
processors:
  batch:
    timeout: 1s           # âœ… å‡å°è¶…æ—¶
    send_batch_size: 128  # âœ… å‡å°æ‰¹é‡å¤§å°
    # timeout: 10s        # âŒ å¤ªé•¿ï¼Œå¯¼è‡´å»¶è¿Ÿ
```

**æ–¹æ¡ˆC: Contextä¼ æ’­é—®é¢˜**:

```go
// ç¡®ä¿æ­£ç¡®ä¼ æ’­Context
func processOrder(ctx context.Context) {
    ctx, span := tracer.Start(ctx, "process_order")
    defer span.End()
    
    // âœ… ä¼ é€’ctx
    validateOrder(ctx)
    
    // âŒ ä¸ä¼ é€’ctxï¼Œä¼šå¯¼è‡´Traceæ–­è£‚
    // validateOrder(context.Background())
}
```

**æ–¹æ¡ˆD: è·¨æœåŠ¡ä¼ æ’­**:

```go
// HTTPå®¢æˆ·ç«¯ï¼šæ³¨å…¥Context
import "go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp"

client := &http.Client{
    Transport: otelhttp.NewTransport(http.DefaultTransport),  // âœ… è‡ªåŠ¨æ³¨å…¥
}

// HTTPæœåŠ¡ç«¯ï¼šæå–Context
handler := otelhttp.NewHandler(http.HandlerFunc(handleRequest), "my-service")
```

---

### é—®é¢˜4: Spanå±æ€§ç¼ºå¤±

#### ç—‡çŠ¶

```text
âš ï¸ è‡ªå®šä¹‰å±æ€§æœªæ˜¾ç¤º
âš ï¸ æ ‡å‡†å±æ€§å€¼ä¸ºç©º
âš ï¸ Resourceå±æ€§ä¸¢å¤±
```

#### è¯Šæ–­æ­¥éª¤

```bash
# 1. æ£€æŸ¥å±æ€§è®¾ç½®ä»£ç 
# ç¡®è®¤æ˜¯å¦æ­£ç¡®è°ƒç”¨SetAttributes

# 2. æ£€æŸ¥Collectorè¿‡æ»¤å™¨
# å¯èƒ½è¢«attributes processoråˆ é™¤

# 3. æŸ¥çœ‹åŸå§‹OTLPæ•°æ®
# ä½¿ç”¨logging exporteræŸ¥çœ‹
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆA: å±æ€§è®¾ç½®æ—¶æœº**:

```go
// âœ… åœ¨Spanåˆ›å»ºæ—¶è®¾ç½®
ctx, span := tracer.Start(ctx, "operation",
    trace.WithAttributes(
        attribute.String("key", "value"),
    ),
)

// âœ… Spanåˆ›å»ºåè®¾ç½®ï¼ˆSpanç»“æŸå‰ï¼‰
span.SetAttributes(attribute.String("key", "value"))

// âŒ Spanç»“æŸåè®¾ç½®ï¼ˆæ— æ•ˆï¼‰
span.End()
span.SetAttributes(attribute.String("key", "value"))  // å¤ªæ™šäº†
```

**æ–¹æ¡ˆB: Resourceå±æ€§**:

```go
// ç¡®ä¿Resourceæ­£ç¡®é…ç½®
res, err := resource.New(ctx,
    resource.WithAttributes(
        semconv.ServiceName("my-service"),
        semconv.ServiceVersion("1.0.0"),
        semconv.DeploymentEnvironment("production"),
    ),
)

tp := sdktrace.NewTracerProvider(
    sdktrace.WithResource(res),  // âœ… å¿…é¡»è®¾ç½®
)
```

**æ–¹æ¡ˆC: Collectorè¿‡æ»¤å™¨æ£€æŸ¥**:

```yaml
# ç¡®ä¿æ²¡æœ‰è¯¯åˆ å±æ€§
processors:
  attributes:
    actions:
      # - key: myapp.order.id
      #   action: delete  # âŒ è¯¯åˆ äº†éœ€è¦çš„å±æ€§
      
      - key: http.request.header.authorization
        action: delete  # âœ… æ­£ç¡®ï¼šåˆ é™¤æ•æ„Ÿæ•°æ®
```

---

## âš¡ æ€§èƒ½é—®é¢˜

### é—®é¢˜5: é«˜å»¶è¿Ÿ

#### ç—‡çŠ¶

```text
âš ï¸ Spanå¯¼å‡ºå»¶è¿Ÿ>1ç§’
âš ï¸ åº”ç”¨å“åº”å˜æ…¢
âš ï¸ CPUä½¿ç”¨ç‡å‡é«˜
```

#### è¯Šæ–­æ­¥éª¤

```bash
# 1. æŸ¥çœ‹CollectoræŒ‡æ ‡
curl http://localhost:8888/metrics | grep "duration"
curl http://localhost:8888/metrics | grep "queue"

# 2. æ£€æŸ¥æ‰¹å¤„ç†é…ç½®
# æ‰¹é‡å¤§å°æ˜¯å¦è¿‡å°

# 3. æŸ¥çœ‹ç½‘ç»œå»¶è¿Ÿ
ping localhost
traceroute collector-host

# 4. æ£€æŸ¥åç«¯æ€§èƒ½
# Jaeger/Elasticsearchæ˜¯å¦è¿‡è½½
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆA: æ‰¹å¤„ç†ä¼˜åŒ–**:

```yaml
processors:
  batch:
    timeout: 1s             # å¹³è¡¡å»¶è¿Ÿå’Œåå
    send_batch_size: 512    # âœ… å¢å¤§æ‰¹é‡
    send_batch_max_size: 1024
```

**æ–¹æ¡ˆB: å¼‚æ­¥å¯¼å‡º**:

```go
// âœ… ä½¿ç”¨BatchSpanProcessorï¼ˆå¼‚æ­¥ï¼‰
tp := sdktrace.NewTracerProvider(
    sdktrace.WithBatcher(exporter),  // âœ… å¼‚æ­¥æ‰¹å¤„ç†
)

// âŒ ä¸è¦ä½¿ç”¨SimpleSpanProcessorï¼ˆåŒæ­¥ï¼‰
// tp := sdktrace.NewTracerProvider(
//     sdktrace.WithSpanProcessor(sdktrace.NewSimpleSpanProcessor(exporter)),
// )
```

**æ–¹æ¡ˆC: é‡‡æ ·ç­–ç•¥**:

```yaml
# Collectorç«¯é‡‡æ ·
processors:
  probabilistic_sampler:
    sampling_percentage: 10  # 10%é‡‡æ ·ï¼Œå‡å°‘æ•°æ®é‡
  
  tail_sampling:
    decision_wait: 10s
    policies:
      - name: errors
        type: status_code
        status_code:
          status_codes: [ERROR]
      - name: slow
        type: latency
        latency:
          threshold_ms: 1000
      - name: random
        type: probabilistic
        probabilistic:
          sampling_percentage: 1  # å…¶ä»–1%é‡‡æ ·
```

**æ–¹æ¡ˆD: é˜Ÿåˆ—é…ç½®**:

```yaml
exporters:
  otlp:
    endpoint: backend:4317
    sending_queue:
      enabled: true
      num_consumers: 10      # âœ… å¢åŠ æ¶ˆè´¹è€…
      queue_size: 5000       # âœ… å¢å¤§é˜Ÿåˆ—
```

---

### é—®é¢˜6: å†…å­˜æº¢å‡º

#### ç—‡çŠ¶

```text
âŒ OOMKilled (Kubernetes)
âŒ Memory limiter refusing data
âŒ Collectoré‡å¯
```

#### è¯Šæ–­æ­¥éª¤

```bash
# 1. æŸ¥çœ‹å†…å­˜ä½¿ç”¨
docker stats otel-collector
kubectl top pod otel-collector-xxx

# 2. æŸ¥çœ‹Collectoré…ç½®
cat otel-config.yaml | grep "memory_limiter"

# 3. æŸ¥çœ‹æ—¥å¿—
docker logs otel-collector | grep "memory"
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆA: Memory Limiteré…ç½®**:

```yaml
processors:
  memory_limiter:
    check_interval: 1s
    limit_mib: 2048        # âœ… è®¾ç½®åˆç†é™åˆ¶
    spike_limit_mib: 512   # âœ… å…è®¸çªå‘
```

**æ–¹æ¡ˆB: å¢åŠ å†…å­˜åˆ†é…**:

```yaml
# docker-compose.yml
services:
  otel-collector:
    image: otel/opentelemetry-collector-contrib:latest
    mem_limit: 4g          # âœ… å¢åŠ å†…å­˜é™åˆ¶
    mem_reservation: 2g
```

```yaml
# Kubernetes
resources:
  requests:
    memory: "2Gi"
  limits:
    memory: "4Gi"
```

**æ–¹æ¡ˆC: å‡å°‘æ•°æ®é‡**:

```yaml
processors:
  # 1. å¯ç”¨é‡‡æ ·
  probabilistic_sampler:
    sampling_percentage: 10
  
  # 2. è¿‡æ»¤ä¸éœ€è¦çš„æ•°æ®
  filter:
    spans:
      exclude:
        match_type: strict
        attributes:
          - key: http.target
            value: "/health"
  
  # 3. å‡å°æ‰¹å¤„ç†å¤§å°
  batch:
    send_batch_size: 256
```

---

## âš™ï¸ é…ç½®é—®é¢˜

### é—®é¢˜7: é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯

#### ç—‡çŠ¶

```text
âŒ Error: cannot load configuration
âŒ Error: yaml: line X: mapping values are not allowed
âŒ Error: unknown field
```

#### è¯Šæ–­æ­¥éª¤

```bash
# 1. éªŒè¯YAMLè¯­æ³•
yamllint otel-config.yaml

# 2. ä½¿ç”¨CollectoréªŒè¯é…ç½®
docker run --rm \
  -v $(pwd)/otel-config.yaml:/etc/otel-config.yaml \
  otel/opentelemetry-collector-contrib:latest \
  validate --config=/etc/otel-config.yaml

# 3. æ£€æŸ¥ç¼©è¿›
# YAMLå¯¹ç¼©è¿›éå¸¸æ•æ„Ÿ
cat -A otel-config.yaml | head -20
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆA: å¸¸è§YAMLé”™è¯¯**:

```yaml
# âŒ é”™è¯¯ï¼šç¼©è¿›ä¸ä¸€è‡´
receivers:
  otlp:
   protocols:  # ç¼©è¿›é”™è¯¯
      grpc:

# âœ… æ­£ç¡®ï¼šç»Ÿä¸€ç¼©è¿›ï¼ˆ2ç©ºæ ¼ï¼‰
receivers:
  otlp:
    protocols:
      grpc:

# âŒ é”™è¯¯ï¼šä½¿ç”¨Tab
receivers:
â†’otlp:  # Tab

# âœ… æ­£ç¡®ï¼šä½¿ç”¨ç©ºæ ¼
receivers:
  otlp:  # 2ç©ºæ ¼
```

**æ–¹æ¡ˆB: å­—æ®µåé”™è¯¯**:

```yaml
# âŒ é”™è¯¯å­—æ®µå
exporters:
  jaeger:
    host: jaeger:14250  # åº”è¯¥æ˜¯endpoint

# âœ… æ­£ç¡®
exporters:
  jaeger:
    endpoint: jaeger:14250
```

**æ–¹æ¡ˆC: ä½¿ç”¨é…ç½®éªŒè¯å·¥å…·**:

```bash
# åœ¨çº¿éªŒè¯å™¨
# https://www.yamllint.com/

# VS Codeæ’ä»¶
# YAML (Red Hat)
# indent-rainbow

# å‘½ä»¤è¡Œå·¥å…·
pip install yamllint
yamllint otel-config.yaml
```

---

### é—®é¢˜8: Pipelineé…ç½®é”™è¯¯

#### ç—‡çŠ¶

```text
âŒ Error: pipeline "traces" not found
âŒ Error: receiver "otlp" not defined
âŒ Warning: processor "batch" not used
```

#### è¯Šæ–­æ­¥éª¤

```bash
# 1. æ£€æŸ¥pipelineé…ç½®
cat otel-config.yaml | grep -A 20 "service:"

# 2. ç¡®è®¤æ‰€æœ‰ç»„ä»¶éƒ½å·²å®šä¹‰
# receivers, processors, exporters

# 3. æ£€æŸ¥ç»„ä»¶åç§°æ‹¼å†™
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆA: å®Œæ•´Pipelineé…ç½®**:

```yaml
# 1. å®šä¹‰ç»„ä»¶
receivers:
  otlp:
    protocols:
      grpc:

processors:
  batch:
  memory_limiter:
    limit_mib: 512

exporters:
  jaeger:
    endpoint: jaeger:14250

# 2. ç»„è£…Pipeline
service:
  pipelines:
    traces:
      receivers: [otlp]       # âœ… å¿…é¡»åœ¨receiversä¸­å®šä¹‰
      processors: [memory_limiter, batch]  # âœ… é¡ºåºé‡è¦
      exporters: [jaeger]     # âœ… å¿…é¡»åœ¨exportersä¸­å®šä¹‰
```

**æ–¹æ¡ˆB: å¤šPipelineé…ç½®**:

```yaml
service:
  pipelines:
    # Traces Pipeline
    traces:
      receivers: [otlp, jaeger]
      processors: [batch]
      exporters: [jaeger, elasticsearch]
    
    # Metrics Pipeline
    metrics:
      receivers: [otlp, prometheus]
      processors: [batch]
      exporters: [prometheus]
    
    # Logs Pipeline
    logs:
      receivers: [otlp]
      processors: [batch]
      exporters: [elasticsearch]
```

---

## ğŸ”— SDKé—®é¢˜

### é—®é¢˜9: SDKåˆå§‹åŒ–å¤±è´¥

#### ç—‡çŠ¶

```text
âŒ Error: failed to create tracer provider
âŒ Error: nil tracer
âŒ Panic: runtime error
```

#### è¯Šæ–­æ­¥éª¤

```bash
# 1. æ£€æŸ¥SDKç‰ˆæœ¬
go list -m go.opentelemetry.io/otel
# æˆ–
pip show opentelemetry-api

# 2. æ£€æŸ¥åˆå§‹åŒ–ä»£ç 
# ç¡®ä¿åœ¨mainå‡½æ•°ä¸­æ­£ç¡®åˆå§‹åŒ–

# 3. æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬å…¼å®¹æ€§
go mod graph | grep otel
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆA: æ­£ç¡®çš„åˆå§‹åŒ–é¡ºåº**:

```go
func main() {
    ctx := context.Background()
    
    // 1. åˆ›å»ºExporter
    exporter, err := otlptracegrpc.New(ctx,
        otlptracegrpc.WithEndpoint("localhost:4317"),
        otlptracegrpc.WithInsecure(),
    )
    if err != nil {
        log.Fatal(err)
    }
    
    // 2. åˆ›å»ºResource
    res, err := resource.New(ctx,
        resource.WithAttributes(
            semconv.ServiceName("my-service"),
        ),
    )
    if err != nil {
        log.Fatal(err)
    }
    
    // 3. åˆ›å»ºTracerProvider
    tp := sdktrace.NewTracerProvider(
        sdktrace.WithBatcher(exporter),
        sdktrace.WithResource(res),
    )
    
    // 4. è®¾ç½®å…¨å±€Provider
    otel.SetTracerProvider(tp)
    
    // 5. ç¡®ä¿Shutdown
    defer func() {
        if err := tp.Shutdown(ctx); err != nil {
            log.Printf("Error shutting down tracer provider: %v", err)
        }
    }()
    
    // 6. è·å–Tracer
    tracer := otel.Tracer("my-instrumentation")
    
    // ç°åœ¨å¯ä»¥ä½¿ç”¨tracer
}
```

**æ–¹æ¡ˆB: ç‰ˆæœ¬å…¼å®¹æ€§**:

```go
// go.mod
module myapp

go 1.21

require (
    go.opentelemetry.io/otel v1.21.0
    go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.21.0
    go.opentelemetry.io/otel/sdk v1.21.0
)

// âœ… ç¡®ä¿æ‰€æœ‰otelåŒ…ç‰ˆæœ¬ä¸€è‡´
```

---

## ğŸ“ æœ€ä½³å®è·µå»ºè®®

### æ—¥å¿—è®°å½•

```go
// å¯ç”¨è¯¦ç»†æ—¥å¿—
import "go.opentelemetry.io/otel/sdk/trace"

tp := sdktrace.NewTracerProvider(
    sdktrace.WithBatcher(exporter),
    // å¼€å‘ç¯å¢ƒå¯ç”¨è¯¦ç»†æ—¥å¿—
    sdktrace.WithSampler(sdktrace.AlwaysSample()),
)
```

### å¥åº·æ£€æŸ¥

```yaml
# Kubernetes liveness probe
livenessProbe:
  httpGet:
    path: /
    port: 13133
  initialDelaySeconds: 10
  periodSeconds: 10
```

### ç›‘æ§æŒ‡æ ‡

```bash
# å…³é”®æŒ‡æ ‡
curl http://localhost:8888/metrics | grep -E \
  "otelcol_receiver_accepted_spans|otelcol_exporter_sent_spans|otelcol_processor_batch_batch_send_size"
```

---

## ğŸ”— ç›¸å…³èµ„æº

- [PROJECT_DASHBOARD.md](PROJECT_DASHBOARD.md) - é¡¹ç›®ä»ªè¡¨æ¿
- [ğŸ¯ 5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨](ğŸ¯_5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨æŒ‡å—.md) - å¿«é€Ÿå¼€å§‹
- [Collectoré…ç½®ç¤ºä¾‹](examples/collector-configurations/README.md) - é…ç½®å‚è€ƒ

---

**æ›´æ–°æ—¶é—´**: 2025å¹´10æœˆ20æ—¥  
**ç‰ˆæœ¬**: v1.0.0  
**ç»´æŠ¤è€…**: OTLPé¡¹ç›®å›¢é˜Ÿ

---

**ğŸ”§ é‡åˆ°é—®é¢˜ï¼Ÿå‚è€ƒæœ¬æ‰‹å†Œå¿«é€Ÿè§£å†³ï¼** ğŸš€
