# 🤝 OTLP项目贡献者指南

> **欢迎！** 感谢您对OTLP项目的关注  
> **目标**: 帮助新贡献者快速上手  
> **更新时间**: 2025年10月20日

---

## 📋 目录

- [🤝 OTLP项目贡献者指南](#-otlp项目贡献者指南)
  - [📋 目录](#-目录)
  - [🚀 快速开始](#-快速开始)
    - [1. 准备开发环境](#1-准备开发环境)
      - [必需工具](#必需工具)
      - [克隆项目](#克隆项目)
      - [安装依赖](#安装依赖)
  - [🎯 贡献方式](#-贡献方式)
    - [1. 代码贡献](#1-代码贡献)
      - [优先级列表](#优先级列表)
      - [适合新手的Issue](#适合新手的issue)
    - [2. 文档贡献](#2-文档贡献)
      - [文档类型](#文档类型)
      - [文档需求](#文档需求)
    - [3. 测试贡献](#3-测试贡献)
      - [测试类型](#测试类型)
      - [测试覆盖率目标](#测试覆盖率目标)
  - [🔄 开发流程](#-开发流程)
    - [1. 创建分支](#1-创建分支)
      - [分支命名规范](#分支命名规范)
    - [2. 编写代码](#2-编写代码)
      - [代码结构](#代码结构)
      - [开发步骤](#开发步骤)
    - [3. 提交代码](#3-提交代码)
      - [Commit规范](#commit规范)
    - [4. 创建Pull Request](#4-创建pull-request)
      - [PR标题格式](#pr标题格式)
      - [PR描述模板](#pr描述模板)
      - [命名规范](#命名规范)
      - [错误处理](#错误处理)
    - [2. 测试规范](#2-测试规范)
      - [单元测试](#单元测试)
      - [Mock对象](#mock对象)
    - [3. 文档规范](#3-文档规范)
      - [Markdown规范](#markdown规范)
      - [文档结构](#文档结构)
  - [🔍 审查流程](#-审查流程)
    - [1. 自我审查](#1-自我审查)
    - [2. Code Review](#2-code-review)
      - [Reviewer检查点](#reviewer检查点)
      - [Review反馈处理](#review反馈处理)
    - [3. 合并流程](#3-合并流程)
      - [合并要求](#合并要求)
      - [合并后](#合并后)
  - [🎯 进阶指南](#-进阶指南)
    - [1. 成为Reviewer](#1-成为reviewer)
    - [2. 成为Maintainer](#2-成为maintainer)
  - [🔗 相关资源](#-相关资源)
    - [官方文档](#官方文档)
    - [社区](#社区)
    - [工具](#工具)
  - [📞 获得帮助](#-获得帮助)
    - [遇到问题？](#遇到问题)
    - [反馈建议](#反馈建议)
  - [🙏 致谢](#-致谢)

---

## 🚀 快速开始

### 1. 准备开发环境

#### 必需工具

```bash
# Git
git --version  # >= 2.30

# Go
go version  # >= 1.21

# Docker
docker --version  # >= 20.10
docker-compose --version

# Python (文档工具)
python --version  # >= 3.9

# Node.js (可选，用于前端工具)
node --version  # >= 18.0
```

#### 克隆项目

```bash
# 1. Fork项目
# 在GitHub上点击 "Fork"

# 2. 克隆你的Fork
git clone https://github.com/YOUR_USERNAME/OTLP-Formal-Verification.git
cd OTLP-Formal-Verification

# 3. 添加上游仓库
git remote add upstream https://github.com/ORIGINAL_OWNER/OTLP-Formal-Verification.git

# 4. 验证远程仓库
git remote -v
```

#### 安装依赖

```bash
# Go依赖
go mod download

# 验证环境
go test ./...
docker-compose up -d
docker-compose ps
```

✅ **环境准备完成！**

---

## 🎯 贡献方式

### 1. 代码贡献

#### 优先级列表

| 类型 | 优先级 | 示例 |
|------|-------|------|
| **Bug修复** | 🔴 高 | 修复Collector崩溃 |
| **性能优化** | 🟡 中 | 减少内存使用 |
| **新功能** | 🟢 低 | 新的Processor |
| **重构** | 🔵 低 | 代码结构优化 |

#### 适合新手的Issue

查找标签为 `good-first-issue` 的Issue：

```bash
# 在GitHub上过滤
label:"good-first-issue" is:open
```

**新手友好任务**:

- 添加单元测试
- 修复文档错误
- 添加代码注释
- 完善README
- 添加示例代码

---

### 2. 文档贡献

#### 文档类型

| 类型 | 位置 | 重要性 |
|------|------|--------|
| **API文档** | `docs/api/` | ⭐⭐⭐ |
| **用户指南** | `docs/guides/` | ⭐⭐⭐ |
| **示例代码** | `examples/` | ⭐⭐ |
| **架构设计** | `docs/architecture/` | ⭐⭐ |
| **博客文章** | `docs/blog/` | ⭐ |

#### 文档需求

当前需要：

- [ ] 更多语言的示例（Python, Rust, Ruby）
- [ ] 更多场景的Collector配置
- [ ] 性能基准测试报告
- [ ] 故障排查案例
- [ ] 最佳实践总结

---

### 3. 测试贡献

#### 测试类型

```bash
# 单元测试
go test ./pkg/...

# 集成测试
go test ./tests/integration/...

# 端到端测试
./scripts/e2e-test.sh

# 性能测试
go test -bench=. ./...
```

#### 测试覆盖率目标

| 模块 | 当前覆盖率 | 目标 |
|------|----------|------|
| SDK | 85% | 90% |
| Collector | 75% | 85% |
| Exporters | 70% | 80% |

---

## 🔄 开发流程

### 1. 创建分支

```bash
# 同步上游main分支
git checkout main
git pull upstream main

# 创建功能分支
git checkout -b feature/your-feature-name

# 或Bug修复分支
git checkout -b fix/issue-123
```

#### 分支命名规范

```text
feature/  - 新功能
fix/      - Bug修复
docs/     - 文档更新
test/     - 测试相关
refactor/ - 重构
perf/     - 性能优化
```

**示例**:

```bash
feature/add-redis-exporter
fix/collector-memory-leak
docs/update-quickstart
test/add-integration-tests
```

---

### 2. 编写代码

#### 代码结构

```text
OTLP-Formal-Verification/
├── pkg/
│   ├── sdk/           # OpenTelemetry SDK封装
│   ├── collector/     # Collector组件
│   ├── exporters/     # 导出器
│   └── processors/    # 处理器
├── examples/          # 示例代码
├── tests/             # 测试代码
├── docs/              # 文档
└── scripts/           # 工具脚本
```

#### 开发步骤

```bash
# 1. 编写代码
vim pkg/sdk/tracer.go

# 2. 添加测试
vim pkg/sdk/tracer_test.go

# 3. 运行测试
go test ./pkg/sdk/

# 4. 检查代码风格
gofmt -w .
golangci-lint run

# 5. 更新文档（如需要）
vim docs/sdk/tracer.md
```

---

### 3. 提交代码

#### Commit规范

遵循 [Conventional Commits](https://www.conventionalcommits.org/)：

```text
<type>(<scope>): <subject>

<body>

<footer>
```

**类型 (type)**:

- `feat`: 新功能
- `fix`: Bug修复
- `docs`: 文档更新
- `test`: 测试相关
- `refactor`: 重构
- `perf`: 性能优化
- `chore`: 其他（构建、依赖等）

**示例**:

```bash
# 好的Commit
git commit -m "feat(collector): add Redis exporter

- Support Redis Streams
- Add authentication support
- Include connection pooling

Closes #123"

# 简单的Commit
git commit -m "fix(sdk): fix memory leak in batch processor"

# 文档更新
git commit -m "docs: update quick start guide"
```

**不好的Commit**:

```bash
❌ git commit -m "update"
❌ git commit -m "fix bug"
❌ git commit -m "WIP"
```

---

### 4. 创建Pull Request

#### PR标题格式

```text
<type>(<scope>): <description>
```

**示例**:

```text
✅ feat(collector): add Redis exporter
✅ fix(sdk): fix memory leak in batch processor
✅ docs: update architecture diagram
```

#### PR描述模板

```markdown
    ## 描述
    <!-- 简要描述这个PR做了什么 -->

    ## 动机和背景
    <!-- 为什么需要这个改动？解决了什么问题？ -->

    ## 类型
    - [ ] Bug修复
    - [ ] 新功能
    - [ ] 文档更新
    - [ ] 性能优化
    - [ ] 重构
    - [ ] 测试

    ## 检查清单
    - [ ] 代码已通过所有测试
    - [ ] 已添加/更新单元测试
    - [ ] 已添加/更新文档
    - [ ] 代码风格符合规范
    - [ ] 已自测所有改动
    - [ ] PR标题符合规范

    ## 相关Issue
    Closes #123

    ## 测试
    <!-- 如何测试这个改动？ -->

    ```bash
    # 测试步骤
    go test ./pkg/collector/
    ```

    ## 截图（如适用）
    <!-- 添加截图或GIF -->
    ```

---

## 📝 代码规范

### 1. Go代码规范

#### 基本规范

```go
// ✅ 好的代码
package collector

import (
    "context"
    "fmt"
    
    "go.opentelemetry.io/otel"
)

// Exporter exports telemetry data to a backend.
// It implements the otel.Exporter interface.
type Exporter struct {
    endpoint string
    client   *Client
}

// Export exports spans to the backend.
// It returns an error if the export fails.
func (e *Exporter) Export(ctx context.Context, spans []Span) error {
    if len(spans) == 0 {
        return nil
    }
    
    return e.client.Send(ctx, spans)
}
```

#### 命名规范

```go
// ✅ 变量名：驼峰命名
var maxRetryCount = 3
var httpClient = &http.Client{}

// ✅ 常量：驼峰命名
const MaxBatchSize = 512
const defaultTimeout = 30 * time.Second

// ✅ 函数名：驼峰命名，导出函数首字母大写
func NewExporter() *Exporter { ... }
func (e *Exporter) export() error { ... }

// ❌ 不要使用下划线
// var max_retry_count = 3
// func new_exporter() *Exporter { ... }
```

#### 错误处理

```go
// ✅ 返回详细错误
func (e *Exporter) Export(ctx context.Context, spans []Span) error {
    if err := e.client.Send(ctx, spans); err != nil {
        return fmt.Errorf("failed to export spans: %w", err)
    }
    return nil
}

// ✅ 使用自定义错误
var ErrInvalidConfig = errors.New("invalid configuration")

// ❌ 不要忽略错误
// e.client.Send(ctx, spans)  // 错误未处理
```

---

### 2. 测试规范

#### 单元测试

```go
// tracer_test.go
package sdk

import (
    "context"
    "testing"
    
    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/require"
)

func TestExporter_Export(t *testing.T) {
    tests := []struct {
        name    string
        spans   []Span
        wantErr bool
    }{
        {
            name:    "empty spans",
            spans:   []Span{},
            wantErr: false,
        },
        {
            name: "valid spans",
            spans: []Span{
                {Name: "span1"},
                {Name: "span2"},
            },
            wantErr: false,
        },
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            exporter := NewExporter()
            err := exporter.Export(context.Background(), tt.spans)
            
            if tt.wantErr {
                assert.Error(t, err)
            } else {
                assert.NoError(t, err)
            }
        })
    }
}
```

#### Mock对象

```go
// 使用接口和mock
type Client interface {
    Send(ctx context.Context, spans []Span) error
}

type mockClient struct {
    sendFunc func(ctx context.Context, spans []Span) error
}

func (m *mockClient) Send(ctx context.Context, spans []Span) error {
    if m.sendFunc != nil {
        return m.sendFunc(ctx, spans)
    }
    return nil
}
```

---

### 3. 文档规范

#### Markdown规范

```markdown
    # 一级标题

    ## 二级标题

    ### 三级标题

    #### 代码块

    ```go
    // 使用语言标识
    func main() {
        fmt.Println("Hello")
    }
    ```

    #### 表格

    | 列1 | 列2 | 列3 |
    |-----|-----|-----|
    | 值1 | 值2 | 值3 |

    #### 链接

    [链接文字](URL)
    [项目首页](README.md)

    #### 图片

    ![替代文字](image.png)

```

#### 文档结构

```markdown
    # 标题

    > **简介**: 一句话描述

    ## 目录

    - [章节1](#章节1)
    - [章节2](#章节2)

    ## 章节1

    ### 子章节1.1

    内容...

    ### 子章节1.2

    内容...

    ## 相关资源

    - [文档1](link1)
    - [文档2](link2)

    ---

    **更新时间**: YYYY-MM-DD
    **版本**: vX.Y.Z
```

---

## 🔍 审查流程

### 1. 自我审查

提交PR前的检查清单：

```bash
# 1. 代码风格
gofmt -w .
golangci-lint run

# 2. 测试
go test ./...

# 3. 构建
go build ./...

# 4. 文档
# 检查所有Markdown文件

# 5. Commit规范
git log --oneline -5
```

---

### 2. Code Review

#### Reviewer检查点

**代码质量**:

- [ ] 代码逻辑正确
- [ ] 错误处理完善
- [ ] 性能考虑合理
- [ ] 无安全问题
- [ ] 代码风格一致

**测试**:

- [ ] 单元测试充分
- [ ] 边界情况覆盖
- [ ] Mock使用合理

**文档**:

- [ ] 代码注释清晰
- [ ] API文档完整
- [ ] 示例代码可用

#### Review反馈处理

```bash
# 1. 回到你的分支
git checkout feature/your-feature

# 2. 根据反馈修改代码
vim pkg/sdk/tracer.go

# 3. 提交修改
git add .
git commit -m "refactor: address review comments"

# 4. 推送更新
git push origin feature/your-feature
```

---

### 3. 合并流程

#### 合并要求

- ✅ 至少1个Approver批准
- ✅ 所有CI检查通过
- ✅ 无未解决的Review意见
- ✅ 代码冲突已解决

#### 合并后

```bash
# 1. 同步main分支
git checkout main
git pull upstream main

# 2. 删除本地分支
git branch -d feature/your-feature

# 3. 删除远程分支（可选）
git push origin --delete feature/your-feature
```

---

## 🎯 进阶指南

### 1. 成为Reviewer

**要求**:

- 至少5个已合并的PR
- 熟悉项目代码库
- 活跃参与社区讨论

**申请**:
发送邮件到 <maintainers@project.org>

---

### 2. 成为Maintainer

**要求**:

- 至少20个已合并的PR
- 至少10个Review
- 对项目有深入理解
- 长期活跃贡献者

---

## 🔗 相关资源

### 官方文档

- [项目README](README.md)
- [架构设计](docs/architecture/)
- [API文档](docs/api/)

### 社区

- [GitHub Discussions](https://github.com/org/repo/discussions)
- [Slack频道](https://slack-link)
- [邮件列表](mailto:list@project.org)

### 工具

- [golangci-lint](https://golangci-lint.run/)
- [Conventional Commits](https://www.conventionalcommits.org/)
- [Markdown Lint](https://github.com/DavidAnson/markdownlint)

---

## 📞 获得帮助

### 遇到问题？

1. **搜索已有Issue** - 可能已经有人遇到过
2. **查看文档** - [docs/](docs/)
3. **提问** - [GitHub Discussions](https://github.com/org/repo/discussions)
4. **联系Maintainer** - 在Issue中@提及

### 反馈建议

- 📧 Email: <feedback@project.org>
- 💬 Slack: #otlp-project
- 🐛 Bug Report: [New Issue](https://github.com/org/repo/issues/new)

---

## 🙏 致谢

感谢所有贡献者！

查看完整贡献者列表：[CONTRIBUTORS.md](CONTRIBUTORS.md)

---

**更新时间**: 2025年10月20日  
**版本**: v1.0.0  
**维护者**: OTLP项目团队

---

**🤝 期待您的贡献！** 🚀✨
