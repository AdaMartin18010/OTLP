# OTLPæ•°æ®æ¨¡å‹å››ç»´æ·±åº¦åˆ†æï¼šæ•°æ®æµã€è¯­ä¹‰ã€å¤„ç†ä¸åº”ç”¨è§†è§’

> **OTLPç‰ˆæœ¬**: v1.0.0 (Stable)
> **æœ€åæ›´æ–°**: 2025å¹´10æœˆ11æ—¥
> **åˆ†æç»´åº¦**: æ•°æ®æµ | è¯­ä¹‰æ¨¡å‹ | å¤„ç†ä¸Šä¸‹æ–‡ | åº”ç”¨é›†æˆ
> **æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“‹ ç›®å½•

- OTLPæ•°æ®æ¨¡å‹å››ç»´æ·±åº¦åˆ†æï¼šæ•°æ®æµã€è¯­ä¹‰ã€å¤„ç†ä¸åº”ç”¨è§†è§’
  - [æ‰§è¡Œæ‘˜è¦](#-æ‰§è¡Œæ‘˜è¦)
  - [å››ç»´åˆ†ææ¡†æ¶](#-å››ç»´åˆ†ææ¡†æ¶)
  - [ç¬¬ä¸€ç»´åº¦ï¼šæ•°æ®æµè§†è§’](#ç¬¬ä¸€ç»´åº¦æ•°æ®æµè§†è§’)
    - [1.1 æ•°æ®å†…å®¹ä¸ç»“æ„](#11-æ•°æ®å†…å®¹ä¸ç»“æ„)
    - [1.2 æ•°æ®ä¼ è¾“æœºåˆ¶](#12-æ•°æ®ä¼ è¾“æœºåˆ¶)
    - [1.3 å¢é‡ä¸å…¨é‡ç­–ç•¥](#13-å¢é‡ä¸å…¨é‡ç­–ç•¥)
    - [1.4 æ•°æ®è½¬æ¢ä¸é€‚é…](#14-æ•°æ®è½¬æ¢ä¸é€‚é…)
    - [1.5 æ•°æ®å­˜å‚¨ä¸æŒä¹…åŒ–](#15-æ•°æ®å­˜å‚¨ä¸æŒä¹…åŒ–)
  - [ç¬¬äºŒç»´åº¦ï¼šè¯­ä¹‰æ¨¡å‹è§†è§’](#ç¬¬äºŒç»´åº¦è¯­ä¹‰æ¨¡å‹è§†è§’)
    - [2.1 æ•°æ®å®šä¹‰ä¸ç±»å‹ç³»ç»Ÿ](#21-æ•°æ®å®šä¹‰ä¸ç±»å‹ç³»ç»Ÿ)
    - [2.2 è¯­ä¹‰çº¦å®šä¸æ ‡å‡†åŒ–](#22-è¯­ä¹‰çº¦å®šä¸æ ‡å‡†åŒ–)
    - [2.3 æ•°æ®èšåˆç­–ç•¥](#23-æ•°æ®èšåˆç­–ç•¥)
    - [2.4 æ•°æ®ç»„åˆä¸å…³è”](#24-æ•°æ®ç»„åˆä¸å…³è”)
    - [2.5 æ•°æ®æ£€ç´¢ä¸æœç´¢](#25-æ•°æ®æ£€ç´¢ä¸æœç´¢)
  - [ç¬¬ä¸‰ç»´åº¦ï¼šå¤„ç†ä¸Šä¸‹æ–‡è§†è§’](#ç¬¬ä¸‰ç»´åº¦å¤„ç†ä¸Šä¸‹æ–‡è§†è§’)
    - [3.1 æ•°æ®æµå‘ä¸æ‹“æ‰‘](#31-æ•°æ®æµå‘ä¸æ‹“æ‰‘)
    - [3.2 ä¸Šä¸‹æ–‡ä¼ æ’­æœºåˆ¶](#32-ä¸Šä¸‹æ–‡ä¼ æ’­æœºåˆ¶)
    - [3.3 æœ¬åœ°å¤„ç†ä¸ç¼“å†²](#33-æœ¬åœ°å¤„ç†ä¸ç¼“å†²)
    - [3.4 åˆ†å¸ƒå¼åè°ƒ](#34-åˆ†å¸ƒå¼åè°ƒ)
  - [ç¬¬å››ç»´åº¦ï¼šåº”ç”¨é›†æˆè§†è§’](#ç¬¬å››ç»´åº¦åº”ç”¨é›†æˆè§†è§’)
    - [4.1 ä¸šåŠ¡æ•°æ®ä¸OTLPæ•°æ®](#41-ä¸šåŠ¡æ•°æ®ä¸otlpæ•°æ®)
    - [4.2 å†—ä½™ä¸å»é‡ç­–ç•¥](#42-å†—ä½™ä¸å»é‡ç­–ç•¥)
    - [4.3 è¯­ä¹‰æ¨¡å‹èåˆ](#43-è¯­ä¹‰æ¨¡å‹èåˆ)
    - [4.4 åˆ†æä¸æ´å¯Ÿ](#44-åˆ†æä¸æ´å¯Ÿ)
  - [å½¢å¼åŒ–éªŒè¯](#-å½¢å¼åŒ–éªŒè¯)
  - [æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)
  - [å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)

---

## ğŸ¯ æ‰§è¡Œæ‘˜è¦

**OTLPæ•°æ®æ¨¡å‹å››ç»´åˆ†æ**æä¾›äº†ä¸€ä¸ªå…¨é¢çš„è§†è§’æ¥ç†è§£OpenTelemetry Protocolçš„æ•°æ®æ¨¡å‹ï¼š

```text
å››ç»´æ¡†æ¶:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OTLPæ•°æ®æ¨¡å‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ æ•°æ®æµè§†è§’    â”‚  â”‚ è¯­ä¹‰æ¨¡å‹è§†è§’  â”‚                     â”‚
â”‚  â”‚ å†…å®¹Â·ä¼ è¾“     â”‚  â”‚ å®šä¹‰Â·èšåˆ     â”‚                    â”‚
â”‚  â”‚ å¢é‡Â·å…¨é‡     â”‚  â”‚ ç»„åˆÂ·æ£€ç´¢     â”‚                    â”‚
â”‚  â”‚ è½¬æ¢Â·å­˜å‚¨     â”‚  â”‚ æœç´¢Â·ç´¢å¼•     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                 â”‚                             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                  â”‚                                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚         â”‚  OTLPæ•°æ®æ¨¡å‹    â”‚                             â”‚
â”‚         â”‚  (æ ¸å¿ƒå®ä½“)      â”‚                             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                  â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚                               â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ å¤„ç†ä¸Šä¸‹æ–‡    â”‚  â”‚ åº”ç”¨é›†æˆ     â”‚                      â”‚
â”‚  â”‚ æµå‘Â·æ‹“æ‰‘     â”‚  â”‚ ä¸šåŠ¡Â·å†—ä½™    â”‚                      â”‚
â”‚  â”‚ ä¼ æ’­Â·ç¼“å†²     â”‚  â”‚ èåˆÂ·åˆ†æ    â”‚                      â”‚
â”‚  â”‚ åè°ƒÂ·åŒæ­¥     â”‚  â”‚ æ´å¯ŸÂ·å†³ç­–    â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæ´å¯Ÿ**ï¼š

1. **æ•°æ®æµè§†è§’**ï¼šç†è§£æ•°æ®å¦‚ä½•ä»äº§ç”Ÿåˆ°å­˜å‚¨çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
2. **è¯­ä¹‰æ¨¡å‹è§†è§’**ï¼šæŒæ¡æ•°æ®çš„ç»“æ„åŒ–å®šä¹‰å’ŒæŸ¥è¯¢èƒ½åŠ›
3. **å¤„ç†ä¸Šä¸‹æ–‡è§†è§’**ï¼šåˆ†æåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æ•°æ®å¤„ç†æ¨¡å¼
4. **åº”ç”¨é›†æˆè§†è§’**ï¼šå°†OTLPæ•°æ®ä¸ä¸šåŠ¡æ•°æ®æ·±åº¦èåˆ

---

## ğŸ“Š å››ç»´åˆ†ææ¡†æ¶

### æ¡†æ¶å®šä¹‰

```text
å®šä¹‰ (å››ç»´åˆ†ææ¡†æ¶):
OTLPDataModelAnalysis = (DF, SM, PC, AI)

å…¶ä¸­:
DF: DataFlow = (Content, Transport, Delta, Transform, Storage)
    æ•°æ®æµ = (å†…å®¹, ä¼ è¾“, å¢é‡, è½¬æ¢, å­˜å‚¨)

SM: SemanticModel = (Definition, Convention, Aggregation, Composition, Retrieval)
    è¯­ä¹‰æ¨¡å‹ = (å®šä¹‰, çº¦å®š, èšåˆ, ç»„åˆ, æ£€ç´¢)

PC: ProcessingContext = (Flow, Topology, Propagation, Buffer, Coordination)
    å¤„ç†ä¸Šä¸‹æ–‡ = (æµå‘, æ‹“æ‰‘, ä¼ æ’­, ç¼“å†², åè°ƒ)

AI: ApplicationIntegration = (Business, Redundancy, Fusion, Analysis)
    åº”ç”¨é›†æˆ = (ä¸šåŠ¡, å†—ä½™, èåˆ, åˆ†æ)
```

### ç»´åº¦å…³ç³»

```text
å…³ç³»å›¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OTLPæ•°æ®æ¨¡å‹å››ç»´å…³ç³»                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  æ•°æ®æµ (DF) â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚    â†“              â”‚                                 â”‚
â”‚  è¯­ä¹‰æ¨¡å‹ (SM) â”€â”€â”€â”€â”¼â”€â”€â†’ å¤„ç†ä¸Šä¸‹æ–‡ (PC)               â”‚
â”‚    â†“              â”‚         â†“                       â”‚
â”‚  åº”ç”¨é›†æˆ (AI) â†â”€â”€â”€â”˜         â†“                       â”‚
â”‚    â†‘                        â†“                       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                     â”‚
â”‚  åé¦ˆå¾ªç¯: AI â†’ PC â†’ SM â†’ DF â†’ AI                    â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¬¬ä¸€ç»´åº¦ï¼šæ•°æ®æµè§†è§’

### 1.1 æ•°æ®å†…å®¹ä¸ç»“æ„

#### 1.1.1 ä¸‰å¤§ä¿¡å·ç±»å‹

**Traces (è¿½è¸ªæ•°æ®)**ï¼š

```text
å®šä¹‰:
Trace = (TraceID, Spans[], Resource, SchemaURL)

Span = {
  trace_id: bytes[16],           // 128ä½å…¨å±€å”¯ä¸€ID
  span_id: bytes[8],             // 64ä½Spanå”¯ä¸€ID
  parent_span_id: bytes[8],      // çˆ¶Spanå¼•ç”¨
  name: string,                  // Spanåç§°
  kind: SpanKind,                // SERVER/CLIENT/INTERNALç­‰
  start_time: fixed64,           // çº³ç§’çº§æ—¶é—´æˆ³
  end_time: fixed64,             // çº³ç§’çº§æ—¶é—´æˆ³
  attributes: KeyValue[],        // é”®å€¼å¯¹å±æ€§
  events: Event[],               // æ—¶é—´ç‚¹äº‹ä»¶
  links: Link[],                 // è·¨traceé“¾æ¥
  status: Status,                // æ‰§è¡ŒçŠ¶æ€
  trace_state: string            // W3C tracestate
}

æ•°æ®ç‰¹å¾:
- ä½“ç§¯: å•ä¸ªSpan ~340 bytes (å…¸å‹)
- é¢‘ç‡: æ¯ä¸ªè¯·æ±‚äº§ç”Ÿ1-Nä¸ªSpan
- å…³ç³»: æ ‘çŠ¶ç»“æ„ (parent-child)
- ç”Ÿå‘½å‘¨æœŸ: è¯·æ±‚çº§ (ç§’çº§)
```

**Metrics (æŒ‡æ ‡æ•°æ®)**ï¼š

```text
å®šä¹‰:
Metric = (Name, Description, Unit, DataPoints[], AggregationTemporality)

DataPoint = {
  attributes: KeyValue[],        // ç»´åº¦æ ‡ç­¾
  time_unix_nano: fixed64,       // è§‚æµ‹æ—¶é—´
  value: Number | Histogram,    // æ•°å€¼æˆ–ç›´æ–¹å›¾
  exemplars: Exemplar[]         // æ ·æœ¬è¿½è¸ª
}

Metricç±»å‹:
- Counter: å•è°ƒé€’å¢ç´¯è®¡å€¼
- UpDownCounter: å¯å¢å¯å‡ç´¯è®¡å€¼
- Histogram: å€¼åˆ†å¸ƒç»Ÿè®¡
- Gauge: ç¬æ—¶å€¼
- ExponentialHistogram: æŒ‡æ•°ç›´æ–¹å›¾

æ•°æ®ç‰¹å¾:
- ä½“ç§¯: å•ä¸ªDataPoint ~120 bytes
- é¢‘ç‡: å®šæœŸé‡‡æ · (1-60ç§’)
- å…³ç³»: æ—¶é—´åºåˆ— (ç‹¬ç«‹ç‚¹)
- ç”Ÿå‘½å‘¨æœŸ: é•¿æœŸå­˜å‚¨ (å¤©-æœˆçº§)
```

**Logs (æ—¥å¿—æ•°æ®)**ï¼š

```text
å®šä¹‰:
LogRecord = {
  time_unix_nano: fixed64,       // æ—¥å¿—æ—¶é—´
  observed_time_unix_nano: fixed64, // è§‚æµ‹æ—¶é—´
  severity_number: SeverityNumber, // ä¸¥é‡æ€§çº§åˆ«
  severity_text: string,         // ä¸¥é‡æ€§æ–‡æœ¬
  body: AnyValue,                // æ—¥å¿—å†…å®¹
  attributes: KeyValue[],        // é™„åŠ å±æ€§
  trace_id: bytes[16],           // å…³è”trace
  span_id: bytes[8],             // å…³è”span
  flags: uint32                  // æ ‡å¿—ä½
}

æ•°æ®ç‰¹å¾:
- ä½“ç§¯: å•ä¸ªLogRecord ~200-2000 bytes (å˜åŒ–å¤§)
- é¢‘ç‡: äº‹ä»¶é©±åŠ¨ (ä¸è§„åˆ™)
- å…³ç³»: å¯å…³è”åˆ°Trace/Span
- ç”Ÿå‘½å‘¨æœŸ: çŸ­æœŸå­˜å‚¨ (å°æ—¶-å¤©çº§)
```

#### 1.1.2 æ•°æ®å±‚æ¬¡ç»“æ„

```text
OTLPæ•°æ®å±‚æ¬¡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ExportMetricsServiceRequest             â”‚
â”‚         ExportTraceServiceRequest               â”‚
â”‚         ExportLogsServiceRequest                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         ResourceMetrics/Traces/Logs     â”‚    â”‚
â”‚  â”‚  (æŒ‰Resourceåˆ†ç»„)                        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  Resource:                              â”‚   â”‚
â”‚  â”‚    - service.name                       â”‚   â”‚
â”‚  â”‚    - service.version                    â”‚   â”‚
â”‚  â”‚    - host.name                          â”‚   â”‚
â”‚  â”‚    - deployment.environment             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                     â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         ScopeMetrics/Spans/LogRecords   â”‚    â”‚
â”‚  â”‚  (æŒ‰InstrumentationScopeåˆ†ç»„)           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  Scope:                                 â”‚    â”‚
â”‚  â”‚    - name: "myapp"                      â”‚    â”‚
â”‚  â”‚    - version: "1.0.0"                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                     â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         Metrics/Spans/LogRecords        â”‚    â”‚
â”‚  â”‚  (å®é™…æ•°æ®)                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ•°æ®ä¼ è¾“æœºåˆ¶

#### 1.2.1 ä¼ è¾“åè®®

**gRPCä¼ è¾“**ï¼š

```protobuf
// OTLP gRPCæœåŠ¡å®šä¹‰
service TraceService {
  rpc Export(ExportTraceServiceRequest) returns (ExportTraceServiceResponse);
}

service MetricsService {
  rpc Export(ExportMetricsServiceRequest) returns (ExportMetricsServiceResponse);
}

service LogsService {
  rpc Export(ExportLogsServiceRequest) returns (ExportLogsServiceResponse);
}

// è¯·æ±‚ç»“æ„
message ExportTraceServiceRequest {
  repeated ResourceSpans resource_spans = 1;
}

message ExportMetricsServiceRequest {
  repeated ResourceMetrics resource_metrics = 1;
}

message ExportLogsServiceRequest {
  repeated ResourceLogs resource_logs = 1;
}
```

**HTTP/JSONä¼ è¾“**ï¼š

```json
// HTTP POST /v1/traces
{
  "resourceSpans": [
    {
      "resource": {
        "attributes": [
          {"key": "service.name", "value": {"stringValue": "order-service"}}
        ]
      },
      "scopeSpans": [
        {
          "scope": {
            "name": "myapp",
            "version": "1.0.0"
          },
          "spans": [
            {
              "traceId": "5B8EFFF798038103D269B633813FC60C",
              "spanId": "EEE19B7EC3C1B174",
              "name": "HTTP GET",
              "kind": "SPAN_KIND_SERVER",
              "startTimeUnixNano": "1633024800000000000",
              "endTimeUnixNano": "1633024801500000000",
              "attributes": [
                {"key": "http.method", "value": {"stringValue": "GET"}},
                {"key": "http.status_code", "value": {"intValue": 200}}
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

#### 1.2.2 ä¼ è¾“ä¼˜åŒ–

**æ‰¹é‡ä¼ è¾“**ï¼š

```go
// BatchProcessoré…ç½®
batchProcessor := batch.NewBatchProcessor(
    batch.WithMaxExportBatchSize(512),      // æœ€å¤§æ‰¹é‡å¤§å°
    batch.WithMaxExportBatchTimeout(5*time.Second), // è¶…æ—¶æ—¶é—´
    batch.WithExportTimeout(30*time.Second), // å¯¼å‡ºè¶…æ—¶
)

// æ‰¹é‡å¯¼å‡ºé€»è¾‘
func (bp *BatchProcessor) Export(ctx context.Context, data []Span) error {
    // 1. ç´¯ç§¯æ•°æ®åˆ°ç¼“å†²åŒº
    bp.buffer = append(bp.buffer, data...)

    // 2. è§¦å‘æ¡ä»¶æ£€æŸ¥
    if len(bp.buffer) >= bp.maxBatchSize || time.Since(bp.lastExport) >= bp.timeout {
        // 3. æ‰¹é‡å¯¼å‡º
        return bp.exporter.Export(ctx, bp.buffer)
    }

    return nil
}
```

**å‹ç¼©ä¼ è¾“**ï¼š

```text
å‹ç¼©ç­–ç•¥:
1. Protobufç¼–ç : æ¯”JSONå°60-80%
2. gzipå‹ç¼©: é¢å¤–å‡å°‘50-70%
3. å­—æ®µä¼˜åŒ–: ç§»é™¤ç©ºå­—æ®µ

ç¤ºä¾‹:
åŸå§‹JSON: 10KB
â†“ Protobufç¼–ç 
Protobuf: 3KB (å‡å°‘70%)
â†“ gzipå‹ç¼©
gzip: 1KB (å†å‡å°‘67%)
æ€»å‹ç¼©æ¯”: 90%
```

### 1.3 å¢é‡ä¸å…¨é‡ç­–ç•¥

#### 1.3.1 Metricså¢é‡vså…¨é‡

**Cumulative (ç´¯ç§¯èšåˆ)**ï¼š

```text
å®šä¹‰:
Cumulative = ä»å›ºå®šèµ·ç‚¹ç´¯ç§¯çš„å€¼

ç‰¹ç‚¹:
- start_timeå›ºå®š (T0)
- valueå•è°ƒé€’å¢
- æ˜“äºå¤„ç†é‡å¯

æ—¶é—´åºåˆ—:
T0: start_time=T0, value=0
T1: start_time=T0, value=100    (T0åˆ°T1ç´¯ç§¯)
T2: start_time=T0, value=150    (T0åˆ°T2ç´¯ç§¯)
T3: start_time=T0, value=200    (T0åˆ°T3ç´¯ç§¯)

è®¡ç®—é€Ÿç‡:
rate(T1â†’T2) = (value(T2) - value(T1)) / (T2 - T1)
            = (150 - 100) / 60s
            = 0.83 req/s

é‡å¯å¤„ç†:
T3: value=200
[restart]
T4: value=10  (æ–°èµ·ç‚¹)
æ£€æµ‹: value(T4) < value(T3) â†’ reset
å¢é‡: 10 (ä¸è®¡ç®—200â†’10çš„å·®å€¼)
```

**Delta (å¢é‡èšåˆ)**ï¼š

```text
å®šä¹‰:
Delta = ä¸Šæ¬¡æŠ¥å‘Šä»¥æ¥çš„å¢é‡

ç‰¹ç‚¹:
- start_timeå˜åŒ–
- valueæ˜¯å¢é‡
- å¯èƒ½ä¸¢å¤±æ•°æ®

æ—¶é—´åºåˆ—:
T0-T1: start_time=T0, value=100
T1-T2: start_time=T1, value=50
T2-T3: start_time=T2, value=50

ç´¯ç§¯å€¼ = sum(deltas) = 200

é—®é¢˜:
å¦‚æœT1-T2ä¸¢å¤±,æ— æ³•æ¢å¤è¯¥å¢é‡

æ¨è:
OTLPæ¨èä½¿ç”¨Cumulative
Deltaä¸»è¦ç”¨äºå…¼å®¹æ€§
```

#### 1.3.2 Tracesé‡‡æ ·ç­–ç•¥

**å¤´éƒ¨é‡‡æ · (Head Sampling)**ï¼š

```go
// å¤´éƒ¨é‡‡æ ·å†³ç­–
type HeadSampler struct {
    probability float64 // é‡‡æ ·æ¦‚ç‡
}

func (s *HeadSampler) ShouldSample(params SamplingParameters) SamplingResult {
    // åœ¨traceå¼€å§‹æ—¶å†³ç­–
    if params.ParentContext.IsRemote() {
        // è¿œç¨‹çˆ¶spanå·²å†³ç­–,ç»§æ‰¿
        return SamplingResult{
            Decision: params.ParentContext.TraceFlags().IsSampled(),
        }
    }

    // æœ¬åœ°å†³ç­–
    if rand.Float64() < s.probability {
        return SamplingResult{
            Decision: RecordAndSample,
            Tracestate: params.TraceState,
        }
    }

    return SamplingResult{
        Decision: Drop,
    }
}
```

**å°¾éƒ¨é‡‡æ · (Tail Sampling)**ï¼š

```text
å®šä¹‰:
Tail Sampling = åœ¨Collectorç«¯åŸºäºå®Œæ•´traceå†³ç­–

ç­–ç•¥:
1. åŸºäºé”™è¯¯ç‡
   - å¦‚æœtraceåŒ…å«ERROR span â†’ é‡‡æ ·

2. åŸºäºå»¶è¿Ÿ
   - å¦‚æœtrace p95 > threshold â†’ é‡‡æ ·

3. åŸºäºå±æ€§
   - å¦‚æœåŒ…å«ç‰¹å®šå±æ€§ â†’ é‡‡æ ·

4. åŸºäºé€Ÿç‡
   - æ¯ä¸ªæœåŠ¡æ¯ç§’é‡‡æ ·Nä¸ªtrace

ä¼˜åŠ¿:
- ä¿ç•™é‡è¦trace (é”™è¯¯/æ…¢è¯·æ±‚)
- é™ä½å­˜å‚¨æˆæœ¬
- æé«˜æŸ¥è¯¢æ•ˆç‡

ç¤ºä¾‹:
æ€»trace: 1,000,000/å¤©
é‡‡æ ·å: 10,000/å¤© (1%)
å­˜å‚¨å‡å°‘: 99%
```

### 1.4 æ•°æ®è½¬æ¢ä¸é€‚é…

#### 1.4.1 æ ¼å¼è½¬æ¢

**OTLP â†’ Jaeger**ï¼š

```go
// OTLP Spanè½¬Jaeger Span
func ConvertOTLPSpanToJaeger(otlpSpan *tracepb.Span) *jaeger.Span {
    jaegerSpan := &jaeger.Span{
        TraceID: convertTraceID(otlpSpan.TraceId),
        SpanID: convertSpanID(otlpSpan.SpanId),
        ParentSpanId: convertSpanID(otlpSpan.ParentSpanId),
        OperationName: otlpSpan.Name,
        StartTime: time.Unix(0, int64(otlpSpan.StartTimeUnixNano)),
        Duration: time.Duration(otlpSpan.EndTimeUnixNano - otlpSpan.StartTimeUnixNano),
        Tags: convertAttributes(otlpSpan.Attributes),
        Logs: convertEvents(otlpSpan.Events),
    }

    return jaegerSpan
}
```

**OTLP â†’ Prometheus**ï¼š

```go
// OTLP Metricsè½¬Prometheusæ ¼å¼
func ConvertOTLPMetricsToPrometheus(otlpMetrics *metricspb.ResourceMetrics) []prometheus.Metric {
    var promMetrics []prometheus.Metric

    for _, scopeMetrics := range otlpMetrics.ScopeMetrics {
        for _, metric := range scopeMetrics.Metrics {
            switch data := metric.Data.(type) {
            case *metricspb.Metric_Sum:
                // Counterè½¬Prometheus Counter
                promMetrics = append(promMetrics, convertSumToCounter(metric, data.Sum))

            case *metricspb.Metric_Histogram:
                // Histogramè½¬Prometheus Histogram
                promMetrics = append(promMetrics, convertHistogram(metric, data.Histogram))

            case *metricspb.Metric_Gauge:
                // Gaugeè½¬Prometheus Gauge
                promMetrics = append(promMetrics, convertGauge(metric, data.Gauge))
            }
        }
    }

    return promMetrics
}
```

### 1.5 æ•°æ®å­˜å‚¨ä¸æŒä¹…åŒ–

#### 1.5.1 å­˜å‚¨æ¶æ„

**æ—¶åºæ•°æ®åº“å­˜å‚¨**ï¼š

```text
å­˜å‚¨é€‰æ‹©:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            OTLPæ•°æ®å­˜å‚¨æ¶æ„                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  Traces (è¿½è¸ªæ•°æ®)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Jaeger / Tempo / TraceDB               â”‚   â”‚
â”‚  â”‚  - å­˜å‚¨: TraceIDç´¢å¼• + Spanæ•°æ®          â”‚   â”‚
â”‚  â”‚  - æŸ¥è¯¢: TraceIDæŸ¥æ‰¾, æ—¶é—´èŒƒå›´æŸ¥è¯¢       â”‚   â”‚
â”‚  â”‚  - ä¿ç•™: 7-30å¤©                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  Metrics (æŒ‡æ ‡æ•°æ®)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Prometheus / InfluxDB / TimescaleDB    â”‚   â”‚
â”‚  â”‚  - å­˜å‚¨: æ—¶é—´åºåˆ— (metric+labels)       â”‚   â”‚
â”‚  â”‚  - æŸ¥è¯¢: PromQL, SQL                    â”‚   â”‚
â”‚  â”‚  - ä¿ç•™: 30-365å¤©                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  Logs (æ—¥å¿—æ•°æ®)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Loki / Elasticsearch / Splunk         â”‚   â”‚
â”‚  â”‚  - å­˜å‚¨: å…¨æ–‡ç´¢å¼• + æ—¶é—´ç´¢å¼•             â”‚   â”‚
â”‚  â”‚  - æŸ¥è¯¢: LogQL, Lucene, SPL             â”‚   â”‚
â”‚  â”‚  - ä¿ç•™: 7-90å¤©                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.5.2 æ•°æ®åˆ†åŒºç­–ç•¥

**æ—¶é—´åˆ†åŒº**ï¼š

```sql
-- TimescaleDBæ—¶é—´åˆ†åŒº
CREATE TABLE traces (
    time TIMESTAMPTZ NOT NULL,
    trace_id TEXT NOT NULL,
    span_id TEXT NOT NULL,
    service_name TEXT NOT NULL,
    span_data JSONB
);

-- åˆ›å»ºè¶…è¡¨ (è‡ªåŠ¨åˆ†åŒº)
SELECT create_hypertable('traces', 'time',
    chunk_time_interval => INTERVAL '1 day'
);

-- è‡ªåŠ¨åˆ†åŒºç­–ç•¥
-- æ¯å¤©ä¸€ä¸ªåˆ†åŒº,ä¿ç•™30å¤©
SELECT add_retention_policy('traces', INTERVAL '30 days');
```

---

## ç¬¬äºŒç»´åº¦ï¼šè¯­ä¹‰æ¨¡å‹è§†è§’

### 2.1 æ•°æ®å®šä¹‰ä¸ç±»å‹ç³»ç»Ÿ

#### 2.1.1 ç±»å‹å±‚æ¬¡ç»“æ„

```text
OTLPç±»å‹ç³»ç»Ÿ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AnyValue (è”åˆç±»å‹)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  String     â”‚  â”‚  Bool       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Int        â”‚  â”‚  Double     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Bytes      â”‚  â”‚  Array      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  KvList    â”‚  â”‚  Map        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç±»å‹å®šä¹‰**ï¼š

```protobuf
message AnyValue {
  oneof value {
    string string_value = 1;
    bool bool_value = 2;
    int64 int_value = 3;
    double double_value = 4;
    bytes bytes_value = 5;
    ArrayValue array_value = 6;
    KeyValueList kvlist_value = 7;
  }
}

message ArrayValue {
  repeated AnyValue values = 1;
}

message KeyValueList {
  repeated KeyValue values = 1;
}

message KeyValue {
  string key = 1;
  AnyValue value = 2;
}
```

#### 2.1.2 ç±»å‹çº¦æŸ

```text
ç±»å‹çº¦æŸ:
1. String: UTF-8ç¼–ç , æ— é•¿åº¦é™åˆ¶
2. Bool: true/false
3. Int: 64ä½æœ‰ç¬¦å·æ•´æ•°
4. Double: IEEE 754åŒç²¾åº¦æµ®ç‚¹æ•°
5. Bytes: ä»»æ„å­—èŠ‚åºåˆ—
6. Array: åŒè´¨æ•°ç»„ (å…ƒç´ ç±»å‹ä¸€è‡´)
7. KvList: é”®å€¼å¯¹åˆ—è¡¨

ç±»å‹å®‰å…¨æ€§:
- å¼ºç±»å‹: ç¼–è¯‘æ—¶æ£€æŸ¥
- è¿è¡Œæ—¶éªŒè¯: ExporteréªŒè¯
- å‘åå…¼å®¹: æ–°å¢ç±»å‹ä¸å½±å“æ—§å®¢æˆ·ç«¯
```

### 2.2 è¯­ä¹‰çº¦å®šä¸æ ‡å‡†åŒ–

#### 2.2.1 HTTPè¯­ä¹‰çº¦å®š

```text
HTTP Spanå±æ€§:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           HTTPè¯­ä¹‰çº¦å®š (Semantic Conventions)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  å¿…éœ€å±æ€§:                                       â”‚
â”‚  - http.method: GET, POST, PUT, DELETE          â”‚
â”‚  - http.status_code: 200, 404, 500             â”‚
â”‚  - http.url: å®Œæ•´URL (ä¸å«æŸ¥è¯¢å‚æ•°)             â”‚
â”‚  - http.route: è·¯ç”±æ¨¡æ¿ (å¦‚: /users/{id})      â”‚
â”‚                                                 â”‚
â”‚  æ¨èå±æ€§:                                       â”‚
â”‚  - http.request_content_length: è¯·æ±‚ä½“å¤§å°     â”‚
â”‚  - http.response_content_length: å“åº”ä½“å¤§å°    â”‚
â”‚  - http.user_agent: ç”¨æˆ·ä»£ç†                   â”‚
â”‚  - http.server_name: æœåŠ¡å™¨åç§°                 â”‚
â”‚                                                 â”‚
â”‚  å®¢æˆ·ç«¯å±æ€§:                                     â”‚
â”‚  - http.request.body.size: è¯·æ±‚ä½“å¤§å°          â”‚
â”‚  - http.response.body.size: å“åº”ä½“å¤§å°         â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¤ºä¾‹**ï¼š

```go
// HTTP Server Span
span.SetAttributes(
    attribute.String("http.method", "GET"),
    attribute.String("http.route", "/api/users/{id}"),
    attribute.String("http.url", "https://api.example.com/api/users/123"),
    attribute.Int("http.status_code", 200),
    attribute.Int("http.response_content_length", 1024),
)

// HTTP Client Span
span.SetAttributes(
    attribute.String("http.method", "POST"),
    attribute.String("http.url", "https://api.example.com/api/orders"),
    attribute.Int("http.status_code", 201),
    attribute.Int("http.request_content_length", 512),
)
```

#### 2.2.2 æ•°æ®åº“è¯­ä¹‰çº¦å®š

```text
æ•°æ®åº“è¯­ä¹‰çº¦å®š:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚  å¿…éœ€å±æ€§:                                       â”‚
â”‚  - db.system: mysql, postgresql, mongodb       â”‚
â”‚  - db.name: æ•°æ®åº“åç§°                          â”‚
â”‚  - db.statement: SQLè¯­å¥ (æˆ–æ‘˜è¦)               â”‚
â”‚                                                 â”‚
â”‚  æ¨èå±æ€§:                                       â”‚
â”‚  - db.operation: SELECT, INSERT, UPDATE, DELETEâ”‚
â”‚  - db.sql.table: è¡¨å                           â”‚
â”‚  - db.connection_string: è¿æ¥å­—ç¬¦ä¸² (è„±æ•)      â”‚
â”‚                                                 â”‚
â”‚  æ€§èƒ½å±æ€§:                                       â”‚
â”‚  - db.cache.hit: true/false                    â”‚
â”‚  - db.rows_affected: å—å½±å“è¡Œæ•°                â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¤ºä¾‹**ï¼š

```go
// MySQLæŸ¥è¯¢Span
span.SetAttributes(
    attribute.String("db.system", "mysql"),
    attribute.String("db.name", "orders"),
    attribute.String("db.operation", "SELECT"),
    attribute.String("db.sql.table", "users"),
    attribute.String("db.statement", "SELECT * FROM users WHERE id = ?"),
    attribute.Bool("db.cache.hit", false),
)
```

### 2.3 æ•°æ®èšåˆç­–ç•¥

#### 2.3.1 Metricsèšåˆ

**Counterèšåˆ**ï¼š

```text
Counterèšåˆ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚  åŸå§‹æ•°æ®:                                       â”‚
â”‚  t0: http.server.requests{method=GET,status=200} = 100
â”‚  t1: http.server.requests{method=GET,status=200} = 150
â”‚  t2: http.server.requests{method=GET,status=200} = 200
â”‚                                                 â”‚
â”‚  èšåˆæ“ä½œ:                                       â”‚
â”‚  1. æŒ‰methodèšåˆ:                                â”‚
â”‚     http.server.requests{method=GET} = 450      â”‚
â”‚                                                 â”‚
â”‚  2. æŒ‰statusèšåˆ:                                â”‚
â”‚     http.server.requests{status=200} = 450      â”‚
â”‚                                                 â”‚
â”‚  3. å…¨å±€èšåˆ:                                    â”‚
â”‚     http.server.requests = 450                  â”‚
â”‚                                                 â”‚
â”‚  é€Ÿç‡è®¡ç®—:                                       â”‚
â”‚  rate = (value_t2 - value_t1) / (t2 - t1)      â”‚
â”‚       = (200 - 150) / 60s                       â”‚
â”‚       = 0.83 req/s                              â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Histogramèšåˆ**ï¼š

```text
Histogramèšåˆ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚  åŸå§‹æ•°æ®:                                       â”‚
â”‚  H1: {count=100, sum=5000, buckets=[20,30,40,10]}
â”‚  H2: {count=150, sum=7500, buckets=[30,45,60,15]}
â”‚                                                 â”‚
â”‚  èšåˆç»“æœ:                                       â”‚
â”‚  H_merged: {                                   â”‚
â”‚    count = 100 + 150 = 250                     â”‚
â”‚    sum = 5000 + 7500 = 12500                   â”‚
â”‚    buckets = [50, 75, 100, 25]                â”‚
â”‚  }                                              â”‚
â”‚                                                 â”‚
â”‚  ç™¾åˆ†ä½æ•°è®¡ç®—:                                   â”‚
â”‚  p50 = bucketè¾¹ç•Œ[1] = 10ms                     â”‚
â”‚  p95 = bucketè¾¹ç•Œ[2] = 50ms                     â”‚
â”‚  p99 = bucketè¾¹ç•Œ[3] = 100ms                    â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.2 Tracesèšåˆ

**Traceèšåˆ**ï¼š

```text
Traceèšåˆç­–ç•¥:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚  èšåˆç»´åº¦:                                       â”‚
â”‚  1. æŒ‰serviceèšåˆ:                               â”‚
â”‚     - æ¯ä¸ªæœåŠ¡çš„traceæ•°é‡                        â”‚
â”‚     - æ¯ä¸ªæœåŠ¡çš„å¹³å‡å»¶è¿Ÿ                         â”‚
â”‚     - æ¯ä¸ªæœåŠ¡çš„é”™è¯¯ç‡                           â”‚
â”‚                                                 â”‚
â”‚  2. æŒ‰operationèšåˆ:                             â”‚
â”‚     - æ¯ä¸ªæ“ä½œçš„è°ƒç”¨æ¬¡æ•°                          â”‚
â”‚     - æ¯ä¸ªæ“ä½œçš„p50/p95/p99å»¶è¿Ÿ                  â”‚
â”‚     - æ¯ä¸ªæ“ä½œçš„é”™è¯¯ç‡                           â”‚
â”‚                                                 â”‚
â”‚  3. æŒ‰traceèšåˆ:                                 â”‚
â”‚     - traceå®Œæ•´è·¯å¾„                              â”‚
â”‚     - traceæ€»å»¶è¿Ÿ                                â”‚
â”‚     - traceé”™è¯¯çŠ¶æ€                              â”‚
â”‚                                                 â”‚
â”‚  èšåˆç¤ºä¾‹:                                       â”‚
â”‚  service=order-service:                         â”‚
â”‚    - total_traces: 1000                         â”‚
â”‚    - avg_latency: 150ms                        â”‚
â”‚    - error_rate: 0.5%                          â”‚
â”‚                                                 â”‚
â”‚  operation=HTTP GET:                            â”‚
â”‚    - total_calls: 5000                         â”‚
â”‚    - p50_latency: 100ms                        â”‚
â”‚    - p95_latency: 250ms                        â”‚
â”‚    - p99_latency: 500ms                        â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 æ•°æ®ç»„åˆä¸å…³è”

#### 2.4.1 Trace-Spanå…³è”

```text
Trace-Spanå…³ç³»:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚  Trace (æ ¹)                                      â”‚
â”‚  â”œâ”€ Span A (parent=null)                       â”‚
â”‚  â”‚  â”œâ”€ Span B (parent=A)                       â”‚
â”‚  â”‚  â”‚  â”œâ”€ Span D (parent=B)                   â”‚
â”‚  â”‚  â”‚  â””â”€ Span E (parent=B)                   â”‚
â”‚  â”‚  â””â”€ Span C (parent=A)                       â”‚
â”‚  â”‚     â””â”€ Span F (parent=C)                   â”‚
â”‚                                                 â”‚
â”‚  å…³ç³»å±æ€§:                                       â”‚
â”‚  - parent_span_id: çˆ¶å­å…³ç³»                     â”‚
â”‚  - trace_id: åŒtraceå…³è”                         â”‚
â”‚  - links: è·¨traceå…³è”                          â”‚
â”‚                                                 â”‚
â”‚  æŸ¥è¯¢èƒ½åŠ›:                                       â”‚
â”‚  1. è·å–å®Œæ•´trace:                              â”‚
â”‚     WHERE trace_id = 'xxx'                      â”‚
â”‚                                                 â”‚
â”‚  2. è·å–å­spans:                                â”‚
â”‚     WHERE parent_span_id = 'yyy'                â”‚
â”‚                                                 â”‚
â”‚  3. è·å–ç¥–å…ˆspans:                              â”‚
â”‚     WHERE span_id IN (                         â”‚
â”‚       SELECT parent_span_id FROM spans          â”‚
â”‚       WHERE span_id = 'zzz'                     â”‚
â”‚     )                                           â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.2 Trace-Logå…³è”

```text
Trace-Logå…³è”:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚  å…³è”æ–¹å¼:                                       â”‚
â”‚  1. trace_idå…³è”:                               â”‚
â”‚     Log.trace_id = Trace.trace_id               â”‚
â”‚                                                 â”‚
â”‚  2. span_idå…³è”:                                â”‚
â”‚     Log.span_id = Span.span_id                  â”‚
â”‚                                                 â”‚
â”‚  å…³è”ç¤ºä¾‹:                                       â”‚
â”‚  Trace:                                         â”‚
â”‚    trace_id: 5B8EFFF798038103D269B633813FC60C  â”‚
â”‚    span_id: EEE19B7EC3C1B174                   â”‚
â”‚                                                 â”‚
â”‚  Logs:                                          â”‚
â”‚    log1: trace_id=5B8EFFF..., span_id=EEE19B... â”‚
â”‚    log2: trace_id=5B8EFFF..., span_id=EEE19B... â”‚
â”‚    log3: trace_id=5B8EFFF..., span_id=EEE19B... â”‚
â”‚                                                 â”‚
â”‚  æŸ¥è¯¢èƒ½åŠ›:                                       â”‚
â”‚  1. ä»traceæŸ¥çœ‹logs:                           â”‚
â”‚     SELECT * FROM logs                          â”‚
â”‚     WHERE trace_id = '5B8EFFF...'               â”‚
â”‚                                                 â”‚
â”‚  2. ä»logè·³è½¬åˆ°trace:                          â”‚
â”‚     SELECT * FROM traces                        â”‚  â”‚
â”‚     WHERE trace_id = (                         â”‚
â”‚       SELECT trace_id FROM logs                 â”‚
â”‚       WHERE log_id = 'xxx'                     â”‚
â”‚     )                                           â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 æ•°æ®æ£€ç´¢ä¸æœç´¢

#### 2.5.1 Traceæ£€ç´¢

**TraceIDæŸ¥æ‰¾**ï¼š

```text
TraceIDæŸ¥æ‰¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚  æŸ¥æ‰¾ç­–ç•¥:                                       â”‚
â”‚  1. ç›´æ¥æŸ¥æ‰¾:                                    â”‚
â”‚     WHERE trace_id = '5B8EFFF798038103...'       â”‚
â”‚     â†’ O(1) æ—¶é—´å¤æ‚åº¦                           â”‚
â”‚                                                 â”‚
â”‚  2. ç´¢å¼•æŸ¥æ‰¾:                                    â”‚
â”‚     CREATE INDEX idx_trace_id ON traces(trace_id)
â”‚     â†’ ä½¿ç”¨B+æ ‘ç´¢å¼•                               â”‚
â”‚                                                 â”‚
â”‚  3. åˆ†åŒºæŸ¥æ‰¾:                                    â”‚
â”‚     - æŒ‰trace_idå“ˆå¸Œåˆ†åŒº                        â”‚
â”‚     - å¹¶è¡ŒæŸ¥è¯¢å¤šä¸ªåˆ†åŒº                           â”‚
â”‚                                                 â”‚
â”‚  æŸ¥æ‰¾ç¤ºä¾‹:                                       â”‚
â”‚  SELECT * FROM spans                            â”‚
â”‚  WHERE trace_id = '5B8EFFF798038103D269B633813FC60C'
â”‚  ORDER BY start_time ASC                        â”‚
â”‚                                                 â”‚
â”‚  è¿”å›ç»“æœ:                                       â”‚
â”‚  - æ‰€æœ‰spans (æŒ‰æ—¶é—´æ’åº)                       â”‚
â”‚  - å®Œæ•´çš„è°ƒç”¨æ ‘                                 â”‚
â”‚  - æ€»å»¶è¿Ÿ                                        â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å±æ€§æŸ¥æ‰¾**ï¼š

```text
å±æ€§æŸ¥æ‰¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚  æŸ¥æ‰¾æ¡ä»¶:                                       â”‚
â”‚  1. æŒ‰serviceæŸ¥æ‰¾:                              â”‚
â”‚     WHERE attributes['service.name'] = 'order-service'
â”‚                                                 â”‚
â”‚  2. æŒ‰operationæŸ¥æ‰¾:                            â”‚
â”‚     WHERE name = 'HTTP GET'                     â”‚
â”‚                                                 â”‚
â”‚  3. æŒ‰çŠ¶æ€æŸ¥æ‰¾:                                 â”‚
â”‚     WHERE status.code = 'ERROR'                 â”‚
â”‚                                                 â”‚
â”‚  4. æŒ‰æ—¶é—´èŒƒå›´æŸ¥æ‰¾:                             â”‚
â”‚     WHERE start_time BETWEEN '2025-10-01' AND '2025-10-02'
â”‚                                                 â”‚
â”‚  5. ç»„åˆæ¡ä»¶æŸ¥æ‰¾:                               â”‚
â”‚     WHERE service.name = 'order-service'        â”‚
â”‚       AND status.code = 'ERROR'                 â”‚
â”‚       AND start_time > '2025-10-01 00:00:00'   â”‚
â”‚                                                 â”‚
â”‚  ç´¢å¼•ç­–ç•¥:                                       â”‚
â”‚  - å€’æ’ç´¢å¼•: å±æ€§å€¼ â†’ Spanåˆ—è¡¨                  â”‚
â”‚  - å…¨æ–‡ç´¢å¼•: Spanåç§°å…¨æ–‡æœç´¢                    â”‚
â”‚  - æ—¶é—´ç´¢å¼•: æ—¶é—´èŒƒå›´æŸ¥è¯¢                        â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.5.2 Metricsæ£€ç´¢

**PromQLæŸ¥è¯¢**ï¼š

```promql
# æŸ¥è¯¢HTTPè¯·æ±‚é€Ÿç‡
rate(http_server_requests_total[5m])

# æŸ¥è¯¢é”™è¯¯ç‡
sum(rate(http_server_requests_total{status_code=~"5.."}[5m]))
/
sum(rate(http_server_requests_total[5m]))

# æŸ¥è¯¢p95å»¶è¿Ÿ
histogram_quantile(0.95,
  rate(http_server_duration_seconds_bucket[5m])
)

# æŸ¥è¯¢CPUä½¿ç”¨ç‡
avg(system_cpu_utilization) by (host_name)

# æŸ¥è¯¢å†…å­˜ä½¿ç”¨
sum(process_runtime_memory_heap_used) by (service_name)
```

**SQLæŸ¥è¯¢**ï¼š

```sql
-- æŸ¥è¯¢HTTPè¯·æ±‚é€Ÿç‡
SELECT
    service_name,
    time_bucket('1 minute', time) AS minute,
    COUNT(*) AS request_count
FROM metrics
WHERE metric_name = 'http.server.requests'
GROUP BY service_name, minute
ORDER BY minute DESC;

-- æŸ¥è¯¢é”™è¯¯ç‡
SELECT
    service_name,
    SUM(CASE WHEN status_code >= 500 THEN 1 ELSE 0 END) * 100.0 / COUNT(*) AS error_rate
FROM metrics
WHERE metric_name = 'http.server.requests'
GROUP BY service_name;
```

---

## ç¬¬ä¸‰ç»´åº¦ï¼šå¤„ç†ä¸Šä¸‹æ–‡è§†è§’

### 3.1 æ•°æ®æµå‘ä¸æ‹“æ‰‘

#### 3.1.1 æ•°æ®æµæ‹“æ‰‘

```text
OTLPæ•°æ®æµæ‹“æ‰‘:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  åº”ç”¨å±‚ (Application Layer)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Service A  â”‚  â”‚  Service B â”‚  â”‚  Service C  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                â”‚                â”‚           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                          â”‚                             â”‚
â”‚  æ”¶é›†å±‚ (Collection Layer)                             â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚         â”‚      OTLP Collector             â”‚           â”‚
â”‚         â”‚  - æ‰¹å¤„ç†                        â”‚           â”‚
â”‚         â”‚  - é‡‡æ ·                          â”‚           â”‚
â”‚         â”‚  - è½¬æ¢                          â”‚           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                  â”‚        â”‚        â”‚                   â”‚
â”‚  å­˜å‚¨å±‚ (Storage Layer)                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚         â”‚   Jaeger     â”‚  â”‚  â”‚  Prometheus   â”‚         â”‚
â”‚         â”‚   (Traces)   â”‚  â”‚  â”‚  (Metrics)    â”‚         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                           â”‚                            â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                  â”‚      Loki        â”‚                  â”‚
â”‚                  â”‚      (Logs)     â”‚                  â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1.2 æ•°æ®æµå‘

```text
æ•°æ®æµå‘:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  1. æ•°æ®äº§ç”Ÿ                                            â”‚
â”‚     Application â†’ SDK â†’ Span/Metric/Log                 â”‚
â”‚                                                         â”‚
â”‚  2. æ•°æ®æ”¶é›†                                            â”‚
â”‚     SDK â†’ BatchProcessor â†’ Exporter                    â”‚
â”‚                                                         â”‚
â”‚  3. æ•°æ®ä¼ è¾“                                            â”‚
â”‚     Exporter â†’ gRPC/HTTP â†’ Collector                   â”‚
â”‚                                                         â”‚
â”‚  4. æ•°æ®å¤„ç†                                            â”‚
â”‚     Collector â†’ Processor â†’ Sampler                    â”‚
â”‚                                                         â”‚
â”‚  5. æ•°æ®å­˜å‚¨                                            â”‚
â”‚     Collector â†’ Backend (Jaeger/Prometheus/Loki)       â”‚
â”‚                                                         â”‚
â”‚  6. æ•°æ®æŸ¥è¯¢                                            â”‚
â”‚     Backend â†’ Query API â†’ Dashboard                    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ä¸Šä¸‹æ–‡ä¼ æ’­æœºåˆ¶

#### 3.2.1 TraceContextä¼ æ’­

**W3C TraceContext**ï¼š

```text
W3C TraceContextæ ¼å¼:
traceparent: 00-{trace-id}-{parent-id}-{flags}

ç¤ºä¾‹:
traceparent: 00-5B8EFFF798038103D269B633813FC60C-EEE19B7EC3C1B174-01

è§£æ:
- version: 00 (ç‰ˆæœ¬)
- trace-id: 5B8EFFF798038103D269B633813FC60C (128ä½)
- parent-id: EEE19B7EC3C1B174 (64ä½)
- flags: 01 (é‡‡æ ·æ ‡å¿—)

ä¼ æ’­æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  Service A (Server)                                     â”‚
â”‚  â”œâ”€ æ¥æ”¶è¯·æ±‚                                            â”‚
â”‚  â”œâ”€ æå–traceparent                                     â”‚
â”‚  â”œâ”€ åˆ›å»ºSpan                                            â”‚
â”‚  â””â”€ è°ƒç”¨Service B                                       â”‚
â”‚                                                         â”‚
â”‚         â”‚ traceparent: 00-5B8EFFF...-EEE19B...-01      â”‚
â”‚         â–¼                                               â”‚
â”‚                                                         â”‚
â”‚  Service B (Client â†’ Server)                           â”‚
â”‚  â”œâ”€ æ¥æ”¶traceparent                                     â”‚
â”‚  â”œâ”€ åˆ›å»ºClient Span                                     â”‚
â”‚  â”œâ”€ å‘é€HTTPè¯·æ±‚ (æºå¸¦traceparent)                      â”‚
â”‚  â””â”€ æ¥æ”¶å“åº”                                            â”‚
â”‚                                                         â”‚
â”‚         â”‚ traceparent: 00-5B8EFFF...-NEW_SPAN_ID-01    â”‚
â”‚         â–¼                                               â”‚
â”‚                                                         â”‚
â”‚  Service C (Server)                                     â”‚
â”‚  â”œâ”€ æ¥æ”¶è¯·æ±‚                                            â”‚
â”‚  â”œâ”€ æå–traceparent                                     â”‚
â”‚  â”œâ”€ åˆ›å»ºSpan                                            â”‚
â”‚  â””â”€ è¿”å›å“åº”                                            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç ç¤ºä¾‹**ï¼š

```go
// HTTP Clientä¼ æ’­
func CallDownstream(ctx context.Context, url string) error {
    // 1. åˆ›å»ºClient Span
    _, span := tracer.Start(ctx, "HTTP POST")
    defer span.End()

    // 2. æå–TraceContext
    traceparent := trace.SpanContextFromContext(ctx)

    // 3. æ³¨å…¥åˆ°HTTP Header
    req, _ := http.NewRequest("POST", url, nil)
    req.Header.Set("traceparent", formatTraceparent(traceparent))

    // 4. å‘é€è¯·æ±‚
    resp, err := http.DefaultClient.Do(req)

    // 5. è®°å½•ç»“æœ
    span.SetAttributes(
        attribute.String("http.method", "POST"),
        attribute.String("http.url", url),
        attribute.Int("http.status_code", resp.StatusCode),
    )

    return err
}

// HTTP Serveræå–
func HandleRequest(w http.ResponseWriter, r *http.Request) {
    // 1. æå–TraceContext
    traceparent := r.Header.Get("traceparent")
    ctx := extractTraceContext(traceparent)

    // 2. åˆ›å»ºServer Span
    ctx, span := tracer.Start(ctx, "HTTP GET")
    defer span.End()

    // 3. å¤„ç†è¯·æ±‚
    processRequest(ctx)

    // 4. è¿”å›å“åº”
    w.WriteHeader(http.StatusOK)
}
```

### 3.3 æœ¬åœ°å¤„ç†ä¸ç¼“å†²

#### 3.3.1 æœ¬åœ°ç¼“å†²

**å†…å­˜ç¼“å†²**ï¼š

```go
// æœ¬åœ°ç¼“å†²å®ç°
type LocalBuffer struct {
    mu          sync.RWMutex
    spans       []Span
    maxSize     int
    flushInterval time.Duration
}

func (lb *LocalBuffer) AddSpan(span Span) error {
    lb.mu.Lock()
    defer lb.mu.Unlock()

    // æ£€æŸ¥å®¹é‡
    if len(lb.spans) >= lb.maxSize {
        // è§¦å‘åˆ·æ–°
        go lb.Flush()
        return fmt.Errorf("buffer full")
    }

    // æ·»åŠ Span
    lb.spans = append(lb.spans, span)

    return nil
}

func (lb *LocalBuffer) Flush() error {
    lb.mu.Lock()
    defer lb.mu.Unlock()

    if len(lb.spans) == 0 {
        return nil
    }

    // å¤åˆ¶æ•°æ®
    spans := make([]Span, len(lb.spans))
    copy(spans, lb.spans)

    // æ¸…ç©ºç¼“å†²
    lb.spans = lb.spans[:0]

    // å¼‚æ­¥å¯¼å‡º
    go lb.exportSpans(spans)

    return nil
}

func (lb *LocalBuffer) StartAutoFlush() {
    ticker := time.NewTicker(lb.flushInterval)
    go func() {
        for range ticker.C {
            lb.Flush()
        }
    }()
}
```

**ç£ç›˜ç¼“å†²**ï¼š

```go
// ç£ç›˜ç¼“å†²å®ç°
type DiskBuffer struct {
    dir      string
    maxFiles int
    fileSize int64
}

func (db *DiskBuffer) WriteSpan(span Span) error {
    // 1. åºåˆ—åŒ–Span
    data, err := proto.Marshal(&span)
    if err != nil {
        return err
    }

    // 2. å†™å…¥æ–‡ä»¶
    filename := fmt.Sprintf("%s/%d.otlp", db.dir, time.Now().UnixNano())
    file, err := os.OpenFile(filename, os.O_CREATE|os.O_WRONLY, 0644)
    if err != nil {
        return err
    }
    defer file.Close()

    // 3. å†™å…¥æ•°æ®
    _, err = file.Write(data)
    return err
}

func (db *DiskBuffer) ReadSpans() ([]Span, error) {
    var spans []Span

    // 1. åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶
    files, err := os.ReadDir(db.dir)
    if err != nil {
        return nil, err
    }

    // 2. è¯»å–æ–‡ä»¶
    for _, file := range files {
        data, err := os.ReadFile(filepath.Join(db.dir, file.Name()))
        if err != nil {
            continue
        }

        var span Span
        if err := proto.Unmarshal(data, &span); err == nil {
            spans = append(spans, span)
        }

        // 3. åˆ é™¤å·²è¯»æ–‡ä»¶
        os.Remove(filepath.Join(db.dir, file.Name()))
    }

    return spans, nil
}
```

### 3.4 åˆ†å¸ƒå¼åè°ƒ

#### 3.4.1 é‡‡æ ·å†³ç­–åè°ƒ

**å¤´éƒ¨é‡‡æ ·åè°ƒ**ï¼š

```text
é‡‡æ ·å†³ç­–åè°ƒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  Service A (æ ¹æœåŠ¡)                                     â”‚
â”‚  â”œâ”€ åˆ›å»ºTrace                                           â”‚
â”‚  â”œâ”€ é‡‡æ ·å†³ç­–: Sample (æ¦‚ç‡=0.1)                        â”‚
â”‚  â””â”€ è®¾ç½®trace flags: sampled=1                         â”‚
â”‚                                                         â”‚
â”‚         â”‚ traceparent: 00-xxx-xxx-01 (sampled)         â”‚
â”‚         â–¼                                               â”‚
â”‚                                                         â”‚
â”‚  Service B (ä¸‹æ¸¸æœåŠ¡)                                   â”‚
â”‚  â”œâ”€ æ¥æ”¶traceparent                                     â”‚
â”‚  â”œâ”€ æ£€æŸ¥flags: sampled=1                               â”‚
â”‚  â”œâ”€ ç»§æ‰¿é‡‡æ ·å†³ç­–: Sample                                â”‚
â”‚  â””â”€ åˆ›å»ºSpan                                            â”‚
â”‚                                                         â”‚
â”‚         â”‚ traceparent: 00-xxx-yyy-01 (sampled)         â”‚
â”‚         â–¼                                               â”‚
â”‚                                                         â”‚
â”‚  Service C (ä¸‹æ¸¸æœåŠ¡)                                   â”‚
â”‚  â”œâ”€ æ¥æ”¶traceparent                                     â”‚
â”‚  â”œâ”€ æ£€æŸ¥flags: sampled=1                               â”‚
â”‚  â”œâ”€ ç»§æ‰¿é‡‡æ ·å†³ç­–: Sample                                â”‚
â”‚  â””â”€ åˆ›å»ºSpan                                            â”‚
â”‚                                                         â”‚
â”‚  åè°ƒç»“æœ:                                              â”‚
â”‚  - æ•´ä¸ªtraceè¦ä¹ˆå…¨éƒ¨é‡‡æ ·,è¦ä¹ˆå…¨éƒ¨ä¸¢å¼ƒ                   â”‚
â”‚  - ä¿è¯traceå®Œæ•´æ€§                                       â”‚
â”‚  - é¿å…éƒ¨åˆ†é‡‡æ ·                                         â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.4.2 æ—¶é’ŸåŒæ­¥

**æ—¶é—´æˆ³åè°ƒ**ï¼š

```text
æ—¶é’ŸåŒæ­¥é—®é¢˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  Service A (æ—¶é’Ÿåç§»: +2s)                              â”‚
â”‚  â”œâ”€ Span A: start_time = T0 + 2s                      â”‚
â”‚  â””â”€ Span A: end_time = T1 + 2s                       â”‚
â”‚                                                         â”‚
â”‚  Service B (æ—¶é’Ÿåç§»: -1s)                              â”‚
â”‚  â”œâ”€ Span B: start_time = T2 - 1s                      â”‚
â”‚  â””â”€ Span B: end_time = T3 - 1s                       â”‚
â”‚                                                         â”‚
â”‚  é—®é¢˜:                                                   â”‚
â”‚  - Span Bçš„start_time < Span Açš„end_time               â”‚
â”‚  - è¿åæ—¶é—´é¡ºåºçº¦æŸ                                     â”‚
â”‚                                                         â”‚
â”‚  è§£å†³æ–¹æ¡ˆ:                                               â”‚
â”‚  1. ä½¿ç”¨å•è°ƒæ—¶é’Ÿ (monotonic clock)                      â”‚
â”‚     - ä¸å—ç³»ç»Ÿæ—¶é—´è°ƒæ•´å½±å“                               â”‚
â”‚     - åªä¿è¯ç›¸å¯¹æ—¶é—´å‡†ç¡®                                 â”‚
â”‚                                                         â”‚
â”‚  2. æ—¶é’ŸåŒæ­¥æœåŠ¡ (NTP)                                  â”‚
â”‚     - å®šæœŸæ ¡å‡†ç³»ç»Ÿæ—¶é’Ÿ                                   â”‚
â”‚     - ä¿æŒæ—¶é’Ÿåç§» < 1ms                                â”‚
â”‚                                                         â”‚
â”‚  3. å®¹å¿æ—¶é’Ÿæ¼‚ç§»                                        â”‚
â”‚     - å…è®¸å°çš„æ—¶é—´åå·®                                   â”‚
â”‚     - åœ¨æŸ¥è¯¢æ—¶è°ƒæ•´                                       â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¬¬å››ç»´åº¦ï¼šåº”ç”¨é›†æˆè§†è§’

### 4.1 ä¸šåŠ¡æ•°æ®ä¸OTLPæ•°æ®

#### 4.1.1 æ•°æ®å†—ä½™åˆ†æ

```text
ä¸šåŠ¡æ•°æ® vs OTLPæ•°æ®:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  ä¸šåŠ¡æ•°æ® (Business Data)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - è®¢å•ID, ç”¨æˆ·ID, å•†å“ID                      â”‚    â”‚
â”‚  â”‚  - äº¤æ˜“é‡‘é¢, åº“å­˜æ•°é‡                          â”‚    â”‚
â”‚  â”‚  - ä¸šåŠ¡çŠ¶æ€, ä¸šåŠ¡æµç¨‹                          â”‚    â”‚
â”‚  â”‚  - ä¸šåŠ¡è§„åˆ™, ä¸šåŠ¡é€»è¾‘                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  OTLPæ•°æ® (Observability Data)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - TraceID, SpanID                             â”‚    â”‚
â”‚  â”‚  - HTTPæ–¹æ³•, HTTPçŠ¶æ€ç                          â”‚    â”‚
â”‚  â”‚  - å»¶è¿Ÿæ—¶é—´, é”™è¯¯ä¿¡æ¯                          â”‚    â”‚
â”‚  â”‚  - æœåŠ¡åç§°, ä¸»æœºåç§°                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  å†—ä½™åˆ†æ:                                               â”‚
â”‚  1. æ—¶é—´æˆ³:                                              â”‚
â”‚     - ä¸šåŠ¡æ•°æ®: created_at, updated_at                 â”‚
â”‚     - OTLPæ•°æ®: start_time, end_time                   â”‚
â”‚     â†’ å†—ä½™åº¦: é«˜ (ç›¸åŒæ—¶é—´ç‚¹)                           â”‚
â”‚                                                         â”‚
â”‚  2. è¯·æ±‚ID:                                              â”‚
â”‚     - ä¸šåŠ¡æ•°æ®: request_id, order_id                    â”‚
â”‚     - OTLPæ•°æ®: trace_id                                â”‚
â”‚     â†’ å†—ä½™åº¦: ä½ (ä¸åŒç”¨é€”)                             â”‚
â”‚                                                         â”‚
â”‚  3. ç”¨æˆ·ä¿¡æ¯:                                            â”‚
â”‚     - ä¸šåŠ¡æ•°æ®: user_id, user_name                     â”‚
â”‚     - OTLPæ•°æ®: (æ— )                                    â”‚
â”‚     â†’ å†—ä½™åº¦: æ—                                         â”‚
â”‚                                                         â”‚
â”‚  4. é”™è¯¯ä¿¡æ¯:                                            â”‚
â”‚     - ä¸šåŠ¡æ•°æ®: error_message, error_code              â”‚
â”‚     - OTLPæ•°æ®: status.message, status.code            â”‚
â”‚     â†’ å†—ä½™åº¦: é«˜ (ç›¸åŒé”™è¯¯)                             â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.1.2 æ•°æ®å…³è”

```text
æ•°æ®å…³è”ç­–ç•¥:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  å…³è”æ–¹å¼:                                               â”‚
â”‚  1. TraceIDå…³è”:                                        â”‚
â”‚     Business.order_id â†’ OTLP.trace_id                   â”‚
â”‚     â†’ é€šè¿‡trace_idå…³è”ä¸šåŠ¡è®¢å•å’Œè¿½è¸ªæ•°æ®                â”‚
â”‚                                                         â”‚
â”‚  2. æ—¶é—´å…³è”:                                           â”‚
â”‚     Business.created_at â‰ˆ OTLP.start_time              â”‚
â”‚     â†’ é€šè¿‡æ—¶é—´èŒƒå›´å…³è”                                   â”‚
â”‚                                                         â”‚
â”‚  3. å±æ€§å…³è”:                                           â”‚
â”‚     Business.user_id â†’ OTLP.attributes['user.id']      â”‚
â”‚     â†’ é€šè¿‡è‡ªå®šä¹‰å±æ€§å…³è”                                 â”‚
â”‚                                                         â”‚
â”‚  å…³è”ç¤ºä¾‹:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ä¸šåŠ¡è®¢å•è¡¨:                                      â”‚    â”‚
â”‚  â”‚ order_id: 12345                                 â”‚    â”‚
â”‚  â”‚ user_id: 67890                                   â”‚    â”‚
â”‚  â”‚ amount: 100.00                                   â”‚    â”‚
â”‚  â”‚ created_at: 2025-10-11 10:00:00                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ OTLP Trace:                                     â”‚    â”‚
â”‚  â”‚ trace_id: 5B8EFFF798038103D269B633813FC60C     â”‚    â”‚
â”‚  â”‚ attributes:                                     â”‚    â”‚
â”‚  â”‚   - order.id: 12345                            â”‚    â”‚
â”‚  â”‚   - user.id: 67890                              â”‚    â”‚
â”‚  â”‚ start_time: 2025-10-11 10:00:00.123            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  å…³è”æŸ¥è¯¢:                                               â”‚
â”‚  SELECT o.*, t.*                                       â”‚
â”‚  FROM orders o                                         â”‚
â”‚  JOIN traces t ON o.order_id = t.attributes['order.id']
â”‚  WHERE o.order_id = 12345                             â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å†—ä½™ä¸å»é‡ç­–ç•¥

#### 4.2.1 å»é‡ç­–ç•¥

**æ—¶é—´æˆ³å»é‡**ï¼š

```text
æ—¶é—´æˆ³å»é‡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  é—®é¢˜:                                                   â”‚
â”‚  - ä¸šåŠ¡æ•°æ®: created_at = 2025-10-11 10:00:00          â”‚
â”‚  - OTLPæ•°æ®: start_time = 2025-10-11 10:00:00.123      â”‚
â”‚  â†’ æ—¶é—´æˆ³ä¸å®Œå…¨ç›¸åŒ,ä½†è¡¨ç¤ºåŒä¸€äº‹ä»¶                      â”‚
â”‚                                                         â”‚
â”‚  è§£å†³æ–¹æ¡ˆ:                                               â”‚
â”‚  1. æ—¶é—´çª—å£å»é‡:                                       â”‚
â”‚     WHERE ABS(created_at - start_time) < 1s             â”‚
â”‚                                                         â”‚
â”‚  2. æ—¶é—´æˆ³å½’ä¸€åŒ–:                                       â”‚
â”‚     normalized_time = FLOOR(timestamp / 1000) * 1000  â”‚
â”‚                                                         â”‚
â”‚  3. äº‹ä»¶IDå»é‡:                                         â”‚
â”‚     event_id = MD5(order_id + normalized_time)        â”‚
â”‚                                                         â”‚
â”‚  å»é‡ç¤ºä¾‹:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ åŸå§‹æ•°æ®:                                       â”‚    â”‚
â”‚  â”‚ order_id=12345, created_at=10:00:00.000       â”‚    â”‚
â”‚  â”‚ trace_id=xxx, start_time=10:00:00.123         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ å»é‡å:                                         â”‚    â”‚
â”‚  â”‚ event_id=MD5(12345+10:00:00)                  â”‚    â”‚
â”‚  â”‚ â†’ åˆå¹¶ä¸ºä¸€æ¡è®°å½•                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é”™è¯¯ä¿¡æ¯å»é‡**ï¼š

```text
é”™è¯¯ä¿¡æ¯å»é‡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  é—®é¢˜:                                                   â”‚
â”‚  - ä¸šåŠ¡æ•°æ®: error_message = "Database connection failed"
â”‚  - OTLPæ•°æ®: status.message = "Database connection failed"
â”‚  â†’ ç›¸åŒé”™è¯¯ä¿¡æ¯,é‡å¤å­˜å‚¨                                â”‚
â”‚                                                         â”‚
â”‚  è§£å†³æ–¹æ¡ˆ:                                               â”‚
â”‚  1. é”™è¯¯ç æ˜ å°„:                                         â”‚
â”‚     error_code â†’ status.code                           â”‚
â”‚     â†’ åªå­˜å‚¨ä¸€æ¬¡é”™è¯¯ç                                   â”‚
â”‚                                                         â”‚
â”‚  2. é”™è¯¯åˆ†ç±»:                                           â”‚
â”‚     error_category = classify(error_message)            â”‚
â”‚     â†’ å­˜å‚¨é”™è¯¯ç±»åˆ«è€Œéå…·ä½“æ¶ˆæ¯                          â”‚
â”‚                                                         â”‚
â”‚  3. å¼•ç”¨å…³è”:                                           â”‚
â”‚     error_id = UUID()                                  â”‚
â”‚     â†’ ä¸šåŠ¡æ•°æ®å’ŒOTLPæ•°æ®å¼•ç”¨åŒä¸€error_id                â”‚
â”‚                                                         â”‚
â”‚  å»é‡ç¤ºä¾‹:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ åŸå§‹æ•°æ®:                                       â”‚    â”‚
â”‚  â”‚ order_id=12345, error="DB connection failed"   â”‚    â”‚
â”‚  â”‚ trace_id=xxx, error="DB connection failed"     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ å»é‡å:                                         â”‚    â”‚
â”‚  â”‚ error_id=ERR-001                               â”‚    â”‚
â”‚  â”‚ error_category="database_error"                â”‚    â”‚
â”‚  â”‚ â†’ ä¸šåŠ¡æ•°æ®å’ŒOTLPæ•°æ®å¼•ç”¨error_id                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 è¯­ä¹‰æ¨¡å‹èåˆ

#### 4.3.1 ç»Ÿä¸€è¯­ä¹‰æ¨¡å‹

```text
ç»Ÿä¸€è¯­ä¹‰æ¨¡å‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  ä¸šåŠ¡è¯­ä¹‰å±‚ (Business Semantic Layer)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - è®¢å• (Order)                                â”‚    â”‚
â”‚  â”‚  - ç”¨æˆ· (User)                                  â”‚    â”‚
â”‚  â”‚  - å•†å“ (Product)                               â”‚    â”‚
â”‚  â”‚  - æ”¯ä»˜ (Payment)                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  å¯è§‚æµ‹æ€§è¯­ä¹‰å±‚ (Observability Semantic Layer)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - Trace (è¿½è¸ª)                                â”‚    â”‚
â”‚  â”‚  - Metric (æŒ‡æ ‡)                               â”‚    â”‚
â”‚  â”‚  - Log (æ—¥å¿—)                                  â”‚    â”‚
â”‚  â”‚  - Span (è·¨åº¦)                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  èåˆè¯­ä¹‰å±‚ (Fused Semantic Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  - OrderTrace (è®¢å•è¿½è¸ª)                        â”‚    â”‚
â”‚  â”‚    â€¢ order_id (ä¸šåŠ¡)                           â”‚    â”‚
â”‚  â”‚    â€¢ trace_id (å¯è§‚æµ‹)                          â”‚    â”‚
â”‚  â”‚    â€¢ user_id (ä¸šåŠ¡)                            â”‚    â”‚
â”‚  â”‚    â€¢ latency (å¯è§‚æµ‹)                           â”‚    â”‚
â”‚  â”‚                                                 â”‚    â”‚
â”‚  â”‚  - PaymentMetric (æ”¯ä»˜æŒ‡æ ‡)                     â”‚    â”‚
â”‚  â”‚    â€¢ payment_amount (ä¸šåŠ¡)                      â”‚    â”‚
â”‚  â”‚    â€¢ payment_count (ä¸šåŠ¡)                       â”‚    â”‚
â”‚  â”‚    â€¢ success_rate (å¯è§‚æµ‹)                      â”‚    â”‚
â”‚  â”‚    â€¢ error_rate (å¯è§‚æµ‹)                       â”‚    â”‚
â”‚  â”‚                                                 â”‚    â”‚
â”‚  â”‚  - UserLog (ç”¨æˆ·æ—¥å¿—)                           â”‚    â”‚
â”‚  â”‚    â€¢ user_id (ä¸šåŠ¡)                            â”‚    â”‚
â”‚  â”‚    â€¢ log_message (ä¸šåŠ¡)                         â”‚    â”‚
â”‚  â”‚    â€¢ severity (å¯è§‚æµ‹)                          â”‚    â”‚
â”‚  â”‚    â€¢ trace_id (å¯è§‚æµ‹)                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.3.2 è¯­ä¹‰æ˜ å°„

```go
// è¯­ä¹‰æ˜ å°„å®ç°
type SemanticMapper struct {
    mappings map[string]SemanticMapping
}

type SemanticMapping struct {
    BusinessField string
    OTLPField    string
    Transform    func(interface{}) interface{}
}

func (sm *SemanticMapper) MapBusinessToOTLP(businessData BusinessData) OTLPData {
    otlpData := OTLPData{}

    // æ˜ å°„è®¢å•ID
    if mapping, ok := sm.mappings["order_id"]; ok {
        otlpData.Attributes[mapping.OTLPField] =
            mapping.Transform(businessData.OrderID)
    }

    // æ˜ å°„ç”¨æˆ·ID
    if mapping, ok := sm.mappings["user_id"]; ok {
        otlpData.Attributes[mapping.OTLPField] =
            mapping.Transform(businessData.UserID)
    }

    // æ˜ å°„æ—¶é—´æˆ³
    otlpData.StartTime = businessData.Metadata.CreatedAt

    return otlpData
}

// ä½¿ç”¨ç¤ºä¾‹
mapper := &SemanticMapper{
    mappings: map[string]SemanticMapping{
        "order_id": {
            BusinessField: "Order.ID",
            OTLPField:     "order.id",
            Transform:     func(v interface{}) interface{} { return v },
        },
        "user_id": {
            BusinessField: "Order.UserID",
            OTLPField:     "user.id",
            Transform:     func(v interface{}) interface{} { return v },
        },
    },
}

otlpData := mapper.MapBusinessToOTLP(orderData)
```

### 4.4 åˆ†æä¸æ´å¯Ÿ

#### 4.4.1 ä¸šåŠ¡æ€§èƒ½åˆ†æ

```text
ä¸šåŠ¡æ€§èƒ½åˆ†æ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  åˆ†æç»´åº¦:                                               â”‚
â”‚  1. è®¢å•å¤„ç†æ€§èƒ½:                                       â”‚
â”‚     - è®¢å•åˆ›å»ºå»¶è¿Ÿ                                       â”‚
â”‚     - è®¢å•æ”¯ä»˜å»¶è¿Ÿ                                       â”‚
â”‚     - è®¢å•é…é€å»¶è¿Ÿ                                       â”‚
â”‚                                                         â”‚
â”‚  2. ç”¨æˆ·è¡Œä¸ºåˆ†æ:                                       â”‚
â”‚     - ç”¨æˆ·è®¿é—®è·¯å¾„                                       â”‚
â”‚     - ç”¨æˆ·è½¬åŒ–ç‡                                         â”‚
â”‚     - ç”¨æˆ·æµå¤±ç‡                                         â”‚
â”‚                                                         â”‚
â”‚  3. ä¸šåŠ¡æŒ‡æ ‡åˆ†æ:                                       â”‚
â”‚     - GMV (æ€»äº¤æ˜“é¢)                                    â”‚
â”‚     - è®¢å•é‡                                            â”‚
â”‚     - å®¢å•ä»·                                            â”‚
â”‚                                                         â”‚
â”‚  åˆ†æç¤ºä¾‹:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ æŸ¥è¯¢: ä»Šæ—¥è®¢å•å¤„ç†æ€§èƒ½                            â”‚    â”‚
â”‚  â”‚ SELECT                                          â”‚    â”‚
â”‚  â”‚   COUNT(*) as order_count,                      â”‚    â”‚
â”‚  â”‚   AVG(duration) as avg_latency,                 â”‚    â”‚
â”‚  â”‚   PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY duration) as p95_latency
â”‚  â”‚ FROM traces                                     â”‚    â”‚
â”‚  â”‚ WHERE name = 'order.create'                     â”‚    â”‚
â”‚  â”‚   AND start_time >= CURRENT_DATE               â”‚    â”‚
â”‚  â”‚ GROUP BY service_name                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  ç»“æœ:                                                  â”‚
â”‚  service_name    | order_count | avg_latency | p95_latency
â”‚  order-service   | 1000        | 150ms       | 300ms
â”‚  payment-service | 1000        | 200ms       | 500ms
â”‚  delivery-service| 1000        | 500ms       | 1000ms
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.4.2 æ ¹å› åˆ†æ

```text
æ ¹å› åˆ†ææµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  1. é—®é¢˜å‘ç°:                                           â”‚
â”‚     - Metricså‘Šè­¦: è®¢å•åˆ›å»ºå»¶è¿Ÿp95 > 500ms              â”‚
â”‚     - æ—¶é—´: 2025-10-11 14:00:00                        â”‚
â”‚                                                         â”‚
â”‚  2. Traceåˆ†æ:                                          â”‚
â”‚     SELECT * FROM traces                               â”‚
â”‚     WHERE name = 'order.create'                         â”‚
â”‚       AND start_time BETWEEN '2025-10-11 14:00:00' AND '2025-10-11 14:05:00'
â”‚       AND duration > 500ms                             â”‚
â”‚                                                         â”‚
â”‚  3. Spanåˆ†æ:                                            â”‚
â”‚     - Span A: HTTP POST /api/orders (200ms)            â”‚
â”‚       â”œâ”€ Span B: Database INSERT orders (150ms)        â”‚
â”‚       â”œâ”€ Span C: HTTP POST /api/payments (300ms)      â”‚
â”‚       â”‚  â””â”€ Span D: Database UPDATE payments (250ms)
â”‚       â””â”€ Span E: HTTP POST /api/inventory (100ms)    â”‚
â”‚                                                         â”‚
â”‚  4. æ ¹å› å®šä½:                                           â”‚
â”‚     - é—®é¢˜: Span D (Database UPDATE payments) å»¶è¿Ÿé«˜ â”‚
â”‚     - åŸå› : æ•°æ®åº“é”ç«äº‰                                â”‚
â”‚     - è¯æ®: å¤šä¸ªè®¢å•åŒæ—¶æ›´æ–°åŒä¸€æ”¯ä»˜è®°å½•                â”‚
â”‚                                                         â”‚
â”‚  5. è§£å†³æ–¹æ¡ˆ:                                           â”‚
â”‚     - ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•                                    â”‚
â”‚     - ä½¿ç”¨ä¹è§‚é”æ›¿ä»£æ‚²è§‚é”                              â”‚
â”‚     - å¢åŠ æ•°æ®åº“è¿æ¥æ±                                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¬ å½¢å¼åŒ–éªŒè¯

### å½¢å¼åŒ–å®šä¹‰

```text
å®šä¹‰ (OTLPæ•°æ®æ¨¡å‹):
OTLPDataModel = (T, M, L, R)

å…¶ä¸­:
T: Traces = {Spanâ‚, Spanâ‚‚, ..., Spanâ‚™}
M: Metrics = {Metricâ‚, Metricâ‚‚, ..., Metricâ‚™}
L: Logs = {Logâ‚, Logâ‚‚, ..., Logâ‚™}
R: Resource

å®šä¹‰ (Span):
Span = (tid, sid, psid, n, k, tâ‚€, tâ‚‚, A, E, L, s)

çº¦æŸ:
1. tid âˆˆ TraceID = {0,1}^128 \ {0^128}
2. sid âˆˆ SpanID = {0,1}^64 \ {0^64}
3. psid âˆˆ SpanID âˆª {âŠ¥}
4. n âˆˆ String \ {Îµ}
5. k âˆˆ SpanKind = {INTERNAL, SERVER, CLIENT, PRODUCER, CONSUMER}
6. tâ‚€, tâ‚ âˆˆ â„•âº, tâ‚€ â‰¤ tâ‚
7. A âŠ† Attribute
8. E âˆˆ Event*
9. L âŠ† Link
10. s âˆˆ Status

å®šç† (æ—¶é—´é¡ºåº):
âˆ€ span S, tâ‚€(S) â‰¤ tâ‚(S)

å®šç† (çˆ¶å­å…³ç³»):
âˆ€ span C, parent P,
  å¦‚æœ psid(C) = sid(P) âˆ§ tid(C) = tid(P), åˆ™:
    tâ‚€(P) â‰¤ tâ‚€(C) âˆ§ tâ‚(C) â‰¤ tâ‚(P)

å®šç† (éå¾ªç¯æ€§):
âˆ€ span S, Â¬âˆƒè·¯å¾„ S â†’ ... â†’ S
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### æ•°æ®æµæœ€ä½³å®è·µ

```text
1. æ‰¹é‡ä¼ è¾“
   âœ… ä½¿ç”¨BatchProcessoræ‰¹é‡å¯¼å‡º
   âœ… æ‰¹é‡å¤§å°: 512-1024
   âœ… è¶…æ—¶æ—¶é—´: 5ç§’

2. é‡‡æ ·ç­–ç•¥
   âœ… å¤´éƒ¨é‡‡æ ·: æ¦‚ç‡é‡‡æ · (0.1-1%)
   âœ… å°¾éƒ¨é‡‡æ ·: åŸºäºé”™è¯¯/å»¶è¿Ÿé‡‡æ ·
   âœ… é‡‡æ ·ç‡: æ ¹æ®å­˜å‚¨æˆæœ¬è°ƒæ•´

3. å‹ç¼©ä¼ è¾“
   âœ… ä½¿ç”¨Protobufç¼–ç 
   âœ… å¯ç”¨gzipå‹ç¼©
   âœ… å‹ç¼©æ¯”: 80-90%

4. å­˜å‚¨ä¼˜åŒ–
   âœ… æ—¶é—´åˆ†åŒº: æŒ‰å¤©åˆ†åŒº
   âœ… æ ‡ç­¾åˆ†åŒº: æŒ‰serviceåˆ†åŒº
   âœ… å‹ç¼©: å¯ç”¨åˆ—å¼å‹ç¼©
```

### è¯­ä¹‰æ¨¡å‹æœ€ä½³å®è·µ

```text
1. è¯­ä¹‰çº¦å®š
   âœ… ä½¿ç”¨æ ‡å‡†è¯­ä¹‰çº¦å®š
   âœ… HTTP: http.method, http.status_code
   âœ… Database: db.system, db.operation
   âœ… é¿å…è‡ªå®šä¹‰å±æ€§

2. ç±»å‹é€‰æ‹©
   âœ… Counter: è®¡æ•°ç±»æŒ‡æ ‡
   âœ… Histogram: å»¶è¿Ÿ/å¤§å°åˆ†å¸ƒ
   âœ… Gauge: ç¬æ—¶å€¼
   âœ… é¿å…Summary (å·²åºŸå¼ƒ)

3. åŸºæ•°æ§åˆ¶
   âœ… ç»´åº¦æ•°é‡: < 10
   âœ… ç»´åº¦åŸºæ•°: < 1000
   âœ… æ€»åŸºæ•°: < 100,000
   âœ… é¿å…é«˜åŸºæ•°ç»´åº¦
```

### å¤„ç†ä¸Šä¸‹æ–‡æœ€ä½³å®è·µ

```text
1. ä¸Šä¸‹æ–‡ä¼ æ’­
   âœ… ä½¿ç”¨W3C TraceContext
   âœ… æ­£ç¡®ä¼ é€’traceparent
   âœ… ç»§æ‰¿é‡‡æ ·å†³ç­–

2. æ—¶é’ŸåŒæ­¥
   âœ… ä½¿ç”¨å•è°ƒæ—¶é’Ÿ
   âœ… NTPæ—¶é’ŸåŒæ­¥
   âœ… å®¹å¿æ—¶é’Ÿæ¼‚ç§»

3. æœ¬åœ°ç¼“å†²
   âœ… å†…å­˜ç¼“å†²: 512-1024æ¡
   âœ… ç£ç›˜ç¼“å†²: æ•…éšœæ¢å¤
   âœ… è‡ªåŠ¨åˆ·æ–°: 5ç§’é—´éš”
```

### åº”ç”¨é›†æˆæœ€ä½³å®è·µ

```text
1. æ•°æ®å…³è”
   âœ… TraceIDå…³è”ä¸šåŠ¡æ•°æ®
   âœ… è‡ªå®šä¹‰å±æ€§æ³¨å…¥ä¸šåŠ¡ID
   âœ… æ—¶é—´æˆ³å…³è”

2. å»é‡ç­–ç•¥
   âœ… æ—¶é—´çª—å£å»é‡
   âœ… äº‹ä»¶IDå»é‡
   âœ… é”™è¯¯ä¿¡æ¯å»é‡

3. è¯­ä¹‰èåˆ
   âœ… ç»Ÿä¸€è¯­ä¹‰æ¨¡å‹
   âœ… è¯­ä¹‰æ˜ å°„
   âœ… ä¸šåŠ¡æŒ‡æ ‡ä¸å¯è§‚æµ‹æ€§æŒ‡æ ‡èåˆ
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹è§„èŒƒ

- **OTLPè§„èŒƒ**: <https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md>
- **Traceè§„èŒƒ**: <https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/trace/api.md>
- **Metricsè§„èŒƒ**: <https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/metrics/api.md>
- **Logsè§„èŒƒ**: <https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/logs/api.md>

### è¯­ä¹‰çº¦å®š

- **é€šç”¨è¯­ä¹‰çº¦å®š**: <https://opentelemetry.io/docs/specs/semconv/general/>
- **HTTPè¯­ä¹‰çº¦å®š**: <https://opentelemetry.io/docs/specs/semconv/http/>
- **æ•°æ®åº“è¯­ä¹‰çº¦å®š**: <https://opentelemetry.io/docs/specs/semconv/database/>

### å®ç°å‚è€ƒ

- **Go SDK**: <https://pkg.go.dev/go.opentelemetry.io/otel>
- **Python SDK**: <https://opentelemetry-python.readthedocs.io/>
- **Java SDK**: <https://opentelemetry.io/docs/instrumentation/java/>

### ç›¸å…³æ–‡æ¡£

- **W3C TraceContext**: <https://www.w3.org/TR/trace-context/>
- **Prometheus**: <https://prometheus.io/docs/>
- **Jaeger**: <https://www.jaegertracing.io/docs/>

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæˆ
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
**ä¸‹ä¸€æ­¥**: ç»“åˆå®é™…æ¡ˆä¾‹æ·±åŒ–åˆ†æ
