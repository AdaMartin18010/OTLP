# OTLPæ•°æ®æµè§†è§’ï¼šæ•°æ®ä¼ è¾“æœºåˆ¶æ·±åº¦åˆ†æ

> **æ–‡æ¡£ç±»å‹**: æ•°æ®æ¨¡å‹æ·±åº¦åˆ†æ  
> **åˆ†æç»´åº¦**: æ•°æ®æµè§†è§’ - ä¼ è¾“æœºåˆ¶  
> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´10æœˆ11æ—¥  
> **æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“‹ ç›®å½•

- [OTLPæ•°æ®æµè§†è§’ï¼šæ•°æ®ä¼ è¾“æœºåˆ¶æ·±åº¦åˆ†æ](#otlpæ•°æ®æµè§†è§’æ•°æ®ä¼ è¾“æœºåˆ¶æ·±åº¦åˆ†æ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ æ‰§è¡Œæ‘˜è¦](#-æ‰§è¡Œæ‘˜è¦)
  - [ğŸ“Š ä¼ è¾“åè®®å…¨æ™¯](#-ä¼ è¾“åè®®å…¨æ™¯)
    - [åè®®å¯¹æ¯”çŸ©é˜µ](#åè®®å¯¹æ¯”çŸ©é˜µ)
    - [åè®®é€‰æ‹©å†³ç­–æ ‘](#åè®®é€‰æ‹©å†³ç­–æ ‘)
  - [gRPCä¼ è¾“æœºåˆ¶](#grpcä¼ è¾“æœºåˆ¶)
    - [gRPCæœåŠ¡å®šä¹‰](#grpcæœåŠ¡å®šä¹‰)
    - [gRPCä¼ è¾“æµç¨‹](#grpcä¼ è¾“æµç¨‹)
    - [gRPCæ€§èƒ½ç‰¹æ€§](#grpcæ€§èƒ½ç‰¹æ€§)
  - [HTTP/JSONä¼ è¾“æœºåˆ¶](#httpjsonä¼ è¾“æœºåˆ¶)
    - [HTTP/JSONç«¯ç‚¹å®šä¹‰](#httpjsonç«¯ç‚¹å®šä¹‰)
    - [HTTP/JSONè¯·æ±‚æ ¼å¼](#httpjsonè¯·æ±‚æ ¼å¼)
    - [HTTP/JSONä¼ è¾“æµç¨‹](#httpjsonä¼ è¾“æµç¨‹)
  - [ğŸ“ˆ ä¼ è¾“æ€§èƒ½åˆ†æ](#-ä¼ è¾“æ€§èƒ½åˆ†æ)
    - [æ€§èƒ½åŸºå‡†æµ‹è¯•](#æ€§èƒ½åŸºå‡†æµ‹è¯•)
    - [åºåˆ—åŒ–æ€§èƒ½å¯¹æ¯”](#åºåˆ—åŒ–æ€§èƒ½å¯¹æ¯”)
  - [âš¡ ä¼ è¾“ä¼˜åŒ–ç­–ç•¥](#-ä¼ è¾“ä¼˜åŒ–ç­–ç•¥)
    - [1. æ‰¹é‡ä¼ è¾“ä¼˜åŒ–](#1-æ‰¹é‡ä¼ è¾“ä¼˜åŒ–)
    - [2. å‹ç¼©ä¼ è¾“ä¼˜åŒ–](#2-å‹ç¼©ä¼ è¾“ä¼˜åŒ–)
    - [3. æµå¼ä¼ è¾“ä¼˜åŒ–](#3-æµå¼ä¼ è¾“ä¼˜åŒ–)
  - [ğŸ”„ æµå¼ä¼ è¾“æœºåˆ¶](#-æµå¼ä¼ è¾“æœºåˆ¶)
    - [gRPCæµå¼ä¼ è¾“](#grpcæµå¼ä¼ è¾“)
    - [æµå¼ä¼ è¾“å®ç°](#æµå¼ä¼ è¾“å®ç°)
  - [ğŸ“¦ æ‰¹é‡ä¼ è¾“æœºåˆ¶](#-æ‰¹é‡ä¼ è¾“æœºåˆ¶)
    - [æ‰¹é‡ä¼ è¾“ç­–ç•¥](#æ‰¹é‡ä¼ è¾“ç­–ç•¥)
    - [æ‰¹é‡ä¼ è¾“å®ç°](#æ‰¹é‡ä¼ è¾“å®ç°)
  - [ğŸ›¡ï¸ ä¼ è¾“å¯é æ€§ä¿è¯](#ï¸-ä¼ è¾“å¯é æ€§ä¿è¯)
    - [é‡è¯•æœºåˆ¶](#é‡è¯•æœºåˆ¶)
    - [è¶…æ—¶æ§åˆ¶](#è¶…æ—¶æ§åˆ¶)
    - [èƒŒå‹å¤„ç†](#èƒŒå‹å¤„ç†)
  - [ğŸ’¡ å®æˆ˜æ¡ˆä¾‹](#-å®æˆ˜æ¡ˆä¾‹)
    - [æ¡ˆä¾‹1ï¼šé«˜å¹¶å‘åœºæ™¯ä¼ è¾“ä¼˜åŒ–](#æ¡ˆä¾‹1é«˜å¹¶å‘åœºæ™¯ä¼ è¾“ä¼˜åŒ–)
    - [æ¡ˆä¾‹2ï¼šä½å»¶è¿Ÿåœºæ™¯ä¼ è¾“ä¼˜åŒ–](#æ¡ˆä¾‹2ä½å»¶è¿Ÿåœºæ™¯ä¼ è¾“ä¼˜åŒ–)
  - [ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®](#-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [ä¼ è¾“ä¼˜åŒ–çŸ©é˜µ](#ä¼ è¾“ä¼˜åŒ–çŸ©é˜µ)
  - [ğŸ¯ æ€»ç»“](#-æ€»ç»“)

---

## ğŸ¯ æ‰§è¡Œæ‘˜è¦

**æ•°æ®ä¼ è¾“æœºåˆ¶**æ˜¯OTLPæ•°æ®æµçš„æ ¸å¿ƒç¯èŠ‚ï¼Œå†³å®šäº†æ•°æ®çš„ä¼ è¾“æ•ˆç‡ã€å¯é æ€§å’Œæˆæœ¬ã€‚

```text
ä¼ è¾“æœºåˆ¶å…¨æ™¯:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                OTLPæ•°æ®ä¼ è¾“æœºåˆ¶ä½“ç³»                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ä¼ è¾“åè®®                                      â”‚      â”‚
â”‚  â”‚  - gRPC (æ¨è)                                 â”‚      â”‚
â”‚  â”‚  - HTTP/JSON (å…¼å®¹)                            â”‚      â”‚
â”‚  â”‚  - WebSocket (å®æ—¶)                            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                         â”‚                               â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â”‚               â”‚               â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ æµå¼ä¼ è¾“    â”‚  â”‚ æ‰¹é‡ä¼ è¾“    â”‚  â”‚ å‹ç¼©ä¼ è¾“    â”‚        â”‚
â”‚  â”‚ - Streaming â”‚  â”‚ - Batching  â”‚  â”‚ - Snappy   â”‚        â”‚
â”‚  â”‚ - ä½å»¶è¿Ÿ    â”‚  â”‚ - é«˜åå    â”‚  â”‚ - Zstd     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  å¯é æ€§ä¿è¯                                    â”‚      â”‚
â”‚  â”‚  - é‡è¯•æœºåˆ¶                                    â”‚      â”‚
â”‚  â”‚  - è¶…æ—¶æ§åˆ¶                                    â”‚      â”‚
â”‚  â”‚  - èƒŒå‹å¤„ç†                                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæ´å¯Ÿ**ï¼š

1. **ä¼ è¾“åè®®**ï¼šgRPC > HTTP/JSONï¼ˆæ€§èƒ½ï¼‰
2. **ä¼ è¾“æ¨¡å¼**ï¼šæµå¼ > æ‰¹é‡ï¼ˆå»¶è¿Ÿï¼‰| æ‰¹é‡ > æµå¼ï¼ˆååï¼‰
3. **å‹ç¼©ç®—æ³•**ï¼šZstd > Snappyï¼ˆå‹ç¼©ç‡ï¼‰| Snappy > Zstdï¼ˆé€Ÿåº¦ï¼‰
4. **å¯é æ€§**ï¼šé‡è¯• + è¶…æ—¶ + èƒŒå‹

---

## ğŸ“Š ä¼ è¾“åè®®å…¨æ™¯

### åè®®å¯¹æ¯”çŸ©é˜µ

```text
ä¼ è¾“åè®®å¯¹æ¯”:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰¹æ€§          â”‚ gRPC    â”‚ HTTP/JSON â”‚ WebSocket â”‚      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€§èƒ½          â”‚ â­â­â­â­â­ â”‚ â­â­â­     â”‚ â­â­â­â­   â”‚      â”‚
â”‚  å»¶è¿Ÿ          â”‚ ä½      â”‚ ä¸­        â”‚ ä½        â”‚      â”‚
â”‚  ååé‡        â”‚ é«˜      â”‚ ä¸­        â”‚ ä¸­        â”‚      â”‚
â”‚  å‹ç¼©          â”‚ åŸç”Ÿ    â”‚ æ‰‹åŠ¨      â”‚ åŸç”Ÿ      â”‚      â”‚
â”‚  æµå¼ä¼ è¾“      â”‚ æ”¯æŒ    â”‚ ä¸æ”¯æŒ    â”‚ æ”¯æŒ      â”‚      â”‚
â”‚  åŒå‘é€šä¿¡      â”‚ æ”¯æŒ    â”‚ ä¸æ”¯æŒ    â”‚ æ”¯æŒ      â”‚      â”‚
â”‚  æµè§ˆå™¨æ”¯æŒ    â”‚ æœ‰é™    â”‚ å®Œå…¨      â”‚ å®Œå…¨      â”‚      â”‚
â”‚  å®ç°å¤æ‚åº¦    â”‚ ä¸­      â”‚ ä½        â”‚ ä¸­        â”‚      â”‚
â”‚  æ¨èåœºæ™¯      â”‚ ç”Ÿäº§    â”‚ å…¼å®¹      â”‚ å®æ—¶      â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åè®®é€‰æ‹©å†³ç­–æ ‘

```text
åè®®é€‰æ‹©å†³ç­–æ ‘:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 åè®®é€‰æ‹©å†³ç­–æ ‘                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚                     éœ€è¦ä¼ è¾“OTLPæ•°æ®?                    â”‚
â”‚                            â”‚                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚           â”‚                â”‚                â”‚           â”‚
â”‚      æµè§ˆå™¨ç¯å¢ƒ?      ç”Ÿäº§ç¯å¢ƒ?        å®æ—¶åœºæ™¯?         â”‚
â”‚           â”‚                â”‚                â”‚           â”‚
â”‚      HTTP/JSON        gRPC          WebSocket           â”‚
â”‚           â”‚                â”‚                â”‚           â”‚
â”‚      å…¼å®¹æ€§å¥½        æ€§èƒ½æœ€ä¼˜        ä½å»¶è¿Ÿ               â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## gRPCä¼ è¾“æœºåˆ¶

### gRPCæœåŠ¡å®šä¹‰

```protobuf
// OTLP gRPCæœåŠ¡å®šä¹‰
service TraceService {
  // å¯¼å‡ºSpan
  rpc Export(ExportTraceServiceRequest) returns (ExportTraceServiceResponse);
}

service MetricService {
  // å¯¼å‡ºMetric
  rpc Export(ExportMetricsServiceRequest) returns (ExportMetricsServiceResponse);
}

service LogService {
  // å¯¼å‡ºLog
  rpc Export(ExportLogsServiceRequest) returns (ExportLogsServiceResponse);
}

// Traceå¯¼å‡ºè¯·æ±‚
message ExportTraceServiceRequest {
  repeated ResourceSpans resource_spans = 1;
}

message ResourceSpans {
  Resource resource = 1;
  repeated ScopeSpans scope_spans = 2;
  string schema_url = 3;
}

message ScopeSpans {
  InstrumentationScope scope = 1;
  repeated Span spans = 2;
  string schema_url = 3;
}

// Metricså¯¼å‡ºè¯·æ±‚
message ExportMetricsServiceRequest {
  repeated ResourceMetrics resource_metrics = 1;
}

message ResourceMetrics {
  Resource resource = 1;
  repeated ScopeMetrics scope_metrics = 2;
  string schema_url = 3;
}

message ScopeMetrics {
  InstrumentationScope scope = 1;
  repeated Metric metrics = 2;
  string schema_url = 3;
}

// Logså¯¼å‡ºè¯·æ±‚
message ExportLogsServiceRequest {
  repeated ResourceLogs resource_logs = 1;
}

message ResourceLogs {
  Resource resource = 1;
  repeated ScopeLogs scope_logs = 2;
  string schema_url = 3;
}

message ScopeLogs {
  InstrumentationScope scope = 1;
  repeated LogRecord log_records = 2;
  string schema_url = 3;
}
```

### gRPCä¼ è¾“æµç¨‹

```text
gRPCä¼ è¾“æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OTLP gRPCä¼ è¾“æµç¨‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  SDK     â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚       â”‚                                                 â”‚
â”‚       â”‚ 1. åºåˆ—åŒ– (Protobuf)                           â”‚
â”‚       â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ åºåˆ—åŒ–æ•°æ®â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚       â”‚                                                 â”‚
â”‚       â”‚ 2. HTTP/2ä¼ è¾“                                  â”‚
â”‚       â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ Collectorâ”‚                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚       â”‚                                                 â”‚
â”‚       â”‚ 3. ååºåˆ—åŒ–                                     â”‚
â”‚       â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ å¤„ç†æ•°æ®  â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### gRPCæ€§èƒ½ç‰¹æ€§

```text
gRPCæ€§èƒ½ç‰¹æ€§:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰¹æ€§          â”‚ è¯´æ˜                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åè®®          â”‚ HTTP/2                                  â”‚
â”‚  åºåˆ—åŒ–        â”‚ Protobuf (äºŒè¿›åˆ¶)                       â”‚
â”‚  å‹ç¼©          â”‚ gzip (é»˜è®¤)                             â”‚
â”‚  å¤šè·¯å¤ç”¨      â”‚ æ”¯æŒ (HTTP/2ç‰¹æ€§)                        â”‚
â”‚  æµå¼ä¼ è¾“      â”‚ æ”¯æŒ (Server/Client/Bidirectional)      â”‚
â”‚  è¶…æ—¶æ§åˆ¶      â”‚ æ”¯æŒ (Deadline)                         â”‚
â”‚  è´Ÿè½½å‡è¡¡      â”‚ æ”¯æŒ (gRPC-LB)                          â”‚
â”‚  å¥åº·æ£€æŸ¥      â”‚ æ”¯æŒ (Health Check)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## HTTP/JSONä¼ è¾“æœºåˆ¶

### HTTP/JSONç«¯ç‚¹å®šä¹‰

```text
HTTP/JSONç«¯ç‚¹å®šä¹‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç«¯ç‚¹          â”‚ æ–¹æ³•  â”‚ è·¯å¾„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Traces        â”‚ POST  â”‚ /v1/traces                      â”‚
â”‚  Metrics       â”‚ POST  â”‚ /v1/metrics                     â”‚
â”‚  Logs          â”‚ POST  â”‚ /v1/logs                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### HTTP/JSONè¯·æ±‚æ ¼å¼

```json
// Traceså¯¼å‡ºè¯·æ±‚
POST /v1/traces HTTP/1.1
Host: collector.example.com
Content-Type: application/json

{
  "resourceSpans": [
    {
      "resource": {
        "attributes": [
          {"key": "service.name", "value": {"stringValue": "user-service"}},
          {"key": "service.version", "value": {"stringValue": "1.0.0"}}
        ]
      },
      "scopeSpans": [
        {
          "scope": {
            "name": "user-service",
            "version": "1.0.0"
          },
          "spans": [
            {
              "traceId": "4bf92f3577b34da6a3ce929d0e0e4736",
              "spanId": "00f067aa0ba902b7",
              "name": "GET /api/users",
              "kind": "SPAN_KIND_SERVER",
              "startTimeUnixNano": "1609459200000000000",
              "endTimeUnixNano": "1609459200100000000",
              "attributes": [
                {"key": "http.method", "value": {"stringValue": "GET"}},
                {"key": "http.route", "value": {"stringValue": "/api/users"}},
                {"key": "http.status_code", "value": {"intValue": "200"}}
              ],
              "status": {
                "code": "STATUS_CODE_OK"
              }
            }
          ]
        }
      ]
    }
  ]
}
```

### HTTP/JSONä¼ è¾“æµç¨‹

```text
HTTP/JSONä¼ è¾“æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            OTLP HTTP/JSONä¼ è¾“æµç¨‹                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  SDK     â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚       â”‚                                                 â”‚
â”‚       â”‚ 1. åºåˆ—åŒ– (JSON)                                â”‚
â”‚       â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ JSONæ•°æ®  â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚       â”‚                                                 â”‚
â”‚       â”‚ 2. HTTP POSTä¼ è¾“                                â”‚
â”‚       â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ Collectorâ”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚       â”‚                                                 â”‚
â”‚       â”‚ 3. è§£æJSON                                     â”‚
â”‚       â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ å¤„ç†æ•°æ®  â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ ä¼ è¾“æ€§èƒ½åˆ†æ

### æ€§èƒ½åŸºå‡†æµ‹è¯•

```text
æ€§èƒ½åŸºå‡†æµ‹è¯• (10,000 Spans):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åè®®          â”‚ ååé‡    â”‚ å»¶è¿Ÿ      â”‚ CPUä½¿ç”¨ç‡      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  gRPC          â”‚ 50K spans/sâ”‚ 5ms     â”‚ 15%            â”‚
â”‚  HTTP/JSON     â”‚ 15K spans/sâ”‚ 20ms    â”‚ 35%            â”‚
â”‚  WebSocket     â”‚ 30K spans/sâ”‚ 10ms    â”‚ 25%            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åºåˆ—åŒ–æ€§èƒ½å¯¹æ¯”

```text
åºåˆ—åŒ–æ€§èƒ½å¯¹æ¯” (10,000 Spans):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¼å¼          â”‚ ä½“ç§¯      â”‚ åºåˆ—åŒ–æ—¶é—´ â”‚ ååºåˆ—åŒ–æ—¶é—´   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Protobuf      â”‚ 3.4 MB    â”‚ 10ms     â”‚ 8ms           â”‚
â”‚  JSON          â”‚ 12.5 MB   â”‚ 45ms     â”‚ 60ms          â”‚
â”‚  MessagePack   â”‚ 4.2 MB    â”‚ 15ms     â”‚ 12ms          â”‚
â”‚  CBOR          â”‚ 3.8 MB    â”‚ 12ms     â”‚ 10ms          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ ä¼ è¾“ä¼˜åŒ–ç­–ç•¥

### 1. æ‰¹é‡ä¼ è¾“ä¼˜åŒ–

```go
// æ‰¹é‡ä¼ è¾“ä¼˜åŒ–ç¤ºä¾‹
package main

import (
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
    "go.opentelemetry.io/otel/sdk/trace"
    "time"
)

func setupBatchTracer() *trace.TracerProvider {
    exporter, _ := otlptracegrpc.New(
        otlptracegrpc.WithEndpoint("collector:4317"),
        otlptracegrpc.WithInsecure(),
    )
    
    // æ‰¹é‡å¤„ç†å™¨é…ç½®
    batchProcessor := trace.NewBatchSpanProcessor(exporter,
        // æ‰¹é‡å¤§å°
        trace.WithMaxExportBatchSize(512),
        
        // æ‰¹é‡è¶…æ—¶
        trace.WithBatchTimeout(5*time.Second),
        
        // å¯¼å‡ºè¶…æ—¶
        trace.WithExportTimeout(30*time.Second),
        
        // æœ€å¤§é˜Ÿåˆ—å¤§å°
        trace.WithMaxQueueSize(2048),
    )
    
    return trace.NewTracerProvider(
        trace.WithSpanProcessor(batchProcessor),
        trace.WithResource(resource.NewWithAttributes(
            semconv.SchemaURL,
            semconv.ServiceNameKey.String("user-service"),
            semconv.ServiceVersionKey.String("1.0.0"),
        )),
    )
}
```

### 2. å‹ç¼©ä¼ è¾“ä¼˜åŒ–

```go
// å‹ç¼©ä¼ è¾“ä¼˜åŒ–ç¤ºä¾‹
package main

import (
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
    "google.golang.org/grpc/encoding/gzip"
)

func setupCompressedTracer() *trace.TracerProvider {
    exporter, _ := otlptracegrpc.New(
        otlptracegrpc.WithEndpoint("collector:4317"),
        otlptracegrpc.WithInsecure(),
        
        // å¯ç”¨gzipå‹ç¼©
        otlptracegrpc.WithCompressor(gzip.Name),
    )
    
    return trace.NewTracerProvider(
        trace.WithSpanProcessor(trace.NewBatchSpanProcessor(exporter)),
    )
}
```

### 3. æµå¼ä¼ è¾“ä¼˜åŒ–

```go
// æµå¼ä¼ è¾“ä¼˜åŒ–ç¤ºä¾‹
package main

import (
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
    "go.opentelemetry.io/otel/sdk/trace"
)

func setupStreamingTracer() *trace.TracerProvider {
    exporter, _ := otlptracegrpc.New(
        otlptracegrpc.WithEndpoint("collector:4317"),
        otlptracegrpc.WithInsecure(),
        
        // æµå¼ä¼ è¾“é…ç½®
        otlptracegrpc.WithRetry(otlptracegrpc.RetryConfig{
            Enabled:         true,
            InitialInterval: 100 * time.Millisecond,
            MaxInterval:     30 * time.Second,
            MaxElapsedTime:  5 * time.Minute,
        }),
    )
    
    return trace.NewTracerProvider(
        trace.WithSpanProcessor(trace.NewBatchSpanProcessor(exporter)),
    )
}
```

---

## ğŸ”„ æµå¼ä¼ è¾“æœºåˆ¶

### gRPCæµå¼ä¼ è¾“

```protobuf
// æµå¼ä¼ è¾“æœåŠ¡å®šä¹‰
service TraceService {
  // æ‰¹é‡å¯¼å‡º
  rpc Export(ExportTraceServiceRequest) returns (ExportTraceServiceResponse);
  
  // æµå¼å¯¼å‡º (Server Streaming)
  rpc ExportStream(ExportTraceServiceRequest) 
      returns (stream ExportTraceServiceResponse);
  
  // åŒå‘æµå¼å¯¼å‡º (Bidirectional Streaming)
  rpc ExportBidirectional(stream ExportTraceServiceRequest) 
      returns (stream ExportTraceServiceResponse);
}
```

### æµå¼ä¼ è¾“å®ç°

```go
// æµå¼ä¼ è¾“å®ç°
package main

import (
    "context"
    "io"
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
)

func streamTraces(ctx context.Context, spans []Span) error {
    conn, err := grpc.Dial("collector:4317", grpc.WithInsecure())
    if err != nil {
        return err
    }
    defer conn.Close()
    
    client := trace.NewTraceServiceClient(conn)
    
    // åˆ›å»ºåŒå‘æµ
    stream, err := client.ExportBidirectional(ctx)
    if err != nil {
        return err
    }
    
    // å‘é€æ•°æ®
    for _, span := range spans {
        req := &trace.ExportTraceServiceRequest{
            ResourceSpans: []*trace.ResourceSpans{{
                Resource: &resource.Resource{
                    Attributes: []*common.KeyValue{
                        {Key: "service.name", Value: &common.AnyValue{
                            Value: &common.AnyValue_StringValue{
                                StringValue: "user-service",
                            },
                        }},
                    },
                },
                ScopeSpans: []*trace.ScopeSpans{{
                    Spans: []*trace.Span{span},
                }},
            }},
        }
        
        if err := stream.Send(req); err != nil {
            return err
        }
    }
    
    // å…³é—­å‘é€
    if err := stream.CloseSend(); err != nil {
        return err
    }
    
    // æ¥æ”¶å“åº”
    for {
        resp, err := stream.Recv()
        if err == io.EOF {
            break
        }
        if err != nil {
            return err
        }
        
        // å¤„ç†å“åº”
        _ = resp
    }
    
    return nil
}
```

---

## ğŸ“¦ æ‰¹é‡ä¼ è¾“æœºåˆ¶

### æ‰¹é‡ä¼ è¾“ç­–ç•¥

```text
æ‰¹é‡ä¼ è¾“ç­–ç•¥:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­–ç•¥          â”‚ è¯´æ˜                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å›ºå®šæ‰¹é‡      â”‚ å›ºå®šæ‰¹é‡å¤§å° (å¦‚512ä¸ªSpan)              â”‚
â”‚  æ—¶é—´æ‰¹é‡      â”‚ å›ºå®šæ—¶é—´é—´éš” (å¦‚5ç§’)                    â”‚
â”‚  è‡ªé€‚åº”æ‰¹é‡    â”‚ æ ¹æ®è´Ÿè½½åŠ¨æ€è°ƒæ•´æ‰¹é‡å¤§å°                â”‚
â”‚  ä¼˜å…ˆçº§æ‰¹é‡    â”‚ æŒ‰ä¼˜å…ˆçº§åˆ†æ‰¹ä¼ è¾“                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‰¹é‡ä¼ è¾“å®ç°

```go
// æ‰¹é‡ä¼ è¾“å®ç°
package main

import (
    "context"
    "sync"
    "time"
    "go.opentelemetry.io/otel/sdk/trace"
)

type BatchSpanProcessor struct {
    exporter trace.SpanExporter
    batch    []trace.ReadWriteSpan
    mutex    sync.Mutex
    maxSize  int
    timeout  time.Duration
}

func NewBatchSpanProcessor(exporter trace.SpanExporter, maxSize int, timeout time.Duration) *BatchSpanProcessor {
    bsp := &BatchSpanProcessor{
        exporter: exporter,
        batch:    make([]trace.ReadWriteSpan, 0, maxSize),
        maxSize:  maxSize,
        timeout:  timeout,
    }
    
    // å¯åŠ¨å®šæ—¶å™¨
    go bsp.flushPeriodically()
    
    return bsp
}

func (bsp *BatchSpanProcessor) OnEnd(span trace.ReadWriteSpan) {
    bsp.mutex.Lock()
    defer bsp.mutex.Unlock()
    
    bsp.batch = append(bsp.batch, span)
    
    // è¾¾åˆ°æ‰¹é‡å¤§å°ï¼Œç«‹å³åˆ·æ–°
    if len(bsp.batch) >= bsp.maxSize {
        bsp.flush()
    }
}

func (bsp *BatchSpanProcessor) flushPeriodically() {
    ticker := time.NewTicker(bsp.timeout)
    defer ticker.Stop()
    
    for range ticker.C {
        bsp.mutex.Lock()
        if len(bsp.batch) > 0 {
            bsp.flush()
        }
        bsp.mutex.Unlock()
    }
}

func (bsp *BatchSpanProcessor) flush() {
    if len(bsp.batch) == 0 {
        return
    }
    
    // å¯¼å‡ºæ‰¹æ¬¡
    _ = bsp.exporter.ExportSpans(context.Background(), bsp.batch)
    
    // æ¸…ç©ºæ‰¹æ¬¡
    bsp.batch = bsp.batch[:0]
}

func (bsp *BatchSpanProcessor) Shutdown(ctx context.Context) error {
    bsp.mutex.Lock()
    defer bsp.mutex.Unlock()
    
    // å¯¼å‡ºå‰©ä½™æ•°æ®
    bsp.flush()
    
    return bsp.exporter.Shutdown(ctx)
}
```

---

## ğŸ›¡ï¸ ä¼ è¾“å¯é æ€§ä¿è¯

### é‡è¯•æœºåˆ¶

```go
// é‡è¯•æœºåˆ¶å®ç°
package main

import (
    "context"
    "time"
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
)

func setupRetryTracer() *trace.TracerProvider {
    exporter, _ := otlptracegrpc.New(
        otlptracegrpc.WithEndpoint("collector:4317"),
        otlptracegrpc.WithInsecure(),
        
        // é‡è¯•é…ç½®
        otlptracegrpc.WithRetry(otlptracegrpc.RetryConfig{
            Enabled:         true,
            InitialInterval: 100 * time.Millisecond,
            MaxInterval:     30 * time.Second,
            MaxElapsedTime:  5 * time.Minute,
            Multiplier:      2.0,
        }),
    )
    
    return trace.NewTracerProvider(
        trace.WithSpanProcessor(trace.NewBatchSpanProcessor(exporter)),
    )
}
```

### è¶…æ—¶æ§åˆ¶

```go
// è¶…æ—¶æ§åˆ¶å®ç°
package main

import (
    "context"
    "time"
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
)

func setupTimeoutTracer() *trace.TracerProvider {
    exporter, _ := otlptracegrpc.New(
        otlptracegrpc.WithEndpoint("collector:4317"),
        otlptracegrpc.WithInsecure(),
        
        // è¶…æ—¶é…ç½®
        otlptracegrpc.WithTimeout(30*time.Second),
    )
    
    return trace.NewTracerProvider(
        trace.WithSpanProcessor(trace.NewBatchSpanProcessor(exporter)),
    )
}
```

### èƒŒå‹å¤„ç†

```go
// èƒŒå‹å¤„ç†å®ç°
package main

import (
    "context"
    "errors"
    "go.opentelemetry.io/otel/sdk/trace"
)

type BackpressureSpanProcessor struct {
    exporter trace.SpanExporter
    queue    chan trace.ReadWriteSpan
    maxQueue int
}

func NewBackpressureSpanProcessor(exporter trace.SpanExporter, maxQueue int) *BackpressureSpanProcessor {
    return &BackpressureSpanProcessor{
        exporter: exporter,
        queue:    make(chan trace.ReadWriteSpan, maxQueue),
        maxQueue: maxQueue,
    }
}

func (bsp *BackpressureSpanProcessor) OnEnd(span trace.ReadWriteSpan) {
    select {
    case bsp.queue <- span:
        // æˆåŠŸå…¥é˜Ÿ
    default:
        // é˜Ÿåˆ—æ»¡ï¼Œä¸¢å¼ƒæ•°æ®
        // è®°å½•æŒ‡æ ‡
        _ = span
    }
}

func (bsp *BackpressureSpanProcessor) Shutdown(ctx context.Context) error {
    close(bsp.queue)
    
    // å¯¼å‡ºå‰©ä½™æ•°æ®
    for span := range bsp.queue {
        _ = bsp.exporter.ExportSpans(ctx, []trace.ReadWriteSpan{span})
    }
    
    return bsp.exporter.Shutdown(ctx)
}
```

---

## ğŸ’¡ å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šé«˜å¹¶å‘åœºæ™¯ä¼ è¾“ä¼˜åŒ–

```go
// é«˜å¹¶å‘åœºæ™¯ä¼ è¾“ä¼˜åŒ–
package main

import (
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
    "go.opentelemetry.io/otel/sdk/trace"
    "time"
)

func setupHighConcurrencyTracer() *trace.TracerProvider {
    exporter, _ := otlptracegrpc.New(
        otlptracegrpc.WithEndpoint("collector:4317"),
        otlptracegrpc.WithInsecure(),
        
        // æ‰¹é‡é…ç½®
        otlptracegrpc.WithMaxExportBatchSize(1024),
        otlptracegrpc.WithBatchTimeout(2*time.Second),
        
        // é‡è¯•é…ç½®
        otlptracegrpc.WithRetry(otlptracegrpc.RetryConfig{
            Enabled:         true,
            InitialInterval: 50 * time.Millisecond,
            MaxInterval:     10 * time.Second,
            MaxElapsedTime:  2 * time.Minute,
        }),
        
        // è¶…æ—¶é…ç½®
        otlptracegrpc.WithTimeout(10*time.Second),
    )
    
    return trace.NewTracerProvider(
        trace.WithSpanProcessor(trace.NewBatchSpanProcessor(exporter)),
    )
}
```

### æ¡ˆä¾‹2ï¼šä½å»¶è¿Ÿåœºæ™¯ä¼ è¾“ä¼˜åŒ–

```go
// ä½å»¶è¿Ÿåœºæ™¯ä¼ è¾“ä¼˜åŒ–
package main

import (
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
    "go.opentelemetry.io/otel/sdk/trace"
)

func setupLowLatencyTracer() *trace.TracerProvider {
    exporter, _ := otlptracegrpc.New(
        otlptracegrpc.WithEndpoint("collector:4317"),
        otlptracegrpc.WithInsecure(),
        
        // å°æ‰¹é‡é…ç½®
        otlptracegrpc.WithMaxExportBatchSize(64),
        otlptracegrpc.WithBatchTimeout(100*time.Millisecond),
    )
    
    return trace.NewTracerProvider(
        trace.WithSpanProcessor(trace.NewBatchSpanProcessor(exporter)),
    )
}
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ä¼ è¾“ä¼˜åŒ–çŸ©é˜µ

```text
ä¼ è¾“ä¼˜åŒ–çŸ©é˜µ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœºæ™¯          â”‚ åè®®    â”‚ æ‰¹é‡å¤§å° â”‚ è¶…æ—¶    â”‚ å‹ç¼©    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é«˜åå        â”‚ gRPC    â”‚ 1024    â”‚ 30s    â”‚ gzip    â”‚
â”‚  ä½å»¶è¿Ÿ        â”‚ gRPC    â”‚ 64      â”‚ 100ms  â”‚ none    â”‚
â”‚  é«˜å¯é æ€§      â”‚ gRPC    â”‚ 512     â”‚ 60s    â”‚ gzip    â”‚
â”‚  æµè§ˆå™¨        â”‚ HTTP    â”‚ 256     â”‚ 5s     â”‚ gzip    â”‚
â”‚  å®æ—¶ç›‘æ§      â”‚ WebSocketâ”‚ 128    â”‚ 1s     â”‚ none    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ€»ç»“

**æ•°æ®ä¼ è¾“æœºåˆ¶**æ˜¯OTLPæ•°æ®æµçš„å…³é”®ç¯èŠ‚ï¼Œå†³å®šäº†ï¼š

1. **ä¼ è¾“æ•ˆç‡**ï¼šgRPC > HTTP/JSON
2. **ä¼ è¾“å¯é æ€§**ï¼šé‡è¯• + è¶…æ—¶ + èƒŒå‹
3. **ä¼ è¾“æˆæœ¬**ï¼šæ‰¹é‡ + å‹ç¼©
4. **ä¼ è¾“å»¶è¿Ÿ**ï¼šæµå¼ < æ‰¹é‡

**å…³é”®è¦ç‚¹**ï¼š

- âœ… gRPCæ˜¯ç”Ÿäº§ç¯å¢ƒé¦–é€‰
- âœ… æ‰¹é‡ä¼ è¾“æå‡ååé‡
- âœ… å‹ç¼©ä¼ è¾“é™ä½å¸¦å®½
- âœ… é‡è¯•æœºåˆ¶ä¿è¯å¯é æ€§
- âœ… èƒŒå‹å¤„ç†é¿å…å†…å­˜æº¢å‡º

---

**æœ€åæ›´æ–°**: 2025å¹´10æœˆ11æ—¥  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**ç»´æŠ¤è€…**: OTLPæ·±åº¦æ¢³ç†å›¢é˜Ÿ
