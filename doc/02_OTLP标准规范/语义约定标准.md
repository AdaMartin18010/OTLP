# OpenTelemetry 语义约定标准

## 🎯 语义约定概述

语义约定（Semantic Conventions）是OpenTelemetry的核心组成部分，定义了遥测数据的标准化属性名称和值，确保跨语言、跨平台的数据一致性和互操作性。

## 📊 核心语义约定

### 资源属性（Resource Attributes）

```yaml
# 核心资源属性
resource_attributes:
  service:
    service.name:
      description: "服务名称"
      type: "string"
      required: true
      example: "shopping-cart"
    
    service.version:
      description: "服务版本"
      type: "string"
      required: false
      example: "2.1.0"
    
    service.instance.id:
      description: "服务实例ID"
      type: "string"
      required: false
      example: "627cc493-f310-47de-96bd-71410b7dec09"
  
  deployment:
    deployment.environment:
      description: "部署环境"
      type: "string"
      required: false
      values: ["dev", "staging", "prod"]
      example: "prod"
    
    deployment.name:
      description: "部署名称"
      type: "string"
      required: false
      example: "shopping-cart-v2.1.0"
  
  cloud:
    cloud.provider:
      description: "云服务提供商"
      type: "string"
      required: false
      values: ["aws", "azure", "gcp", "alibaba_cloud"]
      example: "aws"
    
    cloud.region:
      description: "云区域"
      type: "string"
      required: false
      example: "us-east-1"
    
    cloud.availability_zone:
      description: "可用区"
      type: "string"
      required: false
      example: "us-east-1a"
  
  container:
    container.name:
      description: "容器名称"
      type: "string"
      required: false
      example: "opentelemetry-autoconf"
    
    container.id:
      description: "容器ID"
      type: "string"
      required: false
      example: "a3ad99b9"
    
    container.image.name:
      description: "容器镜像名称"
      type: "string"
      required: false
      example: "nginx"
    
    container.image.tag:
      description: "容器镜像标签"
      type: "string"
      required: false
      example: "1.20"
  
  k8s:
    k8s.cluster.name:
      description: "Kubernetes集群名称"
      type: "string"
      required: false
      example: "opentelemetry-cluster"
    
    k8s.namespace.name:
      description: "Kubernetes命名空间"
      type: "string"
      required: false
      example: "default"
    
    k8s.pod.name:
      description: "Pod名称"
      type: "string"
      required: false
      example: "opentelemetry-pod-autoconf"
    
    k8s.pod.uid:
      description: "Pod UID"
      type: "string"
      required: false
      example: "275ecb36-5aa8-4c2a-9c47-d8bb681b9aff"
```

### Span属性（Span Attributes）

```yaml
# HTTP Span属性
http_span_attributes:
  http.method:
    description: "HTTP请求方法"
    type: "string"
    required: true
    values: ["GET", "POST", "PUT", "DELETE", "PATCH", "HEAD", "OPTIONS"]
    example: "GET"
  
  http.url:
    description: "完整HTTP URL"
    type: "string"
    required: false
    example: "https://www.foo.bar/search?q=OpenTelemetry#SemConv"
  
  http.scheme:
    description: "URL方案"
    type: "string"
    required: false
    values: ["http", "https"]
    example: "https"
  
  http.host:
    description: "HTTP主机名"
    type: "string"
    required: false
    example: "www.foo.bar"
  
  http.server_name:
    description: "服务器名称"
    type: "string"
    required: false
    example: "envoy"
  
  http.route:
    description: "匹配的路由"
    type: "string"
    required: false
    example: "/users/:userID?"
  
  http.target:
    description: "请求目标"
    type: "string"
    required: false
    example: "/users/12314"
  
  http.status_code:
    description: "HTTP响应状态码"
    type: "int"
    required: false
    example: 200
  
  http.flavor:
    description: "HTTP协议版本"
    type: "string"
    required: false
    values: ["1.0", "1.1", "2.0", "3.0"]
    example: "1.1"
  
  http.user_agent:
    description: "用户代理"
    type: "string"
    required: false
    example: "CERN-LineMode/2.15 libwww/2.17b3"
  
  http.request_content_length:
    description: "请求内容长度"
    type: "int"
    required: false
    example: 3495
  
  http.response_content_length:
    description: "响应内容长度"
    type: "int"
    required: false
    example: 117

# 数据库Span属性
database_span_attributes:
  db.system:
    description: "数据库系统"
    type: "string"
    required: true
    values: ["mysql", "postgresql", "mongodb", "redis", "sqlite"]
    example: "postgresql"
  
  db.connection_string:
    description: "数据库连接字符串"
    type: "string"
    required: false
    example: "Server=shopdb.example.com;Database=ShopDb;Uid=billing_user;TableCache=true;UseCompression=True;MinimumPoolSize=10;MaximumPoolSize=100;"
  
  db.user:
    description: "数据库用户名"
    type: "string"
    required: false
    example: "billing_user"
  
  db.jdbc.driver_classname:
    description: "JDBC驱动类名"
    type: "string"
    required: false
    example: "org.postgresql.Driver"
  
  db.name:
    description: "数据库名称"
    type: "string"
    required: false
    example: "ShopDb"
  
  db.statement:
    description: "数据库语句"
    type: "string"
    required: false
    example: "SELECT * FROM wuser_table WHERE user_id = ?"
  
  db.operation:
    description: "数据库操作类型"
    type: "string"
    required: false
    values: ["find", "insert", "update", "delete", "aggregate", "distinct", "findAndModify", "getMore", "count", "closeCursor", "listCollections", "listIndexes", "listDatabases", "create", "drop", "killCursors", "listIndexes"]
    example: "find"
  
  db.mongodb.collection:
    description: "MongoDB集合名称"
    type: "string"
    required: false
    example: "customers"
  
  db.redis.database_index:
    description: "Redis数据库索引"
    type: "int"
    required: false
    example: 0
  
  db.cassandra.keyspace:
    description: "Cassandra键空间"
    type: "string"
    required: false
    example: "mykeyspace"
  
  db.hbase.namespace:
    description: "HBase命名空间"
    type: "string"
    required: false
    example: "shop_analytics"
  
  db.hbase.operation:
    description: "HBase操作类型"
    type: "string"
    required: false
    values: ["get", "scan", "put", "delete", "increment", "append"]
    example: "get"
  
  db.hbase.table_name:
    description: "HBase表名"
    type: "string"
    required: false
    example: "users"
  
  db.hbase.row_key:
    description: "HBase行键"
    type: "string"
    required: false
    example: "12345"
```

### RPC Span属性

```yaml
# RPC Span属性
rpc_span_attributes:
  rpc.system:
    description: "RPC系统"
    type: "string"
    required: true
    values: ["grpc", "java_rmi", "dotnet_wcf", "apache_dubbo", "connect_rpc"]
    example: "grpc"
  
  rpc.service:
    description: "RPC服务名称"
    type: "string"
    required: false
    example: "myservice.EchoService"
  
  rpc.method:
    description: "RPC方法名称"
    type: "string"
    required: false
    example: "exampleMethod"
  
  rpc.grpc.status_code:
    description: "gRPC状态码"
    type: "int"
    required: false
    values: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
    example: 0
  
  rpc.grpc.request.metadata:
    description: "gRPC请求元数据"
    type: "string"
    required: false
    example: "key1=val1,key2=val2"
  
  rpc.grpc.response.metadata:
    description: "gRPC响应元数据"
    type: "string"
    required: false
    example: "key1=val1,key2=val2"
```

### 消息传递Span属性

```yaml
# 消息传递Span属性
messaging_span_attributes:
  messaging.system:
    description: "消息系统"
    type: "string"
    required: true
    values: ["kafka", "rabbitmq", "rocketmq", "activemq", "amazon_sqs", "amazon_sns", "apache_pulsar", "redis"]
    example: "kafka"
  
  messaging.destination:
    description: "消息目标"
    type: "string"
    required: false
    example: "myTopic"
  
  messaging.destination_kind:
    description: "消息目标类型"
    type: "string"
    required: false
    values: ["queue", "topic"]
    example: "topic"
  
  messaging.temp_destination:
    description: "临时目标"
    type: "boolean"
    required: false
    example: true
  
  messaging.protocol:
    description: "消息协议"
    type: "string"
    required: false
    example: "AMQP"
  
  messaging.protocol_version:
    description: "协议版本"
    type: "string"
    required: false
    example: "0.9.1"
  
  messaging.url:
    description: "消息代理URL"
    type: "string"
    required: false
    example: "https://queue.amazonaws.com/80398EXAMPLE/MyQueue"
  
  messaging.message_id:
    description: "消息ID"
    type: "string"
    required: false
    example: "452a7c7c7a704b1322f395735cf34ea6-1526-4117-8cbd-505795e9bc2d"
  
  messaging.conversation_id:
    description: "会话ID"
    type: "string"
    required: false
    example: "MyConversationId"
  
  messaging.message_payload_size_bytes:
    description: "消息负载大小"
    type: "int"
    required: false
    example: 2738
  
  messaging.message_payload_compressed_size_bytes:
    description: "压缩后消息负载大小"
    type: "int"
    required: false
    example: 2048
  
  messaging.operation:
    description: "消息操作类型"
    type: "string"
    required: false
    values: ["publish", "receive", "process"]
    example: "publish"
  
  messaging.consumer_id:
    description: "消费者ID"
    type: "string"
    required: false
    example: "mygroup"
  
  messaging.rabbitmq.routing_key:
    description: "RabbitMQ路由键"
    type: "string"
    required: false
    example: "myKey"
  
  messaging.kafka.message_key:
    description: "Kafka消息键"
    type: "string"
    required: false
    example: "myKey"
  
  messaging.kafka.consumer_group:
    description: "Kafka消费者组"
    type: "string"
    required: false
    example: "mygroup"
  
  messaging.kafka.client_id:
    description: "Kafka客户端ID"
    type: "string"
    required: false
    example: "myclient"
  
  messaging.kafka.partition:
    description: "Kafka分区"
    type: "int"
    required: false
    example: 2
```

## 📈 指标语义约定

### 系统指标

```yaml
# 系统指标约定
system_metrics:
  system.cpu.time:
    description: "CPU时间"
    unit: "s"
    type: "counter"
    attributes:
      - "state": ["idle", "user", "system", "iowait", "irq", "softirq", "steal"]
      - "cpu": "CPU核心标识符"
  
  system.cpu.utilization:
    description: "CPU利用率"
    unit: "1"
    type: "gauge"
    attributes:
      - "state": ["idle", "user", "system", "iowait", "irq", "softirq", "steal"]
      - "cpu": "CPU核心标识符"
  
  system.memory.usage:
    description: "内存使用量"
    unit: "By"
    type: "gauge"
    attributes:
      - "state": ["used", "free", "cached", "buffered"]
  
  system.memory.utilization:
    description: "内存利用率"
    unit: "1"
    type: "gauge"
    attributes:
      - "state": ["used", "free", "cached", "buffered"]
  
  system.network.io:
    description: "网络I/O"
    unit: "By"
    type: "counter"
    attributes:
      - "device": "网络设备名称"
      - "direction": ["receive", "transmit"]
  
  system.network.packets:
    description: "网络数据包"
    unit: "{packets}"
    type: "counter"
    attributes:
      - "device": "网络设备名称"
      - "direction": ["receive", "transmit"]
  
  system.disk.io:
    description: "磁盘I/O"
    unit: "By"
    type: "counter"
    attributes:
      - "device": "磁盘设备名称"
      - "direction": ["read", "write"]
  
  system.disk.operations:
    description: "磁盘操作"
    unit: "{operations}"
    type: "counter"
    attributes:
      - "device": "磁盘设备名称"
      - "direction": ["read", "write"]
```

### 运行时指标

```yaml
# 运行时指标约定
runtime_metrics:
  runtime.jvm.memory.used:
    description: "JVM内存使用量"
    unit: "By"
    type: "gauge"
    attributes:
      - "type": ["heap", "non_heap"]
      - "area": ["used", "committed", "max"]
  
  runtime.jvm.gc.duration:
    description: "GC持续时间"
    unit: "s"
    type: "histogram"
    attributes:
      - "gc": "GC类型"
  
  runtime.jvm.threads.count:
    description: "JVM线程数"
    unit: "{threads}"
    type: "gauge"
    attributes:
      - "daemon": "是否为守护线程"
  
  runtime.dotnet.gc.collections:
    description: ".NET GC收集次数"
    unit: "{collections}"
    type: "counter"
    attributes:
      - "generation": ["0", "1", "2"]
  
  runtime.dotnet.threads.count:
    description: ".NET线程数"
    unit: "{threads}"
    type: "gauge"
    attributes:
      - "kind": ["worker", "completion_port", "timer", "gate"]
```

## 🔍 日志语义约定

### 日志记录属性

```yaml
# 日志记录属性约定
log_attributes:
  log.severity:
    description: "日志严重级别"
    type: "string"
    values: ["trace", "debug", "info", "warn", "error", "fatal"]
    example: "info"
  
  log.severity_number:
    description: "日志严重级别数字"
    type: "int"
    values: [1, 2, 4, 8, 16, 32]
    example: 9
  
  log.name:
    description: "日志记录器名称"
    type: "string"
    example: "myLogger"
  
  log.message:
    description: "日志消息"
    type: "string"
    example: "Hello world"
  
  log.source:
    description: "日志来源"
    type: "string"
    example: "myfile.go:42"
  
  log.thread.id:
    description: "线程ID"
    type: "string"
    example: "42"
  
  log.thread.name:
    description: "线程名称"
    type: "string"
    example: "main"
  
  log.span_id:
    description: "关联的Span ID"
    type: "string"
    example: "7d3e23c142044899"
  
  log.trace_id:
    description: "关联的Trace ID"
    type: "string"
    example: "7d3e23c142044899"
```

## 🎯 2025年语义约定扩展

### AI/ML语义约定

```yaml
# AI/ML语义约定
ai_ml_attributes:
  ml.model.name:
    description: "机器学习模型名称"
    type: "string"
    example: "bert-base-uncased"
  
  ml.model.version:
    description: "模型版本"
    type: "string"
    example: "1.0.0"
  
  ml.model.framework:
    description: "模型框架"
    type: "string"
    values: ["tensorflow", "pytorch", "scikit-learn", "huggingface"]
    example: "huggingface"
  
  ml.prediction.confidence:
    description: "预测置信度"
    type: "double"
    range: [0.0, 1.0]
    example: 0.95
  
  ml.prediction.class:
    description: "预测类别"
    type: "string"
    example: "positive"
  
  ml.training.epoch:
    description: "训练轮次"
    type: "int"
    example: 10
  
  ml.training.batch_size:
    description: "批次大小"
    type: "int"
    example: 32
  
  ml.training.learning_rate:
    description: "学习率"
    type: "double"
    example: 0.001
```

### 边缘计算语义约定

```yaml
# 边缘计算语义约定
edge_computing_attributes:
  edge.device.id:
    description: "边缘设备ID"
    type: "string"
    example: "edge-device-001"
  
  edge.device.type:
    description: "边缘设备类型"
    type: "string"
    values: ["gateway", "sensor", "actuator", "controller"]
    example: "gateway"
  
  edge.location.latitude:
    description: "设备纬度"
    type: "double"
    example: 40.7589
  
  edge.location.longitude:
    description: "设备经度"
    type: "double"
    example: -73.9851
  
  edge.network.latency:
    description: "网络延迟"
    unit: "ms"
    type: "gauge"
    example: 15
  
  edge.battery.level:
    description: "电池电量"
    unit: "%"
    type: "gauge"
    example: 85
  
  edge.signal.strength:
    description: "信号强度"
    unit: "dBm"
    type: "gauge"
    example: -65
```

## 📋 最佳实践指南

### 属性命名规范

```yaml
# 属性命名最佳实践
naming_conventions:
  general_rules:
    - "使用小写字母和点号分隔"
    - "避免使用下划线"
    - "保持简洁但具有描述性"
    - "使用标准化的前缀"
  
  prefixes:
    - "http.*": "HTTP相关属性"
    - "db.*": "数据库相关属性"
    - "rpc.*": "RPC相关属性"
    - "messaging.*": "消息传递相关属性"
    - "system.*": "系统相关属性"
    - "runtime.*": "运行时相关属性"
  
  examples:
    good:
      - "http.method"
      - "db.statement"
      - "rpc.service"
      - "system.cpu.utilization"
    
    bad:
      - "HTTP_METHOD"
      - "dbStatement"
      - "rpc_service"
      - "systemCpuUtilization"
```

### 属性值规范

```yaml
# 属性值最佳实践
value_conventions:
  string_values:
    - "使用小写字母"
    - "避免使用特殊字符"
    - "保持一致性"
    - "使用标准化的枚举值"
  
  numeric_values:
    - "使用适当的单位"
    - "保持精度一致性"
    - "使用标准化的范围"
  
  boolean_values:
    - "使用true/false"
    - "避免使用1/0或yes/no"
  
  array_values:
    - "保持元素类型一致"
    - "避免过大的数组"
    - "使用适当的排序"
```

## 🔧 工具和验证

### 语义约定验证工具

```yaml
# 验证工具配置
validation_tools:
  semantic_conventions_validator:
    description: "语义约定验证器"
    features:
      - "属性名称验证"
      - "属性类型验证"
      - "属性值验证"
      - "必需属性检查"
  
  lint_rules:
    - "检查属性命名规范"
    - "验证属性类型"
    - "检查必需属性"
    - "验证枚举值"
  
  automated_checks:
    - "CI/CD集成"
    - "实时验证"
    - "批量检查"
    - "报告生成"
```

## 📚 参考资源

### 官方文档

- [语义约定规范](https://opentelemetry.io/docs/specs/semconv/)
- [资源语义约定](https://opentelemetry.io/docs/specs/semconv/resource/)
- [Span语义约定](https://opentelemetry.io/docs/specs/semconv/attributes-registry/)
- [指标语义约定](https://opentelemetry.io/docs/specs/semconv/metrics/)

### 实现参考

- [语义约定注册表](https://github.com/open-telemetry/semantic-conventions)
- [验证工具](https://github.com/open-telemetry/opentelemetry-specification/tree/main/semantic_conventions)
- [示例代码](https://github.com/open-telemetry/opentelemetry-go/tree/main/example)

---

*本文档基于OpenTelemetry语义约定1.21.0版本编写，确保与最新标准保持同步。*
